## ======================================================================
## GENERATED FILE. DO NOT EDIT
## ======================================================================

groups:
- name: update-releases
  jobs:
  - update-binary-buildpack
  - update-bosh-dns-aliases
  - update-bpm
  - update-capi
  - update-cf-networking
  - update-cf-smoke-tests
  - update-cf-syslog-drain
  - update-cflinuxfs3
  - update-diego
  - update-dotnet-core-buildpack
  - update-garden-runc
  - update-go-buildpack
  - update-java-buildpack
  - update-log-cache
  - update-loggregator
  - update-loggregator-agent
  - update-nats
  - update-nginx-buildpack
  - update-nodejs-buildpack
  - update-php-buildpack
  - update-python-buildpack
  - update-pxc
  - update-r-buildpack
  - update-routing
  - update-ruby-buildpack
  - update-silk
  - update-staticfile-buildpack
  - update-statsd-injector
  - update-uaa
  - update-credhub
  - update-cf-cli
- name: cleanup
  jobs:
  - delete-stale-branches
resource_types:
- name: gcs-resource
  type: docker-image
  source:
    repository: frodenas/gcs-resource
- name: slack-notification
  type: docker-image
  source:
    repository: cfcommunity/slack-notification-resource
    tag: latest
resources:
- name: binary-buildpack-release
  type: bosh-io-release
  source:
    repository: cloudfoundry/binary-buildpack-release
- name: bosh-dns-aliases-release
  type: bosh-io-release
  source:
    repository: cloudfoundry/bosh-dns-aliases-release
- name: bpm-release
  type: bosh-io-release
  source:
    repository: cloudfoundry-incubator/bpm-release
- name: capi-release
  type: bosh-io-release
  source:
    repository: cloudfoundry/capi-release
- name: cf-networking-release
  type: bosh-io-release
  source:
    repository: cloudfoundry/cf-networking-release
- name: cf-smoke-tests-release
  type: bosh-io-release
  source:
    repository: cloudfoundry/cf-smoke-tests-release
- name: cf-syslog-drain-release
  type: bosh-io-release
  source:
    repository: cloudfoundry/cf-syslog-drain-release
- name: cflinuxfs3-release
  type: bosh-io-release
  source:
    repository: cloudfoundry/cflinuxfs3-release
- name: diego-release
  type: bosh-io-release
  source:
    repository: cloudfoundry/diego-release
- name: dotnet-core-buildpack-release
  type: bosh-io-release
  source:
    repository: cloudfoundry/dotnet-core-buildpack-release
- name: garden-runc-release
  type: bosh-io-release
  source:
    repository: cloudfoundry/garden-runc-release
- name: go-buildpack-release
  type: bosh-io-release
  source:
    repository: cloudfoundry/go-buildpack-release
- name: java-buildpack-release
  type: bosh-io-release
  source:
    repository: cloudfoundry/java-buildpack-release
- name: log-cache-release
  type: bosh-io-release
  source:
    repository: cloudfoundry/log-cache-release
- name: loggregator-release
  type: bosh-io-release
  source:
    repository: cloudfoundry/loggregator-release
- name: loggregator-agent-release
  type: bosh-io-release
  source:
    repository: cloudfoundry/loggregator-agent-release
- name: nats-release
  type: bosh-io-release
  source:
    repository: cloudfoundry/nats-release
- name: nginx-buildpack-release
  type: bosh-io-release
  source:
    repository: cloudfoundry/nginx-buildpack-release
- name: nodejs-buildpack-release
  type: bosh-io-release
  source:
    repository: cloudfoundry/nodejs-buildpack-release
- name: php-buildpack-release
  type: bosh-io-release
  source:
    repository: cloudfoundry/php-buildpack-release
- name: python-buildpack-release
  type: bosh-io-release
  source:
    repository: cloudfoundry/python-buildpack-release
- name: pxc-release
  type: bosh-io-release
  source:
    repository: cloudfoundry-incubator/pxc-release
- name: r-buildpack-release
  type: bosh-io-release
  source:
    repository: cloudfoundry/r-buildpack-release
- name: routing-release
  type: bosh-io-release
  source:
    repository: cloudfoundry-incubator/cf-routing-release
- name: ruby-buildpack-release
  type: bosh-io-release
  source:
    repository: cloudfoundry/ruby-buildpack-release
- name: silk-release
  type: bosh-io-release
  source:
    repository: cloudfoundry/silk-release
- name: staticfile-buildpack-release
  type: bosh-io-release
  source:
    repository: cloudfoundry/staticfile-buildpack-release
- name: statsd-injector-release
  type: bosh-io-release
  source:
    repository: cloudfoundry/statsd-injector-release
- name: uaa-release
  type: bosh-io-release
  source:
    repository: cloudfoundry/uaa-release
- name: credhub-release
  type: bosh-io-release
  source:
    repository: pivotal-cf/credhub-release
- name: cf-cli-release
  type: bosh-io-release
  source:
    repository: bosh-packages/cf-cli-release
- name: cf-deployment-release-candidate
  type: git
  source:
    branch: release-candidate
    uri: git@github.com:cloudfoundry/cf-deployment.git
    private_key: ((cf_deployment_readwrite_deploy_key.private_key))
- name: cf-deployment-develop
  type: git
  source:
    branch: pre-dev-test
    uri: git@github.com:cloudfoundry/cf-deployment.git
    private_key: ((cf_deployment_readwrite_deploy_key.private_key))
- name: cf-deployment-all-branches
  type: git
  source:
    branch: develop
    uri: git@github.com:cloudfoundry/cf-deployment.git
    private_key: ((cf_deployment_readwrite_deploy_key.private_key))
    ignore_paths:
    - .envrc
    - .overcommit.yml
    - ISSUE_TEMPLATE.md
    - PULL_REQUEST_TEMPLATE.md
    - ci/**
    - texts/**
- name: stemcell
  type: bosh-io-stemcell
  source:
    name: bosh-google-kvm-ubuntu-xenial-go_agent
- name: cf-deployment-concourse-tasks
  type: git
  source:
    branch: master
    uri: https://github.com/cloudfoundry/cf-deployment-concourse-tasks.git
- name: runtime-ci
  type: git
  source:
    branch: master
    uri: https://github.com/cloudfoundry/runtime-ci.git
- name: relint-envs
  type: git
  source:
    branch: master
    uri: git@github.com:cloudfoundry/relint-envs.git
    private_key: ((hagrid_env_readwrite_deploy_key.private_key))
- name: relint-team
  type: git
  source:
    branch: master
    uri: git@github.com:cloudfoundry/relint-team.git
    private_key: ((runtime_ci_private_read_deploy_key.private_key))
- name: binary-buildpack-release-gcs
  type: gcs-resource
  source:
    bucket: cf-deployment-compiled-releases
    json_key: ((concourse_gcp_service_account_json))
    regexp: binary-buildpack-[^-]+-ubuntu-xenial-[^-]+-(\d+)-(\d+)-(\d+).*\.tgz
- name: binary-buildpack-component-bump-logs-gcs
  type: gcs-resource
  source:
    bucket: component-bump-logs
    json_key: ((greengrass_gcp_service_account_json))
    regexp: binary-buildpack/cf-(\d+)-(\d+)-(\d+)\.tgz
- name: bosh-dns-aliases-release-gcs
  type: gcs-resource
  source:
    bucket: cf-deployment-compiled-releases
    json_key: ((concourse_gcp_service_account_json))
    regexp: bosh-dns-aliases-[^-]+-ubuntu-xenial-[^-]+-(\d+)-(\d+)-(\d+).*\.tgz
- name: bosh-dns-aliases-component-bump-logs-gcs
  type: gcs-resource
  source:
    bucket: component-bump-logs
    json_key: ((greengrass_gcp_service_account_json))
    regexp: bosh-dns-aliases/cf-(\d+)-(\d+)-(\d+)\.tgz
- name: bpm-release-gcs
  type: gcs-resource
  source:
    bucket: cf-deployment-compiled-releases
    json_key: ((concourse_gcp_service_account_json))
    regexp: bpm-[^-]+-ubuntu-xenial-[^-]+-(\d+)-(\d+)-(\d+).*\.tgz
- name: bpm-component-bump-logs-gcs
  type: gcs-resource
  source:
    bucket: component-bump-logs
    json_key: ((greengrass_gcp_service_account_json))
    regexp: bpm/cf-(\d+)-(\d+)-(\d+)\.tgz
- name: capi-release-gcs
  type: gcs-resource
  source:
    bucket: cf-deployment-compiled-releases
    json_key: ((concourse_gcp_service_account_json))
    regexp: capi-[^-]+-ubuntu-xenial-[^-]+-(\d+)-(\d+)-(\d+).*\.tgz
- name: capi-component-bump-logs-gcs
  type: gcs-resource
  source:
    bucket: component-bump-logs
    json_key: ((greengrass_gcp_service_account_json))
    regexp: capi/cf-(\d+)-(\d+)-(\d+)\.tgz
- name: cf-networking-release-gcs
  type: gcs-resource
  source:
    bucket: cf-deployment-compiled-releases
    json_key: ((concourse_gcp_service_account_json))
    regexp: cf-networking-[^-]+-ubuntu-xenial-[^-]+-(\d+)-(\d+)-(\d+).*\.tgz
- name: cf-networking-component-bump-logs-gcs
  type: gcs-resource
  source:
    bucket: component-bump-logs
    json_key: ((greengrass_gcp_service_account_json))
    regexp: cf-networking/cf-(\d+)-(\d+)-(\d+)\.tgz
- name: cf-smoke-tests-release-gcs
  type: gcs-resource
  source:
    bucket: cf-deployment-compiled-releases
    json_key: ((concourse_gcp_service_account_json))
    regexp: cf-smoke-tests-[^-]+-ubuntu-xenial-[^-]+-(\d+)-(\d+)-(\d+).*\.tgz
- name: cf-smoke-tests-component-bump-logs-gcs
  type: gcs-resource
  source:
    bucket: component-bump-logs
    json_key: ((greengrass_gcp_service_account_json))
    regexp: cf-smoke-tests/cf-(\d+)-(\d+)-(\d+)\.tgz
- name: cf-syslog-drain-release-gcs
  type: gcs-resource
  source:
    bucket: cf-deployment-compiled-releases
    json_key: ((concourse_gcp_service_account_json))
    regexp: cf-syslog-drain-[^-]+-ubuntu-xenial-[^-]+-(\d+)-(\d+)-(\d+).*\.tgz
- name: cf-syslog-drain-component-bump-logs-gcs
  type: gcs-resource
  source:
    bucket: component-bump-logs
    json_key: ((greengrass_gcp_service_account_json))
    regexp: cf-syslog-drain/cf-(\d+)-(\d+)-(\d+)\.tgz
- name: cflinuxfs3-release-gcs
  type: gcs-resource
  source:
    bucket: cf-deployment-compiled-releases
    json_key: ((concourse_gcp_service_account_json))
    regexp: cflinuxfs3-[^-]+-ubuntu-xenial-[^-]+-(\d+)-(\d+)-(\d+).*\.tgz
- name: cflinuxfs3-component-bump-logs-gcs
  type: gcs-resource
  source:
    bucket: component-bump-logs
    json_key: ((greengrass_gcp_service_account_json))
    regexp: cflinuxfs3/cf-(\d+)-(\d+)-(\d+)\.tgz
- name: diego-release-gcs
  type: gcs-resource
  source:
    bucket: cf-deployment-compiled-releases
    json_key: ((concourse_gcp_service_account_json))
    regexp: diego-[^-]+-ubuntu-xenial-[^-]+-(\d+)-(\d+)-(\d+).*\.tgz
- name: diego-component-bump-logs-gcs
  type: gcs-resource
  source:
    bucket: component-bump-logs
    json_key: ((greengrass_gcp_service_account_json))
    regexp: diego/cf-(\d+)-(\d+)-(\d+)\.tgz
- name: dotnet-core-buildpack-release-gcs
  type: gcs-resource
  source:
    bucket: cf-deployment-compiled-releases
    json_key: ((concourse_gcp_service_account_json))
    regexp: dotnet-core-buildpack-[^-]+-ubuntu-xenial-[^-]+-(\d+)-(\d+)-(\d+).*\.tgz
- name: dotnet-core-buildpack-component-bump-logs-gcs
  type: gcs-resource
  source:
    bucket: component-bump-logs
    json_key: ((greengrass_gcp_service_account_json))
    regexp: dotnet-core-buildpack/cf-(\d+)-(\d+)-(\d+)\.tgz
- name: garden-runc-release-gcs
  type: gcs-resource
  source:
    bucket: cf-deployment-compiled-releases
    json_key: ((concourse_gcp_service_account_json))
    regexp: garden-runc-[^-]+-ubuntu-xenial-[^-]+-(\d+)-(\d+)-(\d+).*\.tgz
- name: garden-runc-component-bump-logs-gcs
  type: gcs-resource
  source:
    bucket: component-bump-logs
    json_key: ((greengrass_gcp_service_account_json))
    regexp: garden-runc/cf-(\d+)-(\d+)-(\d+)\.tgz
- name: go-buildpack-release-gcs
  type: gcs-resource
  source:
    bucket: cf-deployment-compiled-releases
    json_key: ((concourse_gcp_service_account_json))
    regexp: go-buildpack-[^-]+-ubuntu-xenial-[^-]+-(\d+)-(\d+)-(\d+).*\.tgz
- name: go-buildpack-component-bump-logs-gcs
  type: gcs-resource
  source:
    bucket: component-bump-logs
    json_key: ((greengrass_gcp_service_account_json))
    regexp: go-buildpack/cf-(\d+)-(\d+)-(\d+)\.tgz
- name: java-buildpack-release-gcs
  type: gcs-resource
  source:
    bucket: cf-deployment-compiled-releases
    json_key: ((concourse_gcp_service_account_json))
    regexp: java-buildpack-[^-]+-ubuntu-xenial-[^-]+-(\d+)-(\d+)-(\d+).*\.tgz
- name: java-buildpack-component-bump-logs-gcs
  type: gcs-resource
  source:
    bucket: component-bump-logs
    json_key: ((greengrass_gcp_service_account_json))
    regexp: java-buildpack/cf-(\d+)-(\d+)-(\d+)\.tgz
- name: log-cache-release-gcs
  type: gcs-resource
  source:
    bucket: cf-deployment-compiled-releases
    json_key: ((concourse_gcp_service_account_json))
    regexp: log-cache-[^-]+-ubuntu-xenial-[^-]+-(\d+)-(\d+)-(\d+).*\.tgz
- name: log-cache-component-bump-logs-gcs
  type: gcs-resource
  source:
    bucket: component-bump-logs
    json_key: ((greengrass_gcp_service_account_json))
    regexp: log-cache/cf-(\d+)-(\d+)-(\d+)\.tgz
- name: loggregator-release-gcs
  type: gcs-resource
  source:
    bucket: cf-deployment-compiled-releases
    json_key: ((concourse_gcp_service_account_json))
    regexp: loggregator-[^-]+-ubuntu-xenial-[^-]+-(\d+)-(\d+)-(\d+).*\.tgz
- name: loggregator-component-bump-logs-gcs
  type: gcs-resource
  source:
    bucket: component-bump-logs
    json_key: ((greengrass_gcp_service_account_json))
    regexp: loggregator/cf-(\d+)-(\d+)-(\d+)\.tgz
- name: loggregator-agent-release-gcs
  type: gcs-resource
  source:
    bucket: cf-deployment-compiled-releases
    json_key: ((concourse_gcp_service_account_json))
    regexp: loggregator-agent-[^-]+-ubuntu-xenial-[^-]+-(\d+)-(\d+)-(\d+).*\.tgz
- name: loggregator-agent-component-bump-logs-gcs
  type: gcs-resource
  source:
    bucket: component-bump-logs
    json_key: ((greengrass_gcp_service_account_json))
    regexp: loggregator-agent/cf-(\d+)-(\d+)-(\d+)\.tgz
- name: nats-release-gcs
  type: gcs-resource
  source:
    bucket: cf-deployment-compiled-releases
    json_key: ((concourse_gcp_service_account_json))
    regexp: nats-[^-]+-ubuntu-xenial-[^-]+-(\d+)-(\d+)-(\d+).*\.tgz
- name: nats-component-bump-logs-gcs
  type: gcs-resource
  source:
    bucket: component-bump-logs
    json_key: ((greengrass_gcp_service_account_json))
    regexp: nats/cf-(\d+)-(\d+)-(\d+)\.tgz
- name: nginx-buildpack-release-gcs
  type: gcs-resource
  source:
    bucket: cf-deployment-compiled-releases
    json_key: ((concourse_gcp_service_account_json))
    regexp: nginx-buildpack-[^-]+-ubuntu-xenial-[^-]+-(\d+)-(\d+)-(\d+).*\.tgz
- name: nginx-buildpack-component-bump-logs-gcs
  type: gcs-resource
  source:
    bucket: component-bump-logs
    json_key: ((greengrass_gcp_service_account_json))
    regexp: nginx-buildpack/cf-(\d+)-(\d+)-(\d+)\.tgz
- name: nodejs-buildpack-release-gcs
  type: gcs-resource
  source:
    bucket: cf-deployment-compiled-releases
    json_key: ((concourse_gcp_service_account_json))
    regexp: nodejs-buildpack-[^-]+-ubuntu-xenial-[^-]+-(\d+)-(\d+)-(\d+).*\.tgz
- name: nodejs-buildpack-component-bump-logs-gcs
  type: gcs-resource
  source:
    bucket: component-bump-logs
    json_key: ((greengrass_gcp_service_account_json))
    regexp: nodejs-buildpack/cf-(\d+)-(\d+)-(\d+)\.tgz
- name: php-buildpack-release-gcs
  type: gcs-resource
  source:
    bucket: cf-deployment-compiled-releases
    json_key: ((concourse_gcp_service_account_json))
    regexp: php-buildpack-[^-]+-ubuntu-xenial-[^-]+-(\d+)-(\d+)-(\d+).*\.tgz
- name: php-buildpack-component-bump-logs-gcs
  type: gcs-resource
  source:
    bucket: component-bump-logs
    json_key: ((greengrass_gcp_service_account_json))
    regexp: php-buildpack/cf-(\d+)-(\d+)-(\d+)\.tgz
- name: python-buildpack-release-gcs
  type: gcs-resource
  source:
    bucket: cf-deployment-compiled-releases
    json_key: ((concourse_gcp_service_account_json))
    regexp: python-buildpack-[^-]+-ubuntu-xenial-[^-]+-(\d+)-(\d+)-(\d+).*\.tgz
- name: python-buildpack-component-bump-logs-gcs
  type: gcs-resource
  source:
    bucket: component-bump-logs
    json_key: ((greengrass_gcp_service_account_json))
    regexp: python-buildpack/cf-(\d+)-(\d+)-(\d+)\.tgz
- name: pxc-release-gcs
  type: gcs-resource
  source:
    bucket: cf-deployment-compiled-releases
    json_key: ((concourse_gcp_service_account_json))
    regexp: pxc-[^-]+-ubuntu-xenial-[^-]+-(\d+)-(\d+)-(\d+).*\.tgz
- name: pxc-component-bump-logs-gcs
  type: gcs-resource
  source:
    bucket: component-bump-logs
    json_key: ((greengrass_gcp_service_account_json))
    regexp: pxc/cf-(\d+)-(\d+)-(\d+)\.tgz
- name: r-buildpack-release-gcs
  type: gcs-resource
  source:
    bucket: cf-deployment-compiled-releases
    json_key: ((concourse_gcp_service_account_json))
    regexp: r-buildpack-[^-]+-ubuntu-xenial-[^-]+-(\d+)-(\d+)-(\d+).*\.tgz
- name: r-buildpack-component-bump-logs-gcs
  type: gcs-resource
  source:
    bucket: component-bump-logs
    json_key: ((greengrass_gcp_service_account_json))
    regexp: r-buildpack/cf-(\d+)-(\d+)-(\d+)\.tgz
- name: routing-release-gcs
  type: gcs-resource
  source:
    bucket: cf-deployment-compiled-releases
    json_key: ((concourse_gcp_service_account_json))
    regexp: routing-[^-]+-ubuntu-xenial-[^-]+-(\d+)-(\d+)-(\d+).*\.tgz
- name: routing-component-bump-logs-gcs
  type: gcs-resource
  source:
    bucket: component-bump-logs
    json_key: ((greengrass_gcp_service_account_json))
    regexp: routing/cf-(\d+)-(\d+)-(\d+)\.tgz
- name: ruby-buildpack-release-gcs
  type: gcs-resource
  source:
    bucket: cf-deployment-compiled-releases
    json_key: ((concourse_gcp_service_account_json))
    regexp: ruby-buildpack-[^-]+-ubuntu-xenial-[^-]+-(\d+)-(\d+)-(\d+).*\.tgz
- name: ruby-buildpack-component-bump-logs-gcs
  type: gcs-resource
  source:
    bucket: component-bump-logs
    json_key: ((greengrass_gcp_service_account_json))
    regexp: ruby-buildpack/cf-(\d+)-(\d+)-(\d+)\.tgz
- name: silk-release-gcs
  type: gcs-resource
  source:
    bucket: cf-deployment-compiled-releases
    json_key: ((concourse_gcp_service_account_json))
    regexp: silk-[^-]+-ubuntu-xenial-[^-]+-(\d+)-(\d+)-(\d+).*\.tgz
- name: silk-component-bump-logs-gcs
  type: gcs-resource
  source:
    bucket: component-bump-logs
    json_key: ((greengrass_gcp_service_account_json))
    regexp: silk/cf-(\d+)-(\d+)-(\d+)\.tgz
- name: staticfile-buildpack-release-gcs
  type: gcs-resource
  source:
    bucket: cf-deployment-compiled-releases
    json_key: ((concourse_gcp_service_account_json))
    regexp: staticfile-buildpack-[^-]+-ubuntu-xenial-[^-]+-(\d+)-(\d+)-(\d+).*\.tgz
- name: staticfile-buildpack-component-bump-logs-gcs
  type: gcs-resource
  source:
    bucket: component-bump-logs
    json_key: ((greengrass_gcp_service_account_json))
    regexp: staticfile-buildpack/cf-(\d+)-(\d+)-(\d+)\.tgz
- name: statsd-injector-release-gcs
  type: gcs-resource
  source:
    bucket: cf-deployment-compiled-releases
    json_key: ((concourse_gcp_service_account_json))
    regexp: statsd-injector-[^-]+-ubuntu-xenial-[^-]+-(\d+)-(\d+)-(\d+).*\.tgz
- name: statsd-injector-component-bump-logs-gcs
  type: gcs-resource
  source:
    bucket: component-bump-logs
    json_key: ((greengrass_gcp_service_account_json))
    regexp: statsd-injector/cf-(\d+)-(\d+)-(\d+)\.tgz
- name: uaa-release-gcs
  type: gcs-resource
  source:
    bucket: cf-deployment-compiled-releases
    json_key: ((concourse_gcp_service_account_json))
    regexp: uaa-[^-]+-ubuntu-xenial-[^-]+-(\d+)-(\d+)-(\d+).*\.tgz
- name: uaa-component-bump-logs-gcs
  type: gcs-resource
  source:
    bucket: component-bump-logs
    json_key: ((greengrass_gcp_service_account_json))
    regexp: uaa/cf-(\d+)-(\d+)-(\d+)\.tgz
- name: credhub-release-gcs
  type: gcs-resource
  source:
    bucket: cf-deployment-compiled-releases
    json_key: ((concourse_gcp_service_account_json))
    regexp: credhub-[^-]+-ubuntu-xenial-[^-]+-(\d+)-(\d+)-(\d+).*\.tgz
- name: credhub-component-bump-logs-gcs
  type: gcs-resource
  source:
    bucket: component-bump-logs
    json_key: ((greengrass_gcp_service_account_json))
    regexp: credhub/cf-(\d+)-(\d+)-(\d+)\.tgz
- name: cf-cli-release-gcs
  type: gcs-resource
  source:
    bucket: cf-deployment-compiled-releases
    json_key: ((concourse_gcp_service_account_json))
    regexp: cf-cli-[^-]+-ubuntu-xenial-[^-]+-(\d+)-(\d+)-(\d+).*\.tgz
- name: cf-cli-component-bump-logs-gcs
  type: gcs-resource
  source:
    bucket: component-bump-logs
    json_key: ((greengrass_gcp_service_account_json))
    regexp: cf-cli/cf-(\d+)-(\d+)-(\d+)\.tgz
- name: slack-alert
  type: slack-notification
  source:
    url: ((relint_slack_incoming_webhook))
- name: daily
  type: time
  source:
    interval: 24h
jobs:
- name: update-binary-buildpack
  serial_groups:
  - update-release
  public: true
  plan:
  - aggregate:
    - get: binary-buildpack-release
      trigger: true
      params:
        tarball: false
    - get: cf-deployment-release-candidate
    - get: cf-deployment-develop
    - get: stemcell
      params:
        tarball: false
    - get: cf-deployment-concourse-tasks
    - get: runtime-ci
    - get: relint-envs
    - get: relint-team
  - task: update-release-binary-buildpack-release-candidate
    file: runtime-ci/tasks/update-single-manifest-release/task.yml
    input_mapping:
      deployment-configuration: cf-deployment-release-candidate
      release: binary-buildpack-release
    output_mapping:
      updated-deployment-manifest: updated-cf-deployment-binary-buildpack-release-candidate
    params:
      RELEASE_NAME: binary-buildpack
  - task: update-additional-ops-files-binary-buildpack-release-candidate
    file: runtime-ci/tasks/update-single-opsfile-release/task.yml
    input_mapping:
      original-ops-file: updated-cf-deployment-binary-buildpack-release-candidate
      release: binary-buildpack-release
    output_mapping:
      updated-ops-file: updated-cf-deployment-binary-buildpack-release-candidate
    params:
      RELEASE_NAME: binary-buildpack
  - do:
    - task: bbl-up
      file: cf-deployment-concourse-tasks/bbl-up/task.yml
      params:
        BBL_STATE_DIR: environments/test/pre-dev/bbl-state
        BBL_IAAS: gcp
        BBL_ENV_NAME: pre-dev
        BBL_GCP_SERVICE_ACCOUNT_KEY: environments/test/pre-dev/google_account_creds.json
        BBL_GCP_REGION: us-central1
        BBL_LB_CERT: ((pre_dev_cf_lb_cert.certificate))
        BBL_LB_KEY: ((pre_dev_cf_lb_cert.private_key))
        LB_DOMAIN: pre-dev.test.relint.rocks
      input_mapping:
        bbl-state: relint-envs
        bbl-config: relint-envs
      ensure:
        put: relint-envs
        params:
          repository: updated-bbl-state
          rebase: true
    - task: add-gcp-dns
      file: runtime-ci/tasks/manage-gcp-dns/task.yml
      input_mapping:
        bbl-state: relint-envs
      params:
        BBL_STATE_DIR: environments/test/pre-dev/bbl-state
        GCP_DNS_SERVICE_ACCOUNT_KEY: ((concourse_gcp_service_account_json))
        GCP_DNS_ZONE_NAME: test-relint-rocks
        GCP_DNS_RECORD_SET_NAME: pre-dev.test.relint.rocks
        ACTION: add
    - do:
      - task: deploy-cf
        file: cf-deployment-concourse-tasks/bosh-deploy/task.yml
        input_mapping:
          bbl-state: relint-envs
          cf-deployment: updated-cf-deployment-binary-buildpack-release-candidate
          ops-files: updated-cf-deployment-binary-buildpack-release-candidate
          vars-files: relint-envs
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
          SYSTEM_DOMAIN: pre-dev.test.relint.rocks
          OPS_FILES: |
            operations/experimental/fast-deploy-with-downtime-and-danger.yml
          REGENERATE_CREDENTIALS: false
          BOSH_DEPLOY_ARGS: --parallel 50
      - task: run-errand-smoke-tests
        file: cf-deployment-concourse-tasks/run-errand/task.yml
        input_mapping:
          bbl-state: relint-envs
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
          ERRAND_NAME: smoke-tests
      - task: export-compiled-release-binary-buildpack
        file: runtime-ci/tasks/export-compiled-release-tarball/task.yml
        input_mapping:
          bbl-state: relint-envs
          manifest: updated-cf-deployment-binary-buildpack-release-candidate
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
          RELEASE_NAME: binary-buildpack
      - task: update-release-binary-buildpack-develop
        file: runtime-ci/tasks/update-single-manifest-release/task.yml
        input_mapping:
          deployment-configuration: cf-deployment-develop
          release: binary-buildpack-release
        output_mapping:
          updated-deployment-manifest: updated-cf-deployment-binary-buildpack-develop
        params:
          RELEASE_NAME: binary-buildpack
      - task: update-additional-ops-files-binary-buildpack-develop
        file: runtime-ci/tasks/update-single-opsfile-release/task.yml
        input_mapping:
          original-ops-file: updated-cf-deployment-binary-buildpack-develop
          release: binary-buildpack-release
        output_mapping:
          updated-ops-file: updated-cf-deployment-binary-buildpack-develop
        params:
          RELEASE_NAME: binary-buildpack
      - task: update-compiled-releases-ops-file-binary-buildpack-develop
        file: runtime-ci/tasks/update-single-compiled-release/task.yml
        input_mapping:
          original-compiled-releases-ops-file: updated-cf-deployment-binary-buildpack-develop
          release: binary-buildpack-release
        output_mapping:
          updated-compiled-releases-ops-file: updated-cf-deployment-binary-buildpack-develop
        params:
          RELEASE_NAME: binary-buildpack
          ORIGINAL_OPS_FILE_PATH: operations/use-compiled-releases.yml
          UPDATED_OPS_FILE_PATH: operations/use-compiled-releases.yml
      on_success:
        do:
        - put: binary-buildpack-release-gcs
          params:
            file: compiled-release-tarball/*.tgz
            predefined_acl: publicRead
        - put: cf-deployment-develop
          params:
            rebase: true
            repository: updated-cf-deployment-binary-buildpack-develop
      on_failure:
        do:
        - task: push-to-release-branch
          file: runtime-ci/tasks/push-to-release-branch/task.yml
          input_mapping:
            updated-cf-deployment: updated-cf-deployment-binary-buildpack-release-candidate
            release: binary-buildpack-release
          params:
            DEPLOY_KEY: ((cf_deployment_readwrite_deploy_key.private_key))
            RELEASE_NAME: binary-buildpack
        - task: retrieve-bosh-logs
          file: runtime-ci/tasks/retrieve-bosh-logs/task.yml
          input_mapping:
            bbl-state: relint-envs
          params:
            BBL_STATE_DIR: environments/test/pre-dev/bbl-state
        - put: binary-buildpack-component-bump-logs-gcs
          params:
            file: bosh-logs/cf-*.tgz
        ensure:
          do:
          - task: create-slack-message
            file: runtime-ci/tasks/create-slack-message/task.yml
            input_mapping:
              release: binary-buildpack-release
            params:
              RELEASE_NAME: binary-buildpack
              REPOSITORY: cloudfoundry/binary-buildpack-release
              BOSH_LOGS_PREFIX: https://storage.cloud.google.com/component-bump-logs/binary-buildpack
          - put: slack-alert
            params:
              text_file: slack-message/message.txt
              username: Release Integration
              icon_emoji: ':cloudfoundrylogo:'
    ensure:
      do:
      - task: delete-deployment
        file: cf-deployment-concourse-tasks/bosh-delete-deployment/task.yml
        input_mapping:
          bbl-state: relint-envs
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
      - task: remove-gcp-dns
        file: runtime-ci/tasks/manage-gcp-dns/task.yml
        input_mapping:
          bbl-state: relint-envs
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
          GCP_DNS_SERVICE_ACCOUNT_KEY: ((concourse_gcp_service_account_json))
          GCP_DNS_ZONE_NAME: test-relint-rocks
          GCP_DNS_RECORD_SET_NAME: pre-dev.test.relint.rocks
          ACTION: remove
      - task: bbl-down
        file: cf-deployment-concourse-tasks/bbl-destroy/task.yml
        input_mapping:
          bbl-state: relint-envs
        params:
          BBL_GCP_SERVICE_ACCOUNT_KEY: environments/test/pre-dev/google_account_creds.json
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
        ensure:
          put: relint-envs
          params:
            repository: updated-bbl-state
            rebase: true
- name: update-bosh-dns-aliases
  serial_groups:
  - update-release
  public: true
  plan:
  - aggregate:
    - get: bosh-dns-aliases-release
      trigger: true
      params:
        tarball: false
    - get: cf-deployment-release-candidate
    - get: cf-deployment-develop
    - get: stemcell
      params:
        tarball: false
    - get: cf-deployment-concourse-tasks
    - get: runtime-ci
    - get: relint-envs
    - get: relint-team
  - task: update-release-bosh-dns-aliases-release-candidate
    file: runtime-ci/tasks/update-single-manifest-release/task.yml
    input_mapping:
      deployment-configuration: cf-deployment-release-candidate
      release: bosh-dns-aliases-release
    output_mapping:
      updated-deployment-manifest: updated-cf-deployment-bosh-dns-aliases-release-candidate
    params:
      RELEASE_NAME: bosh-dns-aliases
  - task: update-additional-ops-files-bosh-dns-aliases-release-candidate
    file: runtime-ci/tasks/update-single-opsfile-release/task.yml
    input_mapping:
      original-ops-file: updated-cf-deployment-bosh-dns-aliases-release-candidate
      release: bosh-dns-aliases-release
    output_mapping:
      updated-ops-file: updated-cf-deployment-bosh-dns-aliases-release-candidate
    params:
      RELEASE_NAME: bosh-dns-aliases
  - do:
    - task: bbl-up
      file: cf-deployment-concourse-tasks/bbl-up/task.yml
      params:
        BBL_STATE_DIR: environments/test/pre-dev/bbl-state
        BBL_IAAS: gcp
        BBL_ENV_NAME: pre-dev
        BBL_GCP_SERVICE_ACCOUNT_KEY: environments/test/pre-dev/google_account_creds.json
        BBL_GCP_REGION: us-central1
        BBL_LB_CERT: ((pre_dev_cf_lb_cert.certificate))
        BBL_LB_KEY: ((pre_dev_cf_lb_cert.private_key))
        LB_DOMAIN: pre-dev.test.relint.rocks
      input_mapping:
        bbl-state: relint-envs
        bbl-config: relint-envs
      ensure:
        put: relint-envs
        params:
          repository: updated-bbl-state
          rebase: true
    - task: add-gcp-dns
      file: runtime-ci/tasks/manage-gcp-dns/task.yml
      input_mapping:
        bbl-state: relint-envs
      params:
        BBL_STATE_DIR: environments/test/pre-dev/bbl-state
        GCP_DNS_SERVICE_ACCOUNT_KEY: ((concourse_gcp_service_account_json))
        GCP_DNS_ZONE_NAME: test-relint-rocks
        GCP_DNS_RECORD_SET_NAME: pre-dev.test.relint.rocks
        ACTION: add
    - do:
      - task: deploy-cf
        file: cf-deployment-concourse-tasks/bosh-deploy/task.yml
        input_mapping:
          bbl-state: relint-envs
          cf-deployment: updated-cf-deployment-bosh-dns-aliases-release-candidate
          ops-files: updated-cf-deployment-bosh-dns-aliases-release-candidate
          vars-files: relint-envs
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
          SYSTEM_DOMAIN: pre-dev.test.relint.rocks
          OPS_FILES: |
            operations/experimental/fast-deploy-with-downtime-and-danger.yml
          REGENERATE_CREDENTIALS: false
          BOSH_DEPLOY_ARGS: --parallel 50
      - task: run-errand-smoke-tests
        file: cf-deployment-concourse-tasks/run-errand/task.yml
        input_mapping:
          bbl-state: relint-envs
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
          ERRAND_NAME: smoke-tests
      - task: export-compiled-release-bosh-dns-aliases
        file: runtime-ci/tasks/export-compiled-release-tarball/task.yml
        input_mapping:
          bbl-state: relint-envs
          manifest: updated-cf-deployment-bosh-dns-aliases-release-candidate
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
          RELEASE_NAME: bosh-dns-aliases
      - task: update-release-bosh-dns-aliases-develop
        file: runtime-ci/tasks/update-single-manifest-release/task.yml
        input_mapping:
          deployment-configuration: cf-deployment-develop
          release: bosh-dns-aliases-release
        output_mapping:
          updated-deployment-manifest: updated-cf-deployment-bosh-dns-aliases-develop
        params:
          RELEASE_NAME: bosh-dns-aliases
      - task: update-additional-ops-files-bosh-dns-aliases-develop
        file: runtime-ci/tasks/update-single-opsfile-release/task.yml
        input_mapping:
          original-ops-file: updated-cf-deployment-bosh-dns-aliases-develop
          release: bosh-dns-aliases-release
        output_mapping:
          updated-ops-file: updated-cf-deployment-bosh-dns-aliases-develop
        params:
          RELEASE_NAME: bosh-dns-aliases
      - task: update-compiled-releases-ops-file-bosh-dns-aliases-develop
        file: runtime-ci/tasks/update-single-compiled-release/task.yml
        input_mapping:
          original-compiled-releases-ops-file: updated-cf-deployment-bosh-dns-aliases-develop
          release: bosh-dns-aliases-release
        output_mapping:
          updated-compiled-releases-ops-file: updated-cf-deployment-bosh-dns-aliases-develop
        params:
          RELEASE_NAME: bosh-dns-aliases
          ORIGINAL_OPS_FILE_PATH: operations/use-compiled-releases.yml
          UPDATED_OPS_FILE_PATH: operations/use-compiled-releases.yml
      on_success:
        do:
        - put: bosh-dns-aliases-release-gcs
          params:
            file: compiled-release-tarball/*.tgz
            predefined_acl: publicRead
        - put: cf-deployment-develop
          params:
            rebase: true
            repository: updated-cf-deployment-bosh-dns-aliases-develop
      on_failure:
        do:
        - task: push-to-release-branch
          file: runtime-ci/tasks/push-to-release-branch/task.yml
          input_mapping:
            updated-cf-deployment: updated-cf-deployment-bosh-dns-aliases-release-candidate
            release: bosh-dns-aliases-release
          params:
            DEPLOY_KEY: ((cf_deployment_readwrite_deploy_key.private_key))
            RELEASE_NAME: bosh-dns-aliases
        - task: retrieve-bosh-logs
          file: runtime-ci/tasks/retrieve-bosh-logs/task.yml
          input_mapping:
            bbl-state: relint-envs
          params:
            BBL_STATE_DIR: environments/test/pre-dev/bbl-state
        - put: bosh-dns-aliases-component-bump-logs-gcs
          params:
            file: bosh-logs/cf-*.tgz
        ensure:
          do:
          - task: create-slack-message
            file: runtime-ci/tasks/create-slack-message/task.yml
            input_mapping:
              release: bosh-dns-aliases-release
            params:
              RELEASE_NAME: bosh-dns-aliases
              REPOSITORY: cloudfoundry/bosh-dns-aliases-release
              BOSH_LOGS_PREFIX: https://storage.cloud.google.com/component-bump-logs/bosh-dns-aliases
          - put: slack-alert
            params:
              text_file: slack-message/message.txt
              username: Release Integration
              icon_emoji: ':cloudfoundrylogo:'
    ensure:
      do:
      - task: delete-deployment
        file: cf-deployment-concourse-tasks/bosh-delete-deployment/task.yml
        input_mapping:
          bbl-state: relint-envs
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
      - task: remove-gcp-dns
        file: runtime-ci/tasks/manage-gcp-dns/task.yml
        input_mapping:
          bbl-state: relint-envs
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
          GCP_DNS_SERVICE_ACCOUNT_KEY: ((concourse_gcp_service_account_json))
          GCP_DNS_ZONE_NAME: test-relint-rocks
          GCP_DNS_RECORD_SET_NAME: pre-dev.test.relint.rocks
          ACTION: remove
      - task: bbl-down
        file: cf-deployment-concourse-tasks/bbl-destroy/task.yml
        input_mapping:
          bbl-state: relint-envs
        params:
          BBL_GCP_SERVICE_ACCOUNT_KEY: environments/test/pre-dev/google_account_creds.json
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
        ensure:
          put: relint-envs
          params:
            repository: updated-bbl-state
            rebase: true
- name: update-bpm
  serial_groups:
  - update-release
  public: true
  plan:
  - aggregate:
    - get: bpm-release
      trigger: true
      params:
        tarball: false
    - get: cf-deployment-release-candidate
    - get: cf-deployment-develop
    - get: stemcell
      params:
        tarball: false
    - get: cf-deployment-concourse-tasks
    - get: runtime-ci
    - get: relint-envs
    - get: relint-team
  - task: update-release-bpm-release-candidate
    file: runtime-ci/tasks/update-single-manifest-release/task.yml
    input_mapping:
      deployment-configuration: cf-deployment-release-candidate
      release: bpm-release
    output_mapping:
      updated-deployment-manifest: updated-cf-deployment-bpm-release-candidate
    params:
      RELEASE_NAME: bpm
  - task: update-additional-ops-files-bpm-release-candidate
    file: runtime-ci/tasks/update-single-opsfile-release/task.yml
    input_mapping:
      original-ops-file: updated-cf-deployment-bpm-release-candidate
      release: bpm-release
    output_mapping:
      updated-ops-file: updated-cf-deployment-bpm-release-candidate
    params:
      RELEASE_NAME: bpm
  - do:
    - task: bbl-up
      file: cf-deployment-concourse-tasks/bbl-up/task.yml
      params:
        BBL_STATE_DIR: environments/test/pre-dev/bbl-state
        BBL_IAAS: gcp
        BBL_ENV_NAME: pre-dev
        BBL_GCP_SERVICE_ACCOUNT_KEY: environments/test/pre-dev/google_account_creds.json
        BBL_GCP_REGION: us-central1
        BBL_LB_CERT: ((pre_dev_cf_lb_cert.certificate))
        BBL_LB_KEY: ((pre_dev_cf_lb_cert.private_key))
        LB_DOMAIN: pre-dev.test.relint.rocks
      input_mapping:
        bbl-state: relint-envs
        bbl-config: relint-envs
      ensure:
        put: relint-envs
        params:
          repository: updated-bbl-state
          rebase: true
    - task: add-gcp-dns
      file: runtime-ci/tasks/manage-gcp-dns/task.yml
      input_mapping:
        bbl-state: relint-envs
      params:
        BBL_STATE_DIR: environments/test/pre-dev/bbl-state
        GCP_DNS_SERVICE_ACCOUNT_KEY: ((concourse_gcp_service_account_json))
        GCP_DNS_ZONE_NAME: test-relint-rocks
        GCP_DNS_RECORD_SET_NAME: pre-dev.test.relint.rocks
        ACTION: add
    - do:
      - task: deploy-cf
        file: cf-deployment-concourse-tasks/bosh-deploy/task.yml
        input_mapping:
          bbl-state: relint-envs
          cf-deployment: updated-cf-deployment-bpm-release-candidate
          ops-files: updated-cf-deployment-bpm-release-candidate
          vars-files: relint-envs
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
          SYSTEM_DOMAIN: pre-dev.test.relint.rocks
          OPS_FILES: |
            operations/experimental/fast-deploy-with-downtime-and-danger.yml
          REGENERATE_CREDENTIALS: false
          BOSH_DEPLOY_ARGS: --parallel 50
      - task: run-errand-smoke-tests
        file: cf-deployment-concourse-tasks/run-errand/task.yml
        input_mapping:
          bbl-state: relint-envs
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
          ERRAND_NAME: smoke-tests
      - task: export-compiled-release-bpm
        file: runtime-ci/tasks/export-compiled-release-tarball/task.yml
        input_mapping:
          bbl-state: relint-envs
          manifest: updated-cf-deployment-bpm-release-candidate
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
          RELEASE_NAME: bpm
      - task: update-release-bpm-develop
        file: runtime-ci/tasks/update-single-manifest-release/task.yml
        input_mapping:
          deployment-configuration: cf-deployment-develop
          release: bpm-release
        output_mapping:
          updated-deployment-manifest: updated-cf-deployment-bpm-develop
        params:
          RELEASE_NAME: bpm
      - task: update-additional-ops-files-bpm-develop
        file: runtime-ci/tasks/update-single-opsfile-release/task.yml
        input_mapping:
          original-ops-file: updated-cf-deployment-bpm-develop
          release: bpm-release
        output_mapping:
          updated-ops-file: updated-cf-deployment-bpm-develop
        params:
          RELEASE_NAME: bpm
      - task: update-compiled-releases-ops-file-bpm-develop
        file: runtime-ci/tasks/update-single-compiled-release/task.yml
        input_mapping:
          original-compiled-releases-ops-file: updated-cf-deployment-bpm-develop
          release: bpm-release
        output_mapping:
          updated-compiled-releases-ops-file: updated-cf-deployment-bpm-develop
        params:
          RELEASE_NAME: bpm
          ORIGINAL_OPS_FILE_PATH: operations/use-compiled-releases.yml
          UPDATED_OPS_FILE_PATH: operations/use-compiled-releases.yml
      on_success:
        do:
        - put: bpm-release-gcs
          params:
            file: compiled-release-tarball/*.tgz
            predefined_acl: publicRead
        - put: cf-deployment-develop
          params:
            rebase: true
            repository: updated-cf-deployment-bpm-develop
      on_failure:
        do:
        - task: push-to-release-branch
          file: runtime-ci/tasks/push-to-release-branch/task.yml
          input_mapping:
            updated-cf-deployment: updated-cf-deployment-bpm-release-candidate
            release: bpm-release
          params:
            DEPLOY_KEY: ((cf_deployment_readwrite_deploy_key.private_key))
            RELEASE_NAME: bpm
        - task: retrieve-bosh-logs
          file: runtime-ci/tasks/retrieve-bosh-logs/task.yml
          input_mapping:
            bbl-state: relint-envs
          params:
            BBL_STATE_DIR: environments/test/pre-dev/bbl-state
        - put: bpm-component-bump-logs-gcs
          params:
            file: bosh-logs/cf-*.tgz
        ensure:
          do:
          - task: create-slack-message
            file: runtime-ci/tasks/create-slack-message/task.yml
            input_mapping:
              release: bpm-release
            params:
              RELEASE_NAME: bpm
              REPOSITORY: cloudfoundry-incubator/bpm-release
              BOSH_LOGS_PREFIX: https://storage.cloud.google.com/component-bump-logs/bpm
          - put: slack-alert
            params:
              text_file: slack-message/message.txt
              username: Release Integration
              icon_emoji: ':cloudfoundrylogo:'
    ensure:
      do:
      - task: delete-deployment
        file: cf-deployment-concourse-tasks/bosh-delete-deployment/task.yml
        input_mapping:
          bbl-state: relint-envs
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
      - task: remove-gcp-dns
        file: runtime-ci/tasks/manage-gcp-dns/task.yml
        input_mapping:
          bbl-state: relint-envs
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
          GCP_DNS_SERVICE_ACCOUNT_KEY: ((concourse_gcp_service_account_json))
          GCP_DNS_ZONE_NAME: test-relint-rocks
          GCP_DNS_RECORD_SET_NAME: pre-dev.test.relint.rocks
          ACTION: remove
      - task: bbl-down
        file: cf-deployment-concourse-tasks/bbl-destroy/task.yml
        input_mapping:
          bbl-state: relint-envs
        params:
          BBL_GCP_SERVICE_ACCOUNT_KEY: environments/test/pre-dev/google_account_creds.json
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
        ensure:
          put: relint-envs
          params:
            repository: updated-bbl-state
            rebase: true
- name: update-capi
  serial_groups:
  - update-release
  public: true
  plan:
  - aggregate:
    - get: capi-release
      trigger: true
      params:
        tarball: false
    - get: cf-deployment-release-candidate
    - get: cf-deployment-develop
    - get: stemcell
      params:
        tarball: false
    - get: cf-deployment-concourse-tasks
    - get: runtime-ci
    - get: relint-envs
    - get: relint-team
  - task: update-release-capi-release-candidate
    file: runtime-ci/tasks/update-single-manifest-release/task.yml
    input_mapping:
      deployment-configuration: cf-deployment-release-candidate
      release: capi-release
    output_mapping:
      updated-deployment-manifest: updated-cf-deployment-capi-release-candidate
    params:
      RELEASE_NAME: capi
  - task: update-additional-ops-files-capi-release-candidate
    file: runtime-ci/tasks/update-single-opsfile-release/task.yml
    input_mapping:
      original-ops-file: updated-cf-deployment-capi-release-candidate
      release: capi-release
    output_mapping:
      updated-ops-file: updated-cf-deployment-capi-release-candidate
    params:
      RELEASE_NAME: capi
  - do:
    - task: bbl-up
      file: cf-deployment-concourse-tasks/bbl-up/task.yml
      params:
        BBL_STATE_DIR: environments/test/pre-dev/bbl-state
        BBL_IAAS: gcp
        BBL_ENV_NAME: pre-dev
        BBL_GCP_SERVICE_ACCOUNT_KEY: environments/test/pre-dev/google_account_creds.json
        BBL_GCP_REGION: us-central1
        BBL_LB_CERT: ((pre_dev_cf_lb_cert.certificate))
        BBL_LB_KEY: ((pre_dev_cf_lb_cert.private_key))
        LB_DOMAIN: pre-dev.test.relint.rocks
      input_mapping:
        bbl-state: relint-envs
        bbl-config: relint-envs
      ensure:
        put: relint-envs
        params:
          repository: updated-bbl-state
          rebase: true
    - task: add-gcp-dns
      file: runtime-ci/tasks/manage-gcp-dns/task.yml
      input_mapping:
        bbl-state: relint-envs
      params:
        BBL_STATE_DIR: environments/test/pre-dev/bbl-state
        GCP_DNS_SERVICE_ACCOUNT_KEY: ((concourse_gcp_service_account_json))
        GCP_DNS_ZONE_NAME: test-relint-rocks
        GCP_DNS_RECORD_SET_NAME: pre-dev.test.relint.rocks
        ACTION: add
    - do:
      - task: deploy-cf
        file: cf-deployment-concourse-tasks/bosh-deploy/task.yml
        input_mapping:
          bbl-state: relint-envs
          cf-deployment: updated-cf-deployment-capi-release-candidate
          ops-files: updated-cf-deployment-capi-release-candidate
          vars-files: relint-envs
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
          SYSTEM_DOMAIN: pre-dev.test.relint.rocks
          OPS_FILES: |
            operations/experimental/fast-deploy-with-downtime-and-danger.yml
          REGENERATE_CREDENTIALS: false
          BOSH_DEPLOY_ARGS: --parallel 50
      - task: run-errand-smoke-tests
        file: cf-deployment-concourse-tasks/run-errand/task.yml
        input_mapping:
          bbl-state: relint-envs
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
          ERRAND_NAME: smoke-tests
      - task: export-compiled-release-capi
        file: runtime-ci/tasks/export-compiled-release-tarball/task.yml
        input_mapping:
          bbl-state: relint-envs
          manifest: updated-cf-deployment-capi-release-candidate
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
          RELEASE_NAME: capi
      - task: update-release-capi-develop
        file: runtime-ci/tasks/update-single-manifest-release/task.yml
        input_mapping:
          deployment-configuration: cf-deployment-develop
          release: capi-release
        output_mapping:
          updated-deployment-manifest: updated-cf-deployment-capi-develop
        params:
          RELEASE_NAME: capi
      - task: update-additional-ops-files-capi-develop
        file: runtime-ci/tasks/update-single-opsfile-release/task.yml
        input_mapping:
          original-ops-file: updated-cf-deployment-capi-develop
          release: capi-release
        output_mapping:
          updated-ops-file: updated-cf-deployment-capi-develop
        params:
          RELEASE_NAME: capi
      - task: update-compiled-releases-ops-file-capi-develop
        file: runtime-ci/tasks/update-single-compiled-release/task.yml
        input_mapping:
          original-compiled-releases-ops-file: updated-cf-deployment-capi-develop
          release: capi-release
        output_mapping:
          updated-compiled-releases-ops-file: updated-cf-deployment-capi-develop
        params:
          RELEASE_NAME: capi
          ORIGINAL_OPS_FILE_PATH: operations/use-compiled-releases.yml
          UPDATED_OPS_FILE_PATH: operations/use-compiled-releases.yml
      on_success:
        do:
        - put: capi-release-gcs
          params:
            file: compiled-release-tarball/*.tgz
            predefined_acl: publicRead
        - put: cf-deployment-develop
          params:
            rebase: true
            repository: updated-cf-deployment-capi-develop
      on_failure:
        do:
        - task: push-to-release-branch
          file: runtime-ci/tasks/push-to-release-branch/task.yml
          input_mapping:
            updated-cf-deployment: updated-cf-deployment-capi-release-candidate
            release: capi-release
          params:
            DEPLOY_KEY: ((cf_deployment_readwrite_deploy_key.private_key))
            RELEASE_NAME: capi
        - task: retrieve-bosh-logs
          file: runtime-ci/tasks/retrieve-bosh-logs/task.yml
          input_mapping:
            bbl-state: relint-envs
          params:
            BBL_STATE_DIR: environments/test/pre-dev/bbl-state
        - put: capi-component-bump-logs-gcs
          params:
            file: bosh-logs/cf-*.tgz
        ensure:
          do:
          - task: create-slack-message
            file: runtime-ci/tasks/create-slack-message/task.yml
            input_mapping:
              release: capi-release
            params:
              RELEASE_NAME: capi
              REPOSITORY: cloudfoundry/capi-release
              BOSH_LOGS_PREFIX: https://storage.cloud.google.com/component-bump-logs/capi
          - put: slack-alert
            params:
              text_file: slack-message/message.txt
              username: Release Integration
              icon_emoji: ':cloudfoundrylogo:'
    ensure:
      do:
      - task: delete-deployment
        file: cf-deployment-concourse-tasks/bosh-delete-deployment/task.yml
        input_mapping:
          bbl-state: relint-envs
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
      - task: remove-gcp-dns
        file: runtime-ci/tasks/manage-gcp-dns/task.yml
        input_mapping:
          bbl-state: relint-envs
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
          GCP_DNS_SERVICE_ACCOUNT_KEY: ((concourse_gcp_service_account_json))
          GCP_DNS_ZONE_NAME: test-relint-rocks
          GCP_DNS_RECORD_SET_NAME: pre-dev.test.relint.rocks
          ACTION: remove
      - task: bbl-down
        file: cf-deployment-concourse-tasks/bbl-destroy/task.yml
        input_mapping:
          bbl-state: relint-envs
        params:
          BBL_GCP_SERVICE_ACCOUNT_KEY: environments/test/pre-dev/google_account_creds.json
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
        ensure:
          put: relint-envs
          params:
            repository: updated-bbl-state
            rebase: true
- name: update-cf-networking
  serial_groups:
  - update-release
  public: true
  plan:
  - aggregate:
    - get: cf-networking-release
      trigger: true
      params:
        tarball: false
    - get: cf-deployment-release-candidate
    - get: cf-deployment-develop
    - get: stemcell
      params:
        tarball: false
    - get: cf-deployment-concourse-tasks
    - get: runtime-ci
    - get: relint-envs
    - get: relint-team
  - task: update-release-cf-networking-release-candidate
    file: runtime-ci/tasks/update-single-manifest-release/task.yml
    input_mapping:
      deployment-configuration: cf-deployment-release-candidate
      release: cf-networking-release
    output_mapping:
      updated-deployment-manifest: updated-cf-deployment-cf-networking-release-candidate
    params:
      RELEASE_NAME: cf-networking
  - task: update-additional-ops-files-cf-networking-release-candidate
    file: runtime-ci/tasks/update-single-opsfile-release/task.yml
    input_mapping:
      original-ops-file: updated-cf-deployment-cf-networking-release-candidate
      release: cf-networking-release
    output_mapping:
      updated-ops-file: updated-cf-deployment-cf-networking-release-candidate
    params:
      RELEASE_NAME: cf-networking
  - do:
    - task: bbl-up
      file: cf-deployment-concourse-tasks/bbl-up/task.yml
      params:
        BBL_STATE_DIR: environments/test/pre-dev/bbl-state
        BBL_IAAS: gcp
        BBL_ENV_NAME: pre-dev
        BBL_GCP_SERVICE_ACCOUNT_KEY: environments/test/pre-dev/google_account_creds.json
        BBL_GCP_REGION: us-central1
        BBL_LB_CERT: ((pre_dev_cf_lb_cert.certificate))
        BBL_LB_KEY: ((pre_dev_cf_lb_cert.private_key))
        LB_DOMAIN: pre-dev.test.relint.rocks
      input_mapping:
        bbl-state: relint-envs
        bbl-config: relint-envs
      ensure:
        put: relint-envs
        params:
          repository: updated-bbl-state
          rebase: true
    - task: add-gcp-dns
      file: runtime-ci/tasks/manage-gcp-dns/task.yml
      input_mapping:
        bbl-state: relint-envs
      params:
        BBL_STATE_DIR: environments/test/pre-dev/bbl-state
        GCP_DNS_SERVICE_ACCOUNT_KEY: ((concourse_gcp_service_account_json))
        GCP_DNS_ZONE_NAME: test-relint-rocks
        GCP_DNS_RECORD_SET_NAME: pre-dev.test.relint.rocks
        ACTION: add
    - do:
      - task: deploy-cf
        file: cf-deployment-concourse-tasks/bosh-deploy/task.yml
        input_mapping:
          bbl-state: relint-envs
          cf-deployment: updated-cf-deployment-cf-networking-release-candidate
          ops-files: updated-cf-deployment-cf-networking-release-candidate
          vars-files: relint-envs
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
          SYSTEM_DOMAIN: pre-dev.test.relint.rocks
          OPS_FILES: |
            operations/experimental/fast-deploy-with-downtime-and-danger.yml
          REGENERATE_CREDENTIALS: false
          BOSH_DEPLOY_ARGS: --parallel 50
      - task: run-errand-smoke-tests
        file: cf-deployment-concourse-tasks/run-errand/task.yml
        input_mapping:
          bbl-state: relint-envs
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
          ERRAND_NAME: smoke-tests
      - task: export-compiled-release-cf-networking
        file: runtime-ci/tasks/export-compiled-release-tarball/task.yml
        input_mapping:
          bbl-state: relint-envs
          manifest: updated-cf-deployment-cf-networking-release-candidate
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
          RELEASE_NAME: cf-networking
      - task: update-release-cf-networking-develop
        file: runtime-ci/tasks/update-single-manifest-release/task.yml
        input_mapping:
          deployment-configuration: cf-deployment-develop
          release: cf-networking-release
        output_mapping:
          updated-deployment-manifest: updated-cf-deployment-cf-networking-develop
        params:
          RELEASE_NAME: cf-networking
      - task: update-additional-ops-files-cf-networking-develop
        file: runtime-ci/tasks/update-single-opsfile-release/task.yml
        input_mapping:
          original-ops-file: updated-cf-deployment-cf-networking-develop
          release: cf-networking-release
        output_mapping:
          updated-ops-file: updated-cf-deployment-cf-networking-develop
        params:
          RELEASE_NAME: cf-networking
      - task: update-compiled-releases-ops-file-cf-networking-develop
        file: runtime-ci/tasks/update-single-compiled-release/task.yml
        input_mapping:
          original-compiled-releases-ops-file: updated-cf-deployment-cf-networking-develop
          release: cf-networking-release
        output_mapping:
          updated-compiled-releases-ops-file: updated-cf-deployment-cf-networking-develop
        params:
          RELEASE_NAME: cf-networking
          ORIGINAL_OPS_FILE_PATH: operations/use-compiled-releases.yml
          UPDATED_OPS_FILE_PATH: operations/use-compiled-releases.yml
      on_success:
        do:
        - put: cf-networking-release-gcs
          params:
            file: compiled-release-tarball/*.tgz
            predefined_acl: publicRead
        - put: cf-deployment-develop
          params:
            rebase: true
            repository: updated-cf-deployment-cf-networking-develop
      on_failure:
        do:
        - task: push-to-release-branch
          file: runtime-ci/tasks/push-to-release-branch/task.yml
          input_mapping:
            updated-cf-deployment: updated-cf-deployment-cf-networking-release-candidate
            release: cf-networking-release
          params:
            DEPLOY_KEY: ((cf_deployment_readwrite_deploy_key.private_key))
            RELEASE_NAME: cf-networking
        - task: retrieve-bosh-logs
          file: runtime-ci/tasks/retrieve-bosh-logs/task.yml
          input_mapping:
            bbl-state: relint-envs
          params:
            BBL_STATE_DIR: environments/test/pre-dev/bbl-state
        - put: cf-networking-component-bump-logs-gcs
          params:
            file: bosh-logs/cf-*.tgz
        ensure:
          do:
          - task: create-slack-message
            file: runtime-ci/tasks/create-slack-message/task.yml
            input_mapping:
              release: cf-networking-release
            params:
              RELEASE_NAME: cf-networking
              REPOSITORY: cloudfoundry/cf-networking-release
              BOSH_LOGS_PREFIX: https://storage.cloud.google.com/component-bump-logs/cf-networking
          - put: slack-alert
            params:
              text_file: slack-message/message.txt
              username: Release Integration
              icon_emoji: ':cloudfoundrylogo:'
    ensure:
      do:
      - task: delete-deployment
        file: cf-deployment-concourse-tasks/bosh-delete-deployment/task.yml
        input_mapping:
          bbl-state: relint-envs
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
      - task: remove-gcp-dns
        file: runtime-ci/tasks/manage-gcp-dns/task.yml
        input_mapping:
          bbl-state: relint-envs
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
          GCP_DNS_SERVICE_ACCOUNT_KEY: ((concourse_gcp_service_account_json))
          GCP_DNS_ZONE_NAME: test-relint-rocks
          GCP_DNS_RECORD_SET_NAME: pre-dev.test.relint.rocks
          ACTION: remove
      - task: bbl-down
        file: cf-deployment-concourse-tasks/bbl-destroy/task.yml
        input_mapping:
          bbl-state: relint-envs
        params:
          BBL_GCP_SERVICE_ACCOUNT_KEY: environments/test/pre-dev/google_account_creds.json
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
        ensure:
          put: relint-envs
          params:
            repository: updated-bbl-state
            rebase: true
- name: update-cf-smoke-tests
  serial_groups:
  - update-release
  public: true
  plan:
  - aggregate:
    - get: cf-smoke-tests-release
      trigger: true
      params:
        tarball: false
    - get: cf-deployment-release-candidate
    - get: cf-deployment-develop
    - get: stemcell
      params:
        tarball: false
    - get: cf-deployment-concourse-tasks
    - get: runtime-ci
    - get: relint-envs
    - get: relint-team
  - task: update-release-cf-smoke-tests-release-candidate
    file: runtime-ci/tasks/update-single-manifest-release/task.yml
    input_mapping:
      deployment-configuration: cf-deployment-release-candidate
      release: cf-smoke-tests-release
    output_mapping:
      updated-deployment-manifest: updated-cf-deployment-cf-smoke-tests-release-candidate
    params:
      RELEASE_NAME: cf-smoke-tests
  - task: update-additional-ops-files-cf-smoke-tests-release-candidate
    file: runtime-ci/tasks/update-single-opsfile-release/task.yml
    input_mapping:
      original-ops-file: updated-cf-deployment-cf-smoke-tests-release-candidate
      release: cf-smoke-tests-release
    output_mapping:
      updated-ops-file: updated-cf-deployment-cf-smoke-tests-release-candidate
    params:
      RELEASE_NAME: cf-smoke-tests
  - do:
    - task: bbl-up
      file: cf-deployment-concourse-tasks/bbl-up/task.yml
      params:
        BBL_STATE_DIR: environments/test/pre-dev/bbl-state
        BBL_IAAS: gcp
        BBL_ENV_NAME: pre-dev
        BBL_GCP_SERVICE_ACCOUNT_KEY: environments/test/pre-dev/google_account_creds.json
        BBL_GCP_REGION: us-central1
        BBL_LB_CERT: ((pre_dev_cf_lb_cert.certificate))
        BBL_LB_KEY: ((pre_dev_cf_lb_cert.private_key))
        LB_DOMAIN: pre-dev.test.relint.rocks
      input_mapping:
        bbl-state: relint-envs
        bbl-config: relint-envs
      ensure:
        put: relint-envs
        params:
          repository: updated-bbl-state
          rebase: true
    - task: add-gcp-dns
      file: runtime-ci/tasks/manage-gcp-dns/task.yml
      input_mapping:
        bbl-state: relint-envs
      params:
        BBL_STATE_DIR: environments/test/pre-dev/bbl-state
        GCP_DNS_SERVICE_ACCOUNT_KEY: ((concourse_gcp_service_account_json))
        GCP_DNS_ZONE_NAME: test-relint-rocks
        GCP_DNS_RECORD_SET_NAME: pre-dev.test.relint.rocks
        ACTION: add
    - do:
      - task: deploy-cf
        file: cf-deployment-concourse-tasks/bosh-deploy/task.yml
        input_mapping:
          bbl-state: relint-envs
          cf-deployment: updated-cf-deployment-cf-smoke-tests-release-candidate
          ops-files: updated-cf-deployment-cf-smoke-tests-release-candidate
          vars-files: relint-envs
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
          SYSTEM_DOMAIN: pre-dev.test.relint.rocks
          OPS_FILES: |
            operations/experimental/fast-deploy-with-downtime-and-danger.yml
          REGENERATE_CREDENTIALS: false
          BOSH_DEPLOY_ARGS: --parallel 50
      - task: run-errand-smoke-tests
        file: cf-deployment-concourse-tasks/run-errand/task.yml
        input_mapping:
          bbl-state: relint-envs
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
          ERRAND_NAME: smoke-tests
      - task: export-compiled-release-cf-smoke-tests
        file: runtime-ci/tasks/export-compiled-release-tarball/task.yml
        input_mapping:
          bbl-state: relint-envs
          manifest: updated-cf-deployment-cf-smoke-tests-release-candidate
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
          RELEASE_NAME: cf-smoke-tests
      - task: update-release-cf-smoke-tests-develop
        file: runtime-ci/tasks/update-single-manifest-release/task.yml
        input_mapping:
          deployment-configuration: cf-deployment-develop
          release: cf-smoke-tests-release
        output_mapping:
          updated-deployment-manifest: updated-cf-deployment-cf-smoke-tests-develop
        params:
          RELEASE_NAME: cf-smoke-tests
      - task: update-additional-ops-files-cf-smoke-tests-develop
        file: runtime-ci/tasks/update-single-opsfile-release/task.yml
        input_mapping:
          original-ops-file: updated-cf-deployment-cf-smoke-tests-develop
          release: cf-smoke-tests-release
        output_mapping:
          updated-ops-file: updated-cf-deployment-cf-smoke-tests-develop
        params:
          RELEASE_NAME: cf-smoke-tests
      - task: update-compiled-releases-ops-file-cf-smoke-tests-develop
        file: runtime-ci/tasks/update-single-compiled-release/task.yml
        input_mapping:
          original-compiled-releases-ops-file: updated-cf-deployment-cf-smoke-tests-develop
          release: cf-smoke-tests-release
        output_mapping:
          updated-compiled-releases-ops-file: updated-cf-deployment-cf-smoke-tests-develop
        params:
          RELEASE_NAME: cf-smoke-tests
          ORIGINAL_OPS_FILE_PATH: operations/use-compiled-releases.yml
          UPDATED_OPS_FILE_PATH: operations/use-compiled-releases.yml
      on_success:
        do:
        - put: cf-smoke-tests-release-gcs
          params:
            file: compiled-release-tarball/*.tgz
            predefined_acl: publicRead
        - put: cf-deployment-develop
          params:
            rebase: true
            repository: updated-cf-deployment-cf-smoke-tests-develop
      on_failure:
        do:
        - task: push-to-release-branch
          file: runtime-ci/tasks/push-to-release-branch/task.yml
          input_mapping:
            updated-cf-deployment: updated-cf-deployment-cf-smoke-tests-release-candidate
            release: cf-smoke-tests-release
          params:
            DEPLOY_KEY: ((cf_deployment_readwrite_deploy_key.private_key))
            RELEASE_NAME: cf-smoke-tests
        - task: retrieve-bosh-logs
          file: runtime-ci/tasks/retrieve-bosh-logs/task.yml
          input_mapping:
            bbl-state: relint-envs
          params:
            BBL_STATE_DIR: environments/test/pre-dev/bbl-state
        - put: cf-smoke-tests-component-bump-logs-gcs
          params:
            file: bosh-logs/cf-*.tgz
        ensure:
          do:
          - task: create-slack-message
            file: runtime-ci/tasks/create-slack-message/task.yml
            input_mapping:
              release: cf-smoke-tests-release
            params:
              RELEASE_NAME: cf-smoke-tests
              REPOSITORY: cloudfoundry/cf-smoke-tests-release
              BOSH_LOGS_PREFIX: https://storage.cloud.google.com/component-bump-logs/cf-smoke-tests
          - put: slack-alert
            params:
              text_file: slack-message/message.txt
              username: Release Integration
              icon_emoji: ':cloudfoundrylogo:'
    ensure:
      do:
      - task: delete-deployment
        file: cf-deployment-concourse-tasks/bosh-delete-deployment/task.yml
        input_mapping:
          bbl-state: relint-envs
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
      - task: remove-gcp-dns
        file: runtime-ci/tasks/manage-gcp-dns/task.yml
        input_mapping:
          bbl-state: relint-envs
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
          GCP_DNS_SERVICE_ACCOUNT_KEY: ((concourse_gcp_service_account_json))
          GCP_DNS_ZONE_NAME: test-relint-rocks
          GCP_DNS_RECORD_SET_NAME: pre-dev.test.relint.rocks
          ACTION: remove
      - task: bbl-down
        file: cf-deployment-concourse-tasks/bbl-destroy/task.yml
        input_mapping:
          bbl-state: relint-envs
        params:
          BBL_GCP_SERVICE_ACCOUNT_KEY: environments/test/pre-dev/google_account_creds.json
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
        ensure:
          put: relint-envs
          params:
            repository: updated-bbl-state
            rebase: true
- name: update-cf-syslog-drain
  serial_groups:
  - update-release
  public: true
  plan:
  - aggregate:
    - get: cf-syslog-drain-release
      trigger: true
      params:
        tarball: false
    - get: cf-deployment-release-candidate
    - get: cf-deployment-develop
    - get: stemcell
      params:
        tarball: false
    - get: cf-deployment-concourse-tasks
    - get: runtime-ci
    - get: relint-envs
    - get: relint-team
  - task: update-release-cf-syslog-drain-release-candidate
    file: runtime-ci/tasks/update-single-manifest-release/task.yml
    input_mapping:
      deployment-configuration: cf-deployment-release-candidate
      release: cf-syslog-drain-release
    output_mapping:
      updated-deployment-manifest: updated-cf-deployment-cf-syslog-drain-release-candidate
    params:
      RELEASE_NAME: cf-syslog-drain
  - task: update-additional-ops-files-cf-syslog-drain-release-candidate
    file: runtime-ci/tasks/update-single-opsfile-release/task.yml
    input_mapping:
      original-ops-file: updated-cf-deployment-cf-syslog-drain-release-candidate
      release: cf-syslog-drain-release
    output_mapping:
      updated-ops-file: updated-cf-deployment-cf-syslog-drain-release-candidate
    params:
      RELEASE_NAME: cf-syslog-drain
  - do:
    - task: bbl-up
      file: cf-deployment-concourse-tasks/bbl-up/task.yml
      params:
        BBL_STATE_DIR: environments/test/pre-dev/bbl-state
        BBL_IAAS: gcp
        BBL_ENV_NAME: pre-dev
        BBL_GCP_SERVICE_ACCOUNT_KEY: environments/test/pre-dev/google_account_creds.json
        BBL_GCP_REGION: us-central1
        BBL_LB_CERT: ((pre_dev_cf_lb_cert.certificate))
        BBL_LB_KEY: ((pre_dev_cf_lb_cert.private_key))
        LB_DOMAIN: pre-dev.test.relint.rocks
      input_mapping:
        bbl-state: relint-envs
        bbl-config: relint-envs
      ensure:
        put: relint-envs
        params:
          repository: updated-bbl-state
          rebase: true
    - task: add-gcp-dns
      file: runtime-ci/tasks/manage-gcp-dns/task.yml
      input_mapping:
        bbl-state: relint-envs
      params:
        BBL_STATE_DIR: environments/test/pre-dev/bbl-state
        GCP_DNS_SERVICE_ACCOUNT_KEY: ((concourse_gcp_service_account_json))
        GCP_DNS_ZONE_NAME: test-relint-rocks
        GCP_DNS_RECORD_SET_NAME: pre-dev.test.relint.rocks
        ACTION: add
    - do:
      - task: deploy-cf
        file: cf-deployment-concourse-tasks/bosh-deploy/task.yml
        input_mapping:
          bbl-state: relint-envs
          cf-deployment: updated-cf-deployment-cf-syslog-drain-release-candidate
          ops-files: updated-cf-deployment-cf-syslog-drain-release-candidate
          vars-files: relint-envs
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
          SYSTEM_DOMAIN: pre-dev.test.relint.rocks
          OPS_FILES: |
            operations/experimental/fast-deploy-with-downtime-and-danger.yml
          REGENERATE_CREDENTIALS: false
          BOSH_DEPLOY_ARGS: --parallel 50
      - task: run-errand-smoke-tests
        file: cf-deployment-concourse-tasks/run-errand/task.yml
        input_mapping:
          bbl-state: relint-envs
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
          ERRAND_NAME: smoke-tests
      - task: export-compiled-release-cf-syslog-drain
        file: runtime-ci/tasks/export-compiled-release-tarball/task.yml
        input_mapping:
          bbl-state: relint-envs
          manifest: updated-cf-deployment-cf-syslog-drain-release-candidate
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
          RELEASE_NAME: cf-syslog-drain
      - task: update-release-cf-syslog-drain-develop
        file: runtime-ci/tasks/update-single-manifest-release/task.yml
        input_mapping:
          deployment-configuration: cf-deployment-develop
          release: cf-syslog-drain-release
        output_mapping:
          updated-deployment-manifest: updated-cf-deployment-cf-syslog-drain-develop
        params:
          RELEASE_NAME: cf-syslog-drain
      - task: update-additional-ops-files-cf-syslog-drain-develop
        file: runtime-ci/tasks/update-single-opsfile-release/task.yml
        input_mapping:
          original-ops-file: updated-cf-deployment-cf-syslog-drain-develop
          release: cf-syslog-drain-release
        output_mapping:
          updated-ops-file: updated-cf-deployment-cf-syslog-drain-develop
        params:
          RELEASE_NAME: cf-syslog-drain
      - task: update-compiled-releases-ops-file-cf-syslog-drain-develop
        file: runtime-ci/tasks/update-single-compiled-release/task.yml
        input_mapping:
          original-compiled-releases-ops-file: updated-cf-deployment-cf-syslog-drain-develop
          release: cf-syslog-drain-release
        output_mapping:
          updated-compiled-releases-ops-file: updated-cf-deployment-cf-syslog-drain-develop
        params:
          RELEASE_NAME: cf-syslog-drain
          ORIGINAL_OPS_FILE_PATH: operations/use-compiled-releases.yml
          UPDATED_OPS_FILE_PATH: operations/use-compiled-releases.yml
      on_success:
        do:
        - put: cf-syslog-drain-release-gcs
          params:
            file: compiled-release-tarball/*.tgz
            predefined_acl: publicRead
        - put: cf-deployment-develop
          params:
            rebase: true
            repository: updated-cf-deployment-cf-syslog-drain-develop
      on_failure:
        do:
        - task: push-to-release-branch
          file: runtime-ci/tasks/push-to-release-branch/task.yml
          input_mapping:
            updated-cf-deployment: updated-cf-deployment-cf-syslog-drain-release-candidate
            release: cf-syslog-drain-release
          params:
            DEPLOY_KEY: ((cf_deployment_readwrite_deploy_key.private_key))
            RELEASE_NAME: cf-syslog-drain
        - task: retrieve-bosh-logs
          file: runtime-ci/tasks/retrieve-bosh-logs/task.yml
          input_mapping:
            bbl-state: relint-envs
          params:
            BBL_STATE_DIR: environments/test/pre-dev/bbl-state
        - put: cf-syslog-drain-component-bump-logs-gcs
          params:
            file: bosh-logs/cf-*.tgz
        ensure:
          do:
          - task: create-slack-message
            file: runtime-ci/tasks/create-slack-message/task.yml
            input_mapping:
              release: cf-syslog-drain-release
            params:
              RELEASE_NAME: cf-syslog-drain
              REPOSITORY: cloudfoundry/cf-syslog-drain-release
              BOSH_LOGS_PREFIX: https://storage.cloud.google.com/component-bump-logs/cf-syslog-drain
          - put: slack-alert
            params:
              text_file: slack-message/message.txt
              username: Release Integration
              icon_emoji: ':cloudfoundrylogo:'
    ensure:
      do:
      - task: delete-deployment
        file: cf-deployment-concourse-tasks/bosh-delete-deployment/task.yml
        input_mapping:
          bbl-state: relint-envs
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
      - task: remove-gcp-dns
        file: runtime-ci/tasks/manage-gcp-dns/task.yml
        input_mapping:
          bbl-state: relint-envs
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
          GCP_DNS_SERVICE_ACCOUNT_KEY: ((concourse_gcp_service_account_json))
          GCP_DNS_ZONE_NAME: test-relint-rocks
          GCP_DNS_RECORD_SET_NAME: pre-dev.test.relint.rocks
          ACTION: remove
      - task: bbl-down
        file: cf-deployment-concourse-tasks/bbl-destroy/task.yml
        input_mapping:
          bbl-state: relint-envs
        params:
          BBL_GCP_SERVICE_ACCOUNT_KEY: environments/test/pre-dev/google_account_creds.json
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
        ensure:
          put: relint-envs
          params:
            repository: updated-bbl-state
            rebase: true
- name: update-cflinuxfs3
  serial_groups:
  - update-release
  public: true
  plan:
  - aggregate:
    - get: cflinuxfs3-release
      trigger: true
      params:
        tarball: false
    - get: cf-deployment-release-candidate
    - get: cf-deployment-develop
    - get: stemcell
      params:
        tarball: false
    - get: cf-deployment-concourse-tasks
    - get: runtime-ci
    - get: relint-envs
    - get: relint-team
  - task: update-release-cflinuxfs3-release-candidate
    file: runtime-ci/tasks/update-single-manifest-release/task.yml
    input_mapping:
      deployment-configuration: cf-deployment-release-candidate
      release: cflinuxfs3-release
    output_mapping:
      updated-deployment-manifest: updated-cf-deployment-cflinuxfs3-release-candidate
    params:
      RELEASE_NAME: cflinuxfs3
  - task: update-additional-ops-files-cflinuxfs3-release-candidate
    file: runtime-ci/tasks/update-single-opsfile-release/task.yml
    input_mapping:
      original-ops-file: updated-cf-deployment-cflinuxfs3-release-candidate
      release: cflinuxfs3-release
    output_mapping:
      updated-ops-file: updated-cf-deployment-cflinuxfs3-release-candidate
    params:
      RELEASE_NAME: cflinuxfs3
  - do:
    - task: bbl-up
      file: cf-deployment-concourse-tasks/bbl-up/task.yml
      params:
        BBL_STATE_DIR: environments/test/pre-dev/bbl-state
        BBL_IAAS: gcp
        BBL_ENV_NAME: pre-dev
        BBL_GCP_SERVICE_ACCOUNT_KEY: environments/test/pre-dev/google_account_creds.json
        BBL_GCP_REGION: us-central1
        BBL_LB_CERT: ((pre_dev_cf_lb_cert.certificate))
        BBL_LB_KEY: ((pre_dev_cf_lb_cert.private_key))
        LB_DOMAIN: pre-dev.test.relint.rocks
      input_mapping:
        bbl-state: relint-envs
        bbl-config: relint-envs
      ensure:
        put: relint-envs
        params:
          repository: updated-bbl-state
          rebase: true
    - task: add-gcp-dns
      file: runtime-ci/tasks/manage-gcp-dns/task.yml
      input_mapping:
        bbl-state: relint-envs
      params:
        BBL_STATE_DIR: environments/test/pre-dev/bbl-state
        GCP_DNS_SERVICE_ACCOUNT_KEY: ((concourse_gcp_service_account_json))
        GCP_DNS_ZONE_NAME: test-relint-rocks
        GCP_DNS_RECORD_SET_NAME: pre-dev.test.relint.rocks
        ACTION: add
    - do:
      - task: deploy-cf
        file: cf-deployment-concourse-tasks/bosh-deploy/task.yml
        input_mapping:
          bbl-state: relint-envs
          cf-deployment: updated-cf-deployment-cflinuxfs3-release-candidate
          ops-files: updated-cf-deployment-cflinuxfs3-release-candidate
          vars-files: relint-envs
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
          SYSTEM_DOMAIN: pre-dev.test.relint.rocks
          OPS_FILES: |
            operations/experimental/fast-deploy-with-downtime-and-danger.yml
          REGENERATE_CREDENTIALS: false
          BOSH_DEPLOY_ARGS: --parallel 50
      - task: run-errand-smoke-tests
        file: cf-deployment-concourse-tasks/run-errand/task.yml
        input_mapping:
          bbl-state: relint-envs
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
          ERRAND_NAME: smoke-tests
      - task: export-compiled-release-cflinuxfs3
        file: runtime-ci/tasks/export-compiled-release-tarball/task.yml
        input_mapping:
          bbl-state: relint-envs
          manifest: updated-cf-deployment-cflinuxfs3-release-candidate
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
          RELEASE_NAME: cflinuxfs3
      - task: update-release-cflinuxfs3-develop
        file: runtime-ci/tasks/update-single-manifest-release/task.yml
        input_mapping:
          deployment-configuration: cf-deployment-develop
          release: cflinuxfs3-release
        output_mapping:
          updated-deployment-manifest: updated-cf-deployment-cflinuxfs3-develop
        params:
          RELEASE_NAME: cflinuxfs3
      - task: update-additional-ops-files-cflinuxfs3-develop
        file: runtime-ci/tasks/update-single-opsfile-release/task.yml
        input_mapping:
          original-ops-file: updated-cf-deployment-cflinuxfs3-develop
          release: cflinuxfs3-release
        output_mapping:
          updated-ops-file: updated-cf-deployment-cflinuxfs3-develop
        params:
          RELEASE_NAME: cflinuxfs3
      - task: update-compiled-releases-ops-file-cflinuxfs3-develop
        file: runtime-ci/tasks/update-single-compiled-release/task.yml
        input_mapping:
          original-compiled-releases-ops-file: updated-cf-deployment-cflinuxfs3-develop
          release: cflinuxfs3-release
        output_mapping:
          updated-compiled-releases-ops-file: updated-cf-deployment-cflinuxfs3-develop
        params:
          RELEASE_NAME: cflinuxfs3
          ORIGINAL_OPS_FILE_PATH: operations/use-compiled-releases.yml
          UPDATED_OPS_FILE_PATH: operations/use-compiled-releases.yml
      on_success:
        do:
        - put: cflinuxfs3-release-gcs
          params:
            file: compiled-release-tarball/*.tgz
            predefined_acl: publicRead
        - put: cf-deployment-develop
          params:
            rebase: true
            repository: updated-cf-deployment-cflinuxfs3-develop
      on_failure:
        do:
        - task: push-to-release-branch
          file: runtime-ci/tasks/push-to-release-branch/task.yml
          input_mapping:
            updated-cf-deployment: updated-cf-deployment-cflinuxfs3-release-candidate
            release: cflinuxfs3-release
          params:
            DEPLOY_KEY: ((cf_deployment_readwrite_deploy_key.private_key))
            RELEASE_NAME: cflinuxfs3
        - task: retrieve-bosh-logs
          file: runtime-ci/tasks/retrieve-bosh-logs/task.yml
          input_mapping:
            bbl-state: relint-envs
          params:
            BBL_STATE_DIR: environments/test/pre-dev/bbl-state
        - put: cflinuxfs3-component-bump-logs-gcs
          params:
            file: bosh-logs/cf-*.tgz
        ensure:
          do:
          - task: create-slack-message
            file: runtime-ci/tasks/create-slack-message/task.yml
            input_mapping:
              release: cflinuxfs3-release
            params:
              RELEASE_NAME: cflinuxfs3
              REPOSITORY: cloudfoundry/cflinuxfs3-release
              BOSH_LOGS_PREFIX: https://storage.cloud.google.com/component-bump-logs/cflinuxfs3
          - put: slack-alert
            params:
              text_file: slack-message/message.txt
              username: Release Integration
              icon_emoji: ':cloudfoundrylogo:'
    ensure:
      do:
      - task: delete-deployment
        file: cf-deployment-concourse-tasks/bosh-delete-deployment/task.yml
        input_mapping:
          bbl-state: relint-envs
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
      - task: remove-gcp-dns
        file: runtime-ci/tasks/manage-gcp-dns/task.yml
        input_mapping:
          bbl-state: relint-envs
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
          GCP_DNS_SERVICE_ACCOUNT_KEY: ((concourse_gcp_service_account_json))
          GCP_DNS_ZONE_NAME: test-relint-rocks
          GCP_DNS_RECORD_SET_NAME: pre-dev.test.relint.rocks
          ACTION: remove
      - task: bbl-down
        file: cf-deployment-concourse-tasks/bbl-destroy/task.yml
        input_mapping:
          bbl-state: relint-envs
        params:
          BBL_GCP_SERVICE_ACCOUNT_KEY: environments/test/pre-dev/google_account_creds.json
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
        ensure:
          put: relint-envs
          params:
            repository: updated-bbl-state
            rebase: true
- name: update-diego
  serial_groups:
  - update-release
  public: true
  plan:
  - aggregate:
    - get: diego-release
      trigger: true
      params:
        tarball: false
    - get: cf-deployment-release-candidate
    - get: cf-deployment-develop
    - get: stemcell
      params:
        tarball: false
    - get: cf-deployment-concourse-tasks
    - get: runtime-ci
    - get: relint-envs
    - get: relint-team
  - task: update-release-diego-release-candidate
    file: runtime-ci/tasks/update-single-manifest-release/task.yml
    input_mapping:
      deployment-configuration: cf-deployment-release-candidate
      release: diego-release
    output_mapping:
      updated-deployment-manifest: updated-cf-deployment-diego-release-candidate
    params:
      RELEASE_NAME: diego
  - task: update-additional-ops-files-diego-release-candidate
    file: runtime-ci/tasks/update-single-opsfile-release/task.yml
    input_mapping:
      original-ops-file: updated-cf-deployment-diego-release-candidate
      release: diego-release
    output_mapping:
      updated-ops-file: updated-cf-deployment-diego-release-candidate
    params:
      RELEASE_NAME: diego
  - do:
    - task: bbl-up
      file: cf-deployment-concourse-tasks/bbl-up/task.yml
      params:
        BBL_STATE_DIR: environments/test/pre-dev/bbl-state
        BBL_IAAS: gcp
        BBL_ENV_NAME: pre-dev
        BBL_GCP_SERVICE_ACCOUNT_KEY: environments/test/pre-dev/google_account_creds.json
        BBL_GCP_REGION: us-central1
        BBL_LB_CERT: ((pre_dev_cf_lb_cert.certificate))
        BBL_LB_KEY: ((pre_dev_cf_lb_cert.private_key))
        LB_DOMAIN: pre-dev.test.relint.rocks
      input_mapping:
        bbl-state: relint-envs
        bbl-config: relint-envs
      ensure:
        put: relint-envs
        params:
          repository: updated-bbl-state
          rebase: true
    - task: add-gcp-dns
      file: runtime-ci/tasks/manage-gcp-dns/task.yml
      input_mapping:
        bbl-state: relint-envs
      params:
        BBL_STATE_DIR: environments/test/pre-dev/bbl-state
        GCP_DNS_SERVICE_ACCOUNT_KEY: ((concourse_gcp_service_account_json))
        GCP_DNS_ZONE_NAME: test-relint-rocks
        GCP_DNS_RECORD_SET_NAME: pre-dev.test.relint.rocks
        ACTION: add
    - do:
      - task: deploy-cf
        file: cf-deployment-concourse-tasks/bosh-deploy/task.yml
        input_mapping:
          bbl-state: relint-envs
          cf-deployment: updated-cf-deployment-diego-release-candidate
          ops-files: updated-cf-deployment-diego-release-candidate
          vars-files: relint-envs
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
          SYSTEM_DOMAIN: pre-dev.test.relint.rocks
          OPS_FILES: |
            operations/experimental/fast-deploy-with-downtime-and-danger.yml
          REGENERATE_CREDENTIALS: false
          BOSH_DEPLOY_ARGS: --parallel 50
      - task: run-errand-smoke-tests
        file: cf-deployment-concourse-tasks/run-errand/task.yml
        input_mapping:
          bbl-state: relint-envs
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
          ERRAND_NAME: smoke-tests
      - task: export-compiled-release-diego
        file: runtime-ci/tasks/export-compiled-release-tarball/task.yml
        input_mapping:
          bbl-state: relint-envs
          manifest: updated-cf-deployment-diego-release-candidate
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
          RELEASE_NAME: diego
      - task: update-release-diego-develop
        file: runtime-ci/tasks/update-single-manifest-release/task.yml
        input_mapping:
          deployment-configuration: cf-deployment-develop
          release: diego-release
        output_mapping:
          updated-deployment-manifest: updated-cf-deployment-diego-develop
        params:
          RELEASE_NAME: diego
      - task: update-additional-ops-files-diego-develop
        file: runtime-ci/tasks/update-single-opsfile-release/task.yml
        input_mapping:
          original-ops-file: updated-cf-deployment-diego-develop
          release: diego-release
        output_mapping:
          updated-ops-file: updated-cf-deployment-diego-develop
        params:
          RELEASE_NAME: diego
      - task: update-compiled-releases-ops-file-diego-develop
        file: runtime-ci/tasks/update-single-compiled-release/task.yml
        input_mapping:
          original-compiled-releases-ops-file: updated-cf-deployment-diego-develop
          release: diego-release
        output_mapping:
          updated-compiled-releases-ops-file: updated-cf-deployment-diego-develop
        params:
          RELEASE_NAME: diego
          ORIGINAL_OPS_FILE_PATH: operations/use-compiled-releases.yml
          UPDATED_OPS_FILE_PATH: operations/use-compiled-releases.yml
      on_success:
        do:
        - put: diego-release-gcs
          params:
            file: compiled-release-tarball/*.tgz
            predefined_acl: publicRead
        - put: cf-deployment-develop
          params:
            rebase: true
            repository: updated-cf-deployment-diego-develop
      on_failure:
        do:
        - task: push-to-release-branch
          file: runtime-ci/tasks/push-to-release-branch/task.yml
          input_mapping:
            updated-cf-deployment: updated-cf-deployment-diego-release-candidate
            release: diego-release
          params:
            DEPLOY_KEY: ((cf_deployment_readwrite_deploy_key.private_key))
            RELEASE_NAME: diego
        - task: retrieve-bosh-logs
          file: runtime-ci/tasks/retrieve-bosh-logs/task.yml
          input_mapping:
            bbl-state: relint-envs
          params:
            BBL_STATE_DIR: environments/test/pre-dev/bbl-state
        - put: diego-component-bump-logs-gcs
          params:
            file: bosh-logs/cf-*.tgz
        ensure:
          do:
          - task: create-slack-message
            file: runtime-ci/tasks/create-slack-message/task.yml
            input_mapping:
              release: diego-release
            params:
              RELEASE_NAME: diego
              REPOSITORY: cloudfoundry/diego-release
              BOSH_LOGS_PREFIX: https://storage.cloud.google.com/component-bump-logs/diego
          - put: slack-alert
            params:
              text_file: slack-message/message.txt
              username: Release Integration
              icon_emoji: ':cloudfoundrylogo:'
    ensure:
      do:
      - task: delete-deployment
        file: cf-deployment-concourse-tasks/bosh-delete-deployment/task.yml
        input_mapping:
          bbl-state: relint-envs
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
      - task: remove-gcp-dns
        file: runtime-ci/tasks/manage-gcp-dns/task.yml
        input_mapping:
          bbl-state: relint-envs
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
          GCP_DNS_SERVICE_ACCOUNT_KEY: ((concourse_gcp_service_account_json))
          GCP_DNS_ZONE_NAME: test-relint-rocks
          GCP_DNS_RECORD_SET_NAME: pre-dev.test.relint.rocks
          ACTION: remove
      - task: bbl-down
        file: cf-deployment-concourse-tasks/bbl-destroy/task.yml
        input_mapping:
          bbl-state: relint-envs
        params:
          BBL_GCP_SERVICE_ACCOUNT_KEY: environments/test/pre-dev/google_account_creds.json
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
        ensure:
          put: relint-envs
          params:
            repository: updated-bbl-state
            rebase: true
- name: update-dotnet-core-buildpack
  serial_groups:
  - update-release
  public: true
  plan:
  - aggregate:
    - get: dotnet-core-buildpack-release
      trigger: true
      params:
        tarball: false
    - get: cf-deployment-release-candidate
    - get: cf-deployment-develop
    - get: stemcell
      params:
        tarball: false
    - get: cf-deployment-concourse-tasks
    - get: runtime-ci
    - get: relint-envs
    - get: relint-team
  - task: update-release-dotnet-core-buildpack-release-candidate
    file: runtime-ci/tasks/update-single-manifest-release/task.yml
    input_mapping:
      deployment-configuration: cf-deployment-release-candidate
      release: dotnet-core-buildpack-release
    output_mapping:
      updated-deployment-manifest: updated-cf-deployment-dotnet-core-buildpack-release-candidate
    params:
      RELEASE_NAME: dotnet-core-buildpack
  - task: update-additional-ops-files-dotnet-core-buildpack-release-candidate
    file: runtime-ci/tasks/update-single-opsfile-release/task.yml
    input_mapping:
      original-ops-file: updated-cf-deployment-dotnet-core-buildpack-release-candidate
      release: dotnet-core-buildpack-release
    output_mapping:
      updated-ops-file: updated-cf-deployment-dotnet-core-buildpack-release-candidate
    params:
      RELEASE_NAME: dotnet-core-buildpack
  - do:
    - task: bbl-up
      file: cf-deployment-concourse-tasks/bbl-up/task.yml
      params:
        BBL_STATE_DIR: environments/test/pre-dev/bbl-state
        BBL_IAAS: gcp
        BBL_ENV_NAME: pre-dev
        BBL_GCP_SERVICE_ACCOUNT_KEY: environments/test/pre-dev/google_account_creds.json
        BBL_GCP_REGION: us-central1
        BBL_LB_CERT: ((pre_dev_cf_lb_cert.certificate))
        BBL_LB_KEY: ((pre_dev_cf_lb_cert.private_key))
        LB_DOMAIN: pre-dev.test.relint.rocks
      input_mapping:
        bbl-state: relint-envs
        bbl-config: relint-envs
      ensure:
        put: relint-envs
        params:
          repository: updated-bbl-state
          rebase: true
    - task: add-gcp-dns
      file: runtime-ci/tasks/manage-gcp-dns/task.yml
      input_mapping:
        bbl-state: relint-envs
      params:
        BBL_STATE_DIR: environments/test/pre-dev/bbl-state
        GCP_DNS_SERVICE_ACCOUNT_KEY: ((concourse_gcp_service_account_json))
        GCP_DNS_ZONE_NAME: test-relint-rocks
        GCP_DNS_RECORD_SET_NAME: pre-dev.test.relint.rocks
        ACTION: add
    - do:
      - task: deploy-cf
        file: cf-deployment-concourse-tasks/bosh-deploy/task.yml
        input_mapping:
          bbl-state: relint-envs
          cf-deployment: updated-cf-deployment-dotnet-core-buildpack-release-candidate
          ops-files: updated-cf-deployment-dotnet-core-buildpack-release-candidate
          vars-files: relint-envs
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
          SYSTEM_DOMAIN: pre-dev.test.relint.rocks
          OPS_FILES: |
            operations/experimental/fast-deploy-with-downtime-and-danger.yml
          REGENERATE_CREDENTIALS: false
          BOSH_DEPLOY_ARGS: --parallel 50
      - task: run-errand-smoke-tests
        file: cf-deployment-concourse-tasks/run-errand/task.yml
        input_mapping:
          bbl-state: relint-envs
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
          ERRAND_NAME: smoke-tests
      - task: export-compiled-release-dotnet-core-buildpack
        file: runtime-ci/tasks/export-compiled-release-tarball/task.yml
        input_mapping:
          bbl-state: relint-envs
          manifest: updated-cf-deployment-dotnet-core-buildpack-release-candidate
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
          RELEASE_NAME: dotnet-core-buildpack
      - task: update-release-dotnet-core-buildpack-develop
        file: runtime-ci/tasks/update-single-manifest-release/task.yml
        input_mapping:
          deployment-configuration: cf-deployment-develop
          release: dotnet-core-buildpack-release
        output_mapping:
          updated-deployment-manifest: updated-cf-deployment-dotnet-core-buildpack-develop
        params:
          RELEASE_NAME: dotnet-core-buildpack
      - task: update-additional-ops-files-dotnet-core-buildpack-develop
        file: runtime-ci/tasks/update-single-opsfile-release/task.yml
        input_mapping:
          original-ops-file: updated-cf-deployment-dotnet-core-buildpack-develop
          release: dotnet-core-buildpack-release
        output_mapping:
          updated-ops-file: updated-cf-deployment-dotnet-core-buildpack-develop
        params:
          RELEASE_NAME: dotnet-core-buildpack
      - task: update-compiled-releases-ops-file-dotnet-core-buildpack-develop
        file: runtime-ci/tasks/update-single-compiled-release/task.yml
        input_mapping:
          original-compiled-releases-ops-file: updated-cf-deployment-dotnet-core-buildpack-develop
          release: dotnet-core-buildpack-release
        output_mapping:
          updated-compiled-releases-ops-file: updated-cf-deployment-dotnet-core-buildpack-develop
        params:
          RELEASE_NAME: dotnet-core-buildpack
          ORIGINAL_OPS_FILE_PATH: operations/use-compiled-releases.yml
          UPDATED_OPS_FILE_PATH: operations/use-compiled-releases.yml
      on_success:
        do:
        - put: dotnet-core-buildpack-release-gcs
          params:
            file: compiled-release-tarball/*.tgz
            predefined_acl: publicRead
        - put: cf-deployment-develop
          params:
            rebase: true
            repository: updated-cf-deployment-dotnet-core-buildpack-develop
      on_failure:
        do:
        - task: push-to-release-branch
          file: runtime-ci/tasks/push-to-release-branch/task.yml
          input_mapping:
            updated-cf-deployment: updated-cf-deployment-dotnet-core-buildpack-release-candidate
            release: dotnet-core-buildpack-release
          params:
            DEPLOY_KEY: ((cf_deployment_readwrite_deploy_key.private_key))
            RELEASE_NAME: dotnet-core-buildpack
        - task: retrieve-bosh-logs
          file: runtime-ci/tasks/retrieve-bosh-logs/task.yml
          input_mapping:
            bbl-state: relint-envs
          params:
            BBL_STATE_DIR: environments/test/pre-dev/bbl-state
        - put: dotnet-core-buildpack-component-bump-logs-gcs
          params:
            file: bosh-logs/cf-*.tgz
        ensure:
          do:
          - task: create-slack-message
            file: runtime-ci/tasks/create-slack-message/task.yml
            input_mapping:
              release: dotnet-core-buildpack-release
            params:
              RELEASE_NAME: dotnet-core-buildpack
              REPOSITORY: cloudfoundry/dotnet-core-buildpack-release
              BOSH_LOGS_PREFIX: https://storage.cloud.google.com/component-bump-logs/dotnet-core-buildpack
          - put: slack-alert
            params:
              text_file: slack-message/message.txt
              username: Release Integration
              icon_emoji: ':cloudfoundrylogo:'
    ensure:
      do:
      - task: delete-deployment
        file: cf-deployment-concourse-tasks/bosh-delete-deployment/task.yml
        input_mapping:
          bbl-state: relint-envs
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
      - task: remove-gcp-dns
        file: runtime-ci/tasks/manage-gcp-dns/task.yml
        input_mapping:
          bbl-state: relint-envs
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
          GCP_DNS_SERVICE_ACCOUNT_KEY: ((concourse_gcp_service_account_json))
          GCP_DNS_ZONE_NAME: test-relint-rocks
          GCP_DNS_RECORD_SET_NAME: pre-dev.test.relint.rocks
          ACTION: remove
      - task: bbl-down
        file: cf-deployment-concourse-tasks/bbl-destroy/task.yml
        input_mapping:
          bbl-state: relint-envs
        params:
          BBL_GCP_SERVICE_ACCOUNT_KEY: environments/test/pre-dev/google_account_creds.json
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
        ensure:
          put: relint-envs
          params:
            repository: updated-bbl-state
            rebase: true
- name: update-garden-runc
  serial_groups:
  - update-release
  public: true
  plan:
  - aggregate:
    - get: garden-runc-release
      trigger: true
      params:
        tarball: false
    - get: cf-deployment-release-candidate
    - get: cf-deployment-develop
    - get: stemcell
      params:
        tarball: false
    - get: cf-deployment-concourse-tasks
    - get: runtime-ci
    - get: relint-envs
    - get: relint-team
  - task: update-release-garden-runc-release-candidate
    file: runtime-ci/tasks/update-single-manifest-release/task.yml
    input_mapping:
      deployment-configuration: cf-deployment-release-candidate
      release: garden-runc-release
    output_mapping:
      updated-deployment-manifest: updated-cf-deployment-garden-runc-release-candidate
    params:
      RELEASE_NAME: garden-runc
  - task: update-additional-ops-files-garden-runc-release-candidate
    file: runtime-ci/tasks/update-single-opsfile-release/task.yml
    input_mapping:
      original-ops-file: updated-cf-deployment-garden-runc-release-candidate
      release: garden-runc-release
    output_mapping:
      updated-ops-file: updated-cf-deployment-garden-runc-release-candidate
    params:
      RELEASE_NAME: garden-runc
  - do:
    - task: bbl-up
      file: cf-deployment-concourse-tasks/bbl-up/task.yml
      params:
        BBL_STATE_DIR: environments/test/pre-dev/bbl-state
        BBL_IAAS: gcp
        BBL_ENV_NAME: pre-dev
        BBL_GCP_SERVICE_ACCOUNT_KEY: environments/test/pre-dev/google_account_creds.json
        BBL_GCP_REGION: us-central1
        BBL_LB_CERT: ((pre_dev_cf_lb_cert.certificate))
        BBL_LB_KEY: ((pre_dev_cf_lb_cert.private_key))
        LB_DOMAIN: pre-dev.test.relint.rocks
      input_mapping:
        bbl-state: relint-envs
        bbl-config: relint-envs
      ensure:
        put: relint-envs
        params:
          repository: updated-bbl-state
          rebase: true
    - task: add-gcp-dns
      file: runtime-ci/tasks/manage-gcp-dns/task.yml
      input_mapping:
        bbl-state: relint-envs
      params:
        BBL_STATE_DIR: environments/test/pre-dev/bbl-state
        GCP_DNS_SERVICE_ACCOUNT_KEY: ((concourse_gcp_service_account_json))
        GCP_DNS_ZONE_NAME: test-relint-rocks
        GCP_DNS_RECORD_SET_NAME: pre-dev.test.relint.rocks
        ACTION: add
    - do:
      - task: deploy-cf
        file: cf-deployment-concourse-tasks/bosh-deploy/task.yml
        input_mapping:
          bbl-state: relint-envs
          cf-deployment: updated-cf-deployment-garden-runc-release-candidate
          ops-files: updated-cf-deployment-garden-runc-release-candidate
          vars-files: relint-envs
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
          SYSTEM_DOMAIN: pre-dev.test.relint.rocks
          OPS_FILES: |
            operations/experimental/fast-deploy-with-downtime-and-danger.yml
          REGENERATE_CREDENTIALS: false
          BOSH_DEPLOY_ARGS: --parallel 50
      - task: run-errand-smoke-tests
        file: cf-deployment-concourse-tasks/run-errand/task.yml
        input_mapping:
          bbl-state: relint-envs
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
          ERRAND_NAME: smoke-tests
      - task: export-compiled-release-garden-runc
        file: runtime-ci/tasks/export-compiled-release-tarball/task.yml
        input_mapping:
          bbl-state: relint-envs
          manifest: updated-cf-deployment-garden-runc-release-candidate
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
          RELEASE_NAME: garden-runc
      - task: update-release-garden-runc-develop
        file: runtime-ci/tasks/update-single-manifest-release/task.yml
        input_mapping:
          deployment-configuration: cf-deployment-develop
          release: garden-runc-release
        output_mapping:
          updated-deployment-manifest: updated-cf-deployment-garden-runc-develop
        params:
          RELEASE_NAME: garden-runc
      - task: update-additional-ops-files-garden-runc-develop
        file: runtime-ci/tasks/update-single-opsfile-release/task.yml
        input_mapping:
          original-ops-file: updated-cf-deployment-garden-runc-develop
          release: garden-runc-release
        output_mapping:
          updated-ops-file: updated-cf-deployment-garden-runc-develop
        params:
          RELEASE_NAME: garden-runc
      - task: update-compiled-releases-ops-file-garden-runc-develop
        file: runtime-ci/tasks/update-single-compiled-release/task.yml
        input_mapping:
          original-compiled-releases-ops-file: updated-cf-deployment-garden-runc-develop
          release: garden-runc-release
        output_mapping:
          updated-compiled-releases-ops-file: updated-cf-deployment-garden-runc-develop
        params:
          RELEASE_NAME: garden-runc
          ORIGINAL_OPS_FILE_PATH: operations/use-compiled-releases.yml
          UPDATED_OPS_FILE_PATH: operations/use-compiled-releases.yml
      on_success:
        do:
        - put: garden-runc-release-gcs
          params:
            file: compiled-release-tarball/*.tgz
            predefined_acl: publicRead
        - put: cf-deployment-develop
          params:
            rebase: true
            repository: updated-cf-deployment-garden-runc-develop
      on_failure:
        do:
        - task: push-to-release-branch
          file: runtime-ci/tasks/push-to-release-branch/task.yml
          input_mapping:
            updated-cf-deployment: updated-cf-deployment-garden-runc-release-candidate
            release: garden-runc-release
          params:
            DEPLOY_KEY: ((cf_deployment_readwrite_deploy_key.private_key))
            RELEASE_NAME: garden-runc
        - task: retrieve-bosh-logs
          file: runtime-ci/tasks/retrieve-bosh-logs/task.yml
          input_mapping:
            bbl-state: relint-envs
          params:
            BBL_STATE_DIR: environments/test/pre-dev/bbl-state
        - put: garden-runc-component-bump-logs-gcs
          params:
            file: bosh-logs/cf-*.tgz
        ensure:
          do:
          - task: create-slack-message
            file: runtime-ci/tasks/create-slack-message/task.yml
            input_mapping:
              release: garden-runc-release
            params:
              RELEASE_NAME: garden-runc
              REPOSITORY: cloudfoundry/garden-runc-release
              BOSH_LOGS_PREFIX: https://storage.cloud.google.com/component-bump-logs/garden-runc
          - put: slack-alert
            params:
              text_file: slack-message/message.txt
              username: Release Integration
              icon_emoji: ':cloudfoundrylogo:'
    ensure:
      do:
      - task: delete-deployment
        file: cf-deployment-concourse-tasks/bosh-delete-deployment/task.yml
        input_mapping:
          bbl-state: relint-envs
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
      - task: remove-gcp-dns
        file: runtime-ci/tasks/manage-gcp-dns/task.yml
        input_mapping:
          bbl-state: relint-envs
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
          GCP_DNS_SERVICE_ACCOUNT_KEY: ((concourse_gcp_service_account_json))
          GCP_DNS_ZONE_NAME: test-relint-rocks
          GCP_DNS_RECORD_SET_NAME: pre-dev.test.relint.rocks
          ACTION: remove
      - task: bbl-down
        file: cf-deployment-concourse-tasks/bbl-destroy/task.yml
        input_mapping:
          bbl-state: relint-envs
        params:
          BBL_GCP_SERVICE_ACCOUNT_KEY: environments/test/pre-dev/google_account_creds.json
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
        ensure:
          put: relint-envs
          params:
            repository: updated-bbl-state
            rebase: true
- name: update-go-buildpack
  serial_groups:
  - update-release
  public: true
  plan:
  - aggregate:
    - get: go-buildpack-release
      trigger: true
      params:
        tarball: false
    - get: cf-deployment-release-candidate
    - get: cf-deployment-develop
    - get: stemcell
      params:
        tarball: false
    - get: cf-deployment-concourse-tasks
    - get: runtime-ci
    - get: relint-envs
    - get: relint-team
  - task: update-release-go-buildpack-release-candidate
    file: runtime-ci/tasks/update-single-manifest-release/task.yml
    input_mapping:
      deployment-configuration: cf-deployment-release-candidate
      release: go-buildpack-release
    output_mapping:
      updated-deployment-manifest: updated-cf-deployment-go-buildpack-release-candidate
    params:
      RELEASE_NAME: go-buildpack
  - task: update-additional-ops-files-go-buildpack-release-candidate
    file: runtime-ci/tasks/update-single-opsfile-release/task.yml
    input_mapping:
      original-ops-file: updated-cf-deployment-go-buildpack-release-candidate
      release: go-buildpack-release
    output_mapping:
      updated-ops-file: updated-cf-deployment-go-buildpack-release-candidate
    params:
      RELEASE_NAME: go-buildpack
  - do:
    - task: bbl-up
      file: cf-deployment-concourse-tasks/bbl-up/task.yml
      params:
        BBL_STATE_DIR: environments/test/pre-dev/bbl-state
        BBL_IAAS: gcp
        BBL_ENV_NAME: pre-dev
        BBL_GCP_SERVICE_ACCOUNT_KEY: environments/test/pre-dev/google_account_creds.json
        BBL_GCP_REGION: us-central1
        BBL_LB_CERT: ((pre_dev_cf_lb_cert.certificate))
        BBL_LB_KEY: ((pre_dev_cf_lb_cert.private_key))
        LB_DOMAIN: pre-dev.test.relint.rocks
      input_mapping:
        bbl-state: relint-envs
        bbl-config: relint-envs
      ensure:
        put: relint-envs
        params:
          repository: updated-bbl-state
          rebase: true
    - task: add-gcp-dns
      file: runtime-ci/tasks/manage-gcp-dns/task.yml
      input_mapping:
        bbl-state: relint-envs
      params:
        BBL_STATE_DIR: environments/test/pre-dev/bbl-state
        GCP_DNS_SERVICE_ACCOUNT_KEY: ((concourse_gcp_service_account_json))
        GCP_DNS_ZONE_NAME: test-relint-rocks
        GCP_DNS_RECORD_SET_NAME: pre-dev.test.relint.rocks
        ACTION: add
    - do:
      - task: deploy-cf
        file: cf-deployment-concourse-tasks/bosh-deploy/task.yml
        input_mapping:
          bbl-state: relint-envs
          cf-deployment: updated-cf-deployment-go-buildpack-release-candidate
          ops-files: updated-cf-deployment-go-buildpack-release-candidate
          vars-files: relint-envs
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
          SYSTEM_DOMAIN: pre-dev.test.relint.rocks
          OPS_FILES: |
            operations/experimental/fast-deploy-with-downtime-and-danger.yml
          REGENERATE_CREDENTIALS: false
          BOSH_DEPLOY_ARGS: --parallel 50
      - task: run-errand-smoke-tests
        file: cf-deployment-concourse-tasks/run-errand/task.yml
        input_mapping:
          bbl-state: relint-envs
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
          ERRAND_NAME: smoke-tests
      - task: export-compiled-release-go-buildpack
        file: runtime-ci/tasks/export-compiled-release-tarball/task.yml
        input_mapping:
          bbl-state: relint-envs
          manifest: updated-cf-deployment-go-buildpack-release-candidate
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
          RELEASE_NAME: go-buildpack
      - task: update-release-go-buildpack-develop
        file: runtime-ci/tasks/update-single-manifest-release/task.yml
        input_mapping:
          deployment-configuration: cf-deployment-develop
          release: go-buildpack-release
        output_mapping:
          updated-deployment-manifest: updated-cf-deployment-go-buildpack-develop
        params:
          RELEASE_NAME: go-buildpack
      - task: update-additional-ops-files-go-buildpack-develop
        file: runtime-ci/tasks/update-single-opsfile-release/task.yml
        input_mapping:
          original-ops-file: updated-cf-deployment-go-buildpack-develop
          release: go-buildpack-release
        output_mapping:
          updated-ops-file: updated-cf-deployment-go-buildpack-develop
        params:
          RELEASE_NAME: go-buildpack
      - task: update-compiled-releases-ops-file-go-buildpack-develop
        file: runtime-ci/tasks/update-single-compiled-release/task.yml
        input_mapping:
          original-compiled-releases-ops-file: updated-cf-deployment-go-buildpack-develop
          release: go-buildpack-release
        output_mapping:
          updated-compiled-releases-ops-file: updated-cf-deployment-go-buildpack-develop
        params:
          RELEASE_NAME: go-buildpack
          ORIGINAL_OPS_FILE_PATH: operations/use-compiled-releases.yml
          UPDATED_OPS_FILE_PATH: operations/use-compiled-releases.yml
      on_success:
        do:
        - put: go-buildpack-release-gcs
          params:
            file: compiled-release-tarball/*.tgz
            predefined_acl: publicRead
        - put: cf-deployment-develop
          params:
            rebase: true
            repository: updated-cf-deployment-go-buildpack-develop
      on_failure:
        do:
        - task: push-to-release-branch
          file: runtime-ci/tasks/push-to-release-branch/task.yml
          input_mapping:
            updated-cf-deployment: updated-cf-deployment-go-buildpack-release-candidate
            release: go-buildpack-release
          params:
            DEPLOY_KEY: ((cf_deployment_readwrite_deploy_key.private_key))
            RELEASE_NAME: go-buildpack
        - task: retrieve-bosh-logs
          file: runtime-ci/tasks/retrieve-bosh-logs/task.yml
          input_mapping:
            bbl-state: relint-envs
          params:
            BBL_STATE_DIR: environments/test/pre-dev/bbl-state
        - put: go-buildpack-component-bump-logs-gcs
          params:
            file: bosh-logs/cf-*.tgz
        ensure:
          do:
          - task: create-slack-message
            file: runtime-ci/tasks/create-slack-message/task.yml
            input_mapping:
              release: go-buildpack-release
            params:
              RELEASE_NAME: go-buildpack
              REPOSITORY: cloudfoundry/go-buildpack-release
              BOSH_LOGS_PREFIX: https://storage.cloud.google.com/component-bump-logs/go-buildpack
          - put: slack-alert
            params:
              text_file: slack-message/message.txt
              username: Release Integration
              icon_emoji: ':cloudfoundrylogo:'
    ensure:
      do:
      - task: delete-deployment
        file: cf-deployment-concourse-tasks/bosh-delete-deployment/task.yml
        input_mapping:
          bbl-state: relint-envs
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
      - task: remove-gcp-dns
        file: runtime-ci/tasks/manage-gcp-dns/task.yml
        input_mapping:
          bbl-state: relint-envs
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
          GCP_DNS_SERVICE_ACCOUNT_KEY: ((concourse_gcp_service_account_json))
          GCP_DNS_ZONE_NAME: test-relint-rocks
          GCP_DNS_RECORD_SET_NAME: pre-dev.test.relint.rocks
          ACTION: remove
      - task: bbl-down
        file: cf-deployment-concourse-tasks/bbl-destroy/task.yml
        input_mapping:
          bbl-state: relint-envs
        params:
          BBL_GCP_SERVICE_ACCOUNT_KEY: environments/test/pre-dev/google_account_creds.json
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
        ensure:
          put: relint-envs
          params:
            repository: updated-bbl-state
            rebase: true
- name: update-java-buildpack
  serial_groups:
  - update-release
  public: true
  plan:
  - aggregate:
    - get: java-buildpack-release
      trigger: true
      params:
        tarball: false
    - get: cf-deployment-release-candidate
    - get: cf-deployment-develop
    - get: stemcell
      params:
        tarball: false
    - get: cf-deployment-concourse-tasks
    - get: runtime-ci
    - get: relint-envs
    - get: relint-team
  - task: update-release-java-buildpack-release-candidate
    file: runtime-ci/tasks/update-single-manifest-release/task.yml
    input_mapping:
      deployment-configuration: cf-deployment-release-candidate
      release: java-buildpack-release
    output_mapping:
      updated-deployment-manifest: updated-cf-deployment-java-buildpack-release-candidate
    params:
      RELEASE_NAME: java-buildpack
  - task: update-additional-ops-files-java-buildpack-release-candidate
    file: runtime-ci/tasks/update-single-opsfile-release/task.yml
    input_mapping:
      original-ops-file: updated-cf-deployment-java-buildpack-release-candidate
      release: java-buildpack-release
    output_mapping:
      updated-ops-file: updated-cf-deployment-java-buildpack-release-candidate
    params:
      RELEASE_NAME: java-buildpack
  - do:
    - task: bbl-up
      file: cf-deployment-concourse-tasks/bbl-up/task.yml
      params:
        BBL_STATE_DIR: environments/test/pre-dev/bbl-state
        BBL_IAAS: gcp
        BBL_ENV_NAME: pre-dev
        BBL_GCP_SERVICE_ACCOUNT_KEY: environments/test/pre-dev/google_account_creds.json
        BBL_GCP_REGION: us-central1
        BBL_LB_CERT: ((pre_dev_cf_lb_cert.certificate))
        BBL_LB_KEY: ((pre_dev_cf_lb_cert.private_key))
        LB_DOMAIN: pre-dev.test.relint.rocks
      input_mapping:
        bbl-state: relint-envs
        bbl-config: relint-envs
      ensure:
        put: relint-envs
        params:
          repository: updated-bbl-state
          rebase: true
    - task: add-gcp-dns
      file: runtime-ci/tasks/manage-gcp-dns/task.yml
      input_mapping:
        bbl-state: relint-envs
      params:
        BBL_STATE_DIR: environments/test/pre-dev/bbl-state
        GCP_DNS_SERVICE_ACCOUNT_KEY: ((concourse_gcp_service_account_json))
        GCP_DNS_ZONE_NAME: test-relint-rocks
        GCP_DNS_RECORD_SET_NAME: pre-dev.test.relint.rocks
        ACTION: add
    - do:
      - task: deploy-cf
        file: cf-deployment-concourse-tasks/bosh-deploy/task.yml
        input_mapping:
          bbl-state: relint-envs
          cf-deployment: updated-cf-deployment-java-buildpack-release-candidate
          ops-files: updated-cf-deployment-java-buildpack-release-candidate
          vars-files: relint-envs
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
          SYSTEM_DOMAIN: pre-dev.test.relint.rocks
          OPS_FILES: |
            operations/experimental/fast-deploy-with-downtime-and-danger.yml
          REGENERATE_CREDENTIALS: false
          BOSH_DEPLOY_ARGS: --parallel 50
      - task: run-errand-smoke-tests
        file: cf-deployment-concourse-tasks/run-errand/task.yml
        input_mapping:
          bbl-state: relint-envs
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
          ERRAND_NAME: smoke-tests
      - task: export-compiled-release-java-buildpack
        file: runtime-ci/tasks/export-compiled-release-tarball/task.yml
        input_mapping:
          bbl-state: relint-envs
          manifest: updated-cf-deployment-java-buildpack-release-candidate
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
          RELEASE_NAME: java-buildpack
      - task: update-release-java-buildpack-develop
        file: runtime-ci/tasks/update-single-manifest-release/task.yml
        input_mapping:
          deployment-configuration: cf-deployment-develop
          release: java-buildpack-release
        output_mapping:
          updated-deployment-manifest: updated-cf-deployment-java-buildpack-develop
        params:
          RELEASE_NAME: java-buildpack
      - task: update-additional-ops-files-java-buildpack-develop
        file: runtime-ci/tasks/update-single-opsfile-release/task.yml
        input_mapping:
          original-ops-file: updated-cf-deployment-java-buildpack-develop
          release: java-buildpack-release
        output_mapping:
          updated-ops-file: updated-cf-deployment-java-buildpack-develop
        params:
          RELEASE_NAME: java-buildpack
      - task: update-compiled-releases-ops-file-java-buildpack-develop
        file: runtime-ci/tasks/update-single-compiled-release/task.yml
        input_mapping:
          original-compiled-releases-ops-file: updated-cf-deployment-java-buildpack-develop
          release: java-buildpack-release
        output_mapping:
          updated-compiled-releases-ops-file: updated-cf-deployment-java-buildpack-develop
        params:
          RELEASE_NAME: java-buildpack
          ORIGINAL_OPS_FILE_PATH: operations/use-compiled-releases.yml
          UPDATED_OPS_FILE_PATH: operations/use-compiled-releases.yml
      on_success:
        do:
        - put: java-buildpack-release-gcs
          params:
            file: compiled-release-tarball/*.tgz
            predefined_acl: publicRead
        - put: cf-deployment-develop
          params:
            rebase: true
            repository: updated-cf-deployment-java-buildpack-develop
      on_failure:
        do:
        - task: push-to-release-branch
          file: runtime-ci/tasks/push-to-release-branch/task.yml
          input_mapping:
            updated-cf-deployment: updated-cf-deployment-java-buildpack-release-candidate
            release: java-buildpack-release
          params:
            DEPLOY_KEY: ((cf_deployment_readwrite_deploy_key.private_key))
            RELEASE_NAME: java-buildpack
        - task: retrieve-bosh-logs
          file: runtime-ci/tasks/retrieve-bosh-logs/task.yml
          input_mapping:
            bbl-state: relint-envs
          params:
            BBL_STATE_DIR: environments/test/pre-dev/bbl-state
        - put: java-buildpack-component-bump-logs-gcs
          params:
            file: bosh-logs/cf-*.tgz
        ensure:
          do:
          - task: create-slack-message
            file: runtime-ci/tasks/create-slack-message/task.yml
            input_mapping:
              release: java-buildpack-release
            params:
              RELEASE_NAME: java-buildpack
              REPOSITORY: cloudfoundry/java-buildpack-release
              BOSH_LOGS_PREFIX: https://storage.cloud.google.com/component-bump-logs/java-buildpack
          - put: slack-alert
            params:
              text_file: slack-message/message.txt
              username: Release Integration
              icon_emoji: ':cloudfoundrylogo:'
    ensure:
      do:
      - task: delete-deployment
        file: cf-deployment-concourse-tasks/bosh-delete-deployment/task.yml
        input_mapping:
          bbl-state: relint-envs
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
      - task: remove-gcp-dns
        file: runtime-ci/tasks/manage-gcp-dns/task.yml
        input_mapping:
          bbl-state: relint-envs
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
          GCP_DNS_SERVICE_ACCOUNT_KEY: ((concourse_gcp_service_account_json))
          GCP_DNS_ZONE_NAME: test-relint-rocks
          GCP_DNS_RECORD_SET_NAME: pre-dev.test.relint.rocks
          ACTION: remove
      - task: bbl-down
        file: cf-deployment-concourse-tasks/bbl-destroy/task.yml
        input_mapping:
          bbl-state: relint-envs
        params:
          BBL_GCP_SERVICE_ACCOUNT_KEY: environments/test/pre-dev/google_account_creds.json
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
        ensure:
          put: relint-envs
          params:
            repository: updated-bbl-state
            rebase: true
- name: update-log-cache
  serial_groups:
  - update-release
  public: true
  plan:
  - aggregate:
    - get: log-cache-release
      trigger: true
      params:
        tarball: false
    - get: cf-deployment-release-candidate
    - get: cf-deployment-develop
    - get: stemcell
      params:
        tarball: false
    - get: cf-deployment-concourse-tasks
    - get: runtime-ci
    - get: relint-envs
    - get: relint-team
  - task: update-release-log-cache-release-candidate
    file: runtime-ci/tasks/update-single-manifest-release/task.yml
    input_mapping:
      deployment-configuration: cf-deployment-release-candidate
      release: log-cache-release
    output_mapping:
      updated-deployment-manifest: updated-cf-deployment-log-cache-release-candidate
    params:
      RELEASE_NAME: log-cache
  - task: update-additional-ops-files-log-cache-release-candidate
    file: runtime-ci/tasks/update-single-opsfile-release/task.yml
    input_mapping:
      original-ops-file: updated-cf-deployment-log-cache-release-candidate
      release: log-cache-release
    output_mapping:
      updated-ops-file: updated-cf-deployment-log-cache-release-candidate
    params:
      RELEASE_NAME: log-cache
  - do:
    - task: bbl-up
      file: cf-deployment-concourse-tasks/bbl-up/task.yml
      params:
        BBL_STATE_DIR: environments/test/pre-dev/bbl-state
        BBL_IAAS: gcp
        BBL_ENV_NAME: pre-dev
        BBL_GCP_SERVICE_ACCOUNT_KEY: environments/test/pre-dev/google_account_creds.json
        BBL_GCP_REGION: us-central1
        BBL_LB_CERT: ((pre_dev_cf_lb_cert.certificate))
        BBL_LB_KEY: ((pre_dev_cf_lb_cert.private_key))
        LB_DOMAIN: pre-dev.test.relint.rocks
      input_mapping:
        bbl-state: relint-envs
        bbl-config: relint-envs
      ensure:
        put: relint-envs
        params:
          repository: updated-bbl-state
          rebase: true
    - task: add-gcp-dns
      file: runtime-ci/tasks/manage-gcp-dns/task.yml
      input_mapping:
        bbl-state: relint-envs
      params:
        BBL_STATE_DIR: environments/test/pre-dev/bbl-state
        GCP_DNS_SERVICE_ACCOUNT_KEY: ((concourse_gcp_service_account_json))
        GCP_DNS_ZONE_NAME: test-relint-rocks
        GCP_DNS_RECORD_SET_NAME: pre-dev.test.relint.rocks
        ACTION: add
    - do:
      - task: deploy-cf
        file: cf-deployment-concourse-tasks/bosh-deploy/task.yml
        input_mapping:
          bbl-state: relint-envs
          cf-deployment: updated-cf-deployment-log-cache-release-candidate
          ops-files: updated-cf-deployment-log-cache-release-candidate
          vars-files: relint-envs
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
          SYSTEM_DOMAIN: pre-dev.test.relint.rocks
          OPS_FILES: |
            operations/experimental/fast-deploy-with-downtime-and-danger.yml
          REGENERATE_CREDENTIALS: false
          BOSH_DEPLOY_ARGS: --parallel 50
      - task: run-errand-smoke-tests
        file: cf-deployment-concourse-tasks/run-errand/task.yml
        input_mapping:
          bbl-state: relint-envs
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
          ERRAND_NAME: smoke-tests
      - task: export-compiled-release-log-cache
        file: runtime-ci/tasks/export-compiled-release-tarball/task.yml
        input_mapping:
          bbl-state: relint-envs
          manifest: updated-cf-deployment-log-cache-release-candidate
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
          RELEASE_NAME: log-cache
      - task: update-release-log-cache-develop
        file: runtime-ci/tasks/update-single-manifest-release/task.yml
        input_mapping:
          deployment-configuration: cf-deployment-develop
          release: log-cache-release
        output_mapping:
          updated-deployment-manifest: updated-cf-deployment-log-cache-develop
        params:
          RELEASE_NAME: log-cache
      - task: update-additional-ops-files-log-cache-develop
        file: runtime-ci/tasks/update-single-opsfile-release/task.yml
        input_mapping:
          original-ops-file: updated-cf-deployment-log-cache-develop
          release: log-cache-release
        output_mapping:
          updated-ops-file: updated-cf-deployment-log-cache-develop
        params:
          RELEASE_NAME: log-cache
      - task: update-compiled-releases-ops-file-log-cache-develop
        file: runtime-ci/tasks/update-single-compiled-release/task.yml
        input_mapping:
          original-compiled-releases-ops-file: updated-cf-deployment-log-cache-develop
          release: log-cache-release
        output_mapping:
          updated-compiled-releases-ops-file: updated-cf-deployment-log-cache-develop
        params:
          RELEASE_NAME: log-cache
          ORIGINAL_OPS_FILE_PATH: operations/use-compiled-releases.yml
          UPDATED_OPS_FILE_PATH: operations/use-compiled-releases.yml
      on_success:
        do:
        - put: log-cache-release-gcs
          params:
            file: compiled-release-tarball/*.tgz
            predefined_acl: publicRead
        - put: cf-deployment-develop
          params:
            rebase: true
            repository: updated-cf-deployment-log-cache-develop
      on_failure:
        do:
        - task: push-to-release-branch
          file: runtime-ci/tasks/push-to-release-branch/task.yml
          input_mapping:
            updated-cf-deployment: updated-cf-deployment-log-cache-release-candidate
            release: log-cache-release
          params:
            DEPLOY_KEY: ((cf_deployment_readwrite_deploy_key.private_key))
            RELEASE_NAME: log-cache
        - task: retrieve-bosh-logs
          file: runtime-ci/tasks/retrieve-bosh-logs/task.yml
          input_mapping:
            bbl-state: relint-envs
          params:
            BBL_STATE_DIR: environments/test/pre-dev/bbl-state
        - put: log-cache-component-bump-logs-gcs
          params:
            file: bosh-logs/cf-*.tgz
        ensure:
          do:
          - task: create-slack-message
            file: runtime-ci/tasks/create-slack-message/task.yml
            input_mapping:
              release: log-cache-release
            params:
              RELEASE_NAME: log-cache
              REPOSITORY: cloudfoundry/log-cache-release
              BOSH_LOGS_PREFIX: https://storage.cloud.google.com/component-bump-logs/log-cache
          - put: slack-alert
            params:
              text_file: slack-message/message.txt
              username: Release Integration
              icon_emoji: ':cloudfoundrylogo:'
    ensure:
      do:
      - task: delete-deployment
        file: cf-deployment-concourse-tasks/bosh-delete-deployment/task.yml
        input_mapping:
          bbl-state: relint-envs
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
      - task: remove-gcp-dns
        file: runtime-ci/tasks/manage-gcp-dns/task.yml
        input_mapping:
          bbl-state: relint-envs
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
          GCP_DNS_SERVICE_ACCOUNT_KEY: ((concourse_gcp_service_account_json))
          GCP_DNS_ZONE_NAME: test-relint-rocks
          GCP_DNS_RECORD_SET_NAME: pre-dev.test.relint.rocks
          ACTION: remove
      - task: bbl-down
        file: cf-deployment-concourse-tasks/bbl-destroy/task.yml
        input_mapping:
          bbl-state: relint-envs
        params:
          BBL_GCP_SERVICE_ACCOUNT_KEY: environments/test/pre-dev/google_account_creds.json
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
        ensure:
          put: relint-envs
          params:
            repository: updated-bbl-state
            rebase: true
- name: update-loggregator
  serial_groups:
  - update-release
  public: true
  plan:
  - aggregate:
    - get: loggregator-release
      trigger: true
      params:
        tarball: false
    - get: cf-deployment-release-candidate
    - get: cf-deployment-develop
    - get: stemcell
      params:
        tarball: false
    - get: cf-deployment-concourse-tasks
    - get: runtime-ci
    - get: relint-envs
    - get: relint-team
  - task: update-release-loggregator-release-candidate
    file: runtime-ci/tasks/update-single-manifest-release/task.yml
    input_mapping:
      deployment-configuration: cf-deployment-release-candidate
      release: loggregator-release
    output_mapping:
      updated-deployment-manifest: updated-cf-deployment-loggregator-release-candidate
    params:
      RELEASE_NAME: loggregator
  - task: update-additional-ops-files-loggregator-release-candidate
    file: runtime-ci/tasks/update-single-opsfile-release/task.yml
    input_mapping:
      original-ops-file: updated-cf-deployment-loggregator-release-candidate
      release: loggregator-release
    output_mapping:
      updated-ops-file: updated-cf-deployment-loggregator-release-candidate
    params:
      RELEASE_NAME: loggregator
  - do:
    - task: bbl-up
      file: cf-deployment-concourse-tasks/bbl-up/task.yml
      params:
        BBL_STATE_DIR: environments/test/pre-dev/bbl-state
        BBL_IAAS: gcp
        BBL_ENV_NAME: pre-dev
        BBL_GCP_SERVICE_ACCOUNT_KEY: environments/test/pre-dev/google_account_creds.json
        BBL_GCP_REGION: us-central1
        BBL_LB_CERT: ((pre_dev_cf_lb_cert.certificate))
        BBL_LB_KEY: ((pre_dev_cf_lb_cert.private_key))
        LB_DOMAIN: pre-dev.test.relint.rocks
      input_mapping:
        bbl-state: relint-envs
        bbl-config: relint-envs
      ensure:
        put: relint-envs
        params:
          repository: updated-bbl-state
          rebase: true
    - task: add-gcp-dns
      file: runtime-ci/tasks/manage-gcp-dns/task.yml
      input_mapping:
        bbl-state: relint-envs
      params:
        BBL_STATE_DIR: environments/test/pre-dev/bbl-state
        GCP_DNS_SERVICE_ACCOUNT_KEY: ((concourse_gcp_service_account_json))
        GCP_DNS_ZONE_NAME: test-relint-rocks
        GCP_DNS_RECORD_SET_NAME: pre-dev.test.relint.rocks
        ACTION: add
    - do:
      - task: deploy-cf
        file: cf-deployment-concourse-tasks/bosh-deploy/task.yml
        input_mapping:
          bbl-state: relint-envs
          cf-deployment: updated-cf-deployment-loggregator-release-candidate
          ops-files: updated-cf-deployment-loggregator-release-candidate
          vars-files: relint-envs
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
          SYSTEM_DOMAIN: pre-dev.test.relint.rocks
          OPS_FILES: |
            operations/experimental/fast-deploy-with-downtime-and-danger.yml
          REGENERATE_CREDENTIALS: false
          BOSH_DEPLOY_ARGS: --parallel 50
      - task: run-errand-smoke-tests
        file: cf-deployment-concourse-tasks/run-errand/task.yml
        input_mapping:
          bbl-state: relint-envs
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
          ERRAND_NAME: smoke-tests
      - task: export-compiled-release-loggregator
        file: runtime-ci/tasks/export-compiled-release-tarball/task.yml
        input_mapping:
          bbl-state: relint-envs
          manifest: updated-cf-deployment-loggregator-release-candidate
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
          RELEASE_NAME: loggregator
      - task: update-release-loggregator-develop
        file: runtime-ci/tasks/update-single-manifest-release/task.yml
        input_mapping:
          deployment-configuration: cf-deployment-develop
          release: loggregator-release
        output_mapping:
          updated-deployment-manifest: updated-cf-deployment-loggregator-develop
        params:
          RELEASE_NAME: loggregator
      - task: update-additional-ops-files-loggregator-develop
        file: runtime-ci/tasks/update-single-opsfile-release/task.yml
        input_mapping:
          original-ops-file: updated-cf-deployment-loggregator-develop
          release: loggregator-release
        output_mapping:
          updated-ops-file: updated-cf-deployment-loggregator-develop
        params:
          RELEASE_NAME: loggregator
      - task: update-compiled-releases-ops-file-loggregator-develop
        file: runtime-ci/tasks/update-single-compiled-release/task.yml
        input_mapping:
          original-compiled-releases-ops-file: updated-cf-deployment-loggregator-develop
          release: loggregator-release
        output_mapping:
          updated-compiled-releases-ops-file: updated-cf-deployment-loggregator-develop
        params:
          RELEASE_NAME: loggregator
          ORIGINAL_OPS_FILE_PATH: operations/use-compiled-releases.yml
          UPDATED_OPS_FILE_PATH: operations/use-compiled-releases.yml
      on_success:
        do:
        - put: loggregator-release-gcs
          params:
            file: compiled-release-tarball/*.tgz
            predefined_acl: publicRead
        - put: cf-deployment-develop
          params:
            rebase: true
            repository: updated-cf-deployment-loggregator-develop
      on_failure:
        do:
        - task: push-to-release-branch
          file: runtime-ci/tasks/push-to-release-branch/task.yml
          input_mapping:
            updated-cf-deployment: updated-cf-deployment-loggregator-release-candidate
            release: loggregator-release
          params:
            DEPLOY_KEY: ((cf_deployment_readwrite_deploy_key.private_key))
            RELEASE_NAME: loggregator
        - task: retrieve-bosh-logs
          file: runtime-ci/tasks/retrieve-bosh-logs/task.yml
          input_mapping:
            bbl-state: relint-envs
          params:
            BBL_STATE_DIR: environments/test/pre-dev/bbl-state
        - put: loggregator-component-bump-logs-gcs
          params:
            file: bosh-logs/cf-*.tgz
        ensure:
          do:
          - task: create-slack-message
            file: runtime-ci/tasks/create-slack-message/task.yml
            input_mapping:
              release: loggregator-release
            params:
              RELEASE_NAME: loggregator
              REPOSITORY: cloudfoundry/loggregator-release
              BOSH_LOGS_PREFIX: https://storage.cloud.google.com/component-bump-logs/loggregator
          - put: slack-alert
            params:
              text_file: slack-message/message.txt
              username: Release Integration
              icon_emoji: ':cloudfoundrylogo:'
    ensure:
      do:
      - task: delete-deployment
        file: cf-deployment-concourse-tasks/bosh-delete-deployment/task.yml
        input_mapping:
          bbl-state: relint-envs
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
      - task: remove-gcp-dns
        file: runtime-ci/tasks/manage-gcp-dns/task.yml
        input_mapping:
          bbl-state: relint-envs
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
          GCP_DNS_SERVICE_ACCOUNT_KEY: ((concourse_gcp_service_account_json))
          GCP_DNS_ZONE_NAME: test-relint-rocks
          GCP_DNS_RECORD_SET_NAME: pre-dev.test.relint.rocks
          ACTION: remove
      - task: bbl-down
        file: cf-deployment-concourse-tasks/bbl-destroy/task.yml
        input_mapping:
          bbl-state: relint-envs
        params:
          BBL_GCP_SERVICE_ACCOUNT_KEY: environments/test/pre-dev/google_account_creds.json
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
        ensure:
          put: relint-envs
          params:
            repository: updated-bbl-state
            rebase: true
- name: update-loggregator-agent
  serial_groups:
  - update-release
  public: true
  plan:
  - aggregate:
    - get: loggregator-agent-release
      trigger: true
      params:
        tarball: false
    - get: cf-deployment-release-candidate
    - get: cf-deployment-develop
    - get: stemcell
      params:
        tarball: false
    - get: cf-deployment-concourse-tasks
    - get: runtime-ci
    - get: relint-envs
    - get: relint-team
  - task: update-release-loggregator-agent-release-candidate
    file: runtime-ci/tasks/update-single-manifest-release/task.yml
    input_mapping:
      deployment-configuration: cf-deployment-release-candidate
      release: loggregator-agent-release
    output_mapping:
      updated-deployment-manifest: updated-cf-deployment-loggregator-agent-release-candidate
    params:
      RELEASE_NAME: loggregator-agent
  - task: update-additional-ops-files-loggregator-agent-release-candidate
    file: runtime-ci/tasks/update-single-opsfile-release/task.yml
    input_mapping:
      original-ops-file: updated-cf-deployment-loggregator-agent-release-candidate
      release: loggregator-agent-release
    output_mapping:
      updated-ops-file: updated-cf-deployment-loggregator-agent-release-candidate
    params:
      RELEASE_NAME: loggregator-agent
  - do:
    - task: bbl-up
      file: cf-deployment-concourse-tasks/bbl-up/task.yml
      params:
        BBL_STATE_DIR: environments/test/pre-dev/bbl-state
        BBL_IAAS: gcp
        BBL_ENV_NAME: pre-dev
        BBL_GCP_SERVICE_ACCOUNT_KEY: environments/test/pre-dev/google_account_creds.json
        BBL_GCP_REGION: us-central1
        BBL_LB_CERT: ((pre_dev_cf_lb_cert.certificate))
        BBL_LB_KEY: ((pre_dev_cf_lb_cert.private_key))
        LB_DOMAIN: pre-dev.test.relint.rocks
      input_mapping:
        bbl-state: relint-envs
        bbl-config: relint-envs
      ensure:
        put: relint-envs
        params:
          repository: updated-bbl-state
          rebase: true
    - task: add-gcp-dns
      file: runtime-ci/tasks/manage-gcp-dns/task.yml
      input_mapping:
        bbl-state: relint-envs
      params:
        BBL_STATE_DIR: environments/test/pre-dev/bbl-state
        GCP_DNS_SERVICE_ACCOUNT_KEY: ((concourse_gcp_service_account_json))
        GCP_DNS_ZONE_NAME: test-relint-rocks
        GCP_DNS_RECORD_SET_NAME: pre-dev.test.relint.rocks
        ACTION: add
    - do:
      - task: deploy-cf
        file: cf-deployment-concourse-tasks/bosh-deploy/task.yml
        input_mapping:
          bbl-state: relint-envs
          cf-deployment: updated-cf-deployment-loggregator-agent-release-candidate
          ops-files: updated-cf-deployment-loggregator-agent-release-candidate
          vars-files: relint-envs
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
          SYSTEM_DOMAIN: pre-dev.test.relint.rocks
          OPS_FILES: |
            operations/experimental/fast-deploy-with-downtime-and-danger.yml
          REGENERATE_CREDENTIALS: false
          BOSH_DEPLOY_ARGS: --parallel 50
      - task: run-errand-smoke-tests
        file: cf-deployment-concourse-tasks/run-errand/task.yml
        input_mapping:
          bbl-state: relint-envs
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
          ERRAND_NAME: smoke-tests
      - task: export-compiled-release-loggregator-agent
        file: runtime-ci/tasks/export-compiled-release-tarball/task.yml
        input_mapping:
          bbl-state: relint-envs
          manifest: updated-cf-deployment-loggregator-agent-release-candidate
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
          RELEASE_NAME: loggregator-agent
      - task: update-release-loggregator-agent-develop
        file: runtime-ci/tasks/update-single-manifest-release/task.yml
        input_mapping:
          deployment-configuration: cf-deployment-develop
          release: loggregator-agent-release
        output_mapping:
          updated-deployment-manifest: updated-cf-deployment-loggregator-agent-develop
        params:
          RELEASE_NAME: loggregator-agent
      - task: update-additional-ops-files-loggregator-agent-develop
        file: runtime-ci/tasks/update-single-opsfile-release/task.yml
        input_mapping:
          original-ops-file: updated-cf-deployment-loggregator-agent-develop
          release: loggregator-agent-release
        output_mapping:
          updated-ops-file: updated-cf-deployment-loggregator-agent-develop
        params:
          RELEASE_NAME: loggregator-agent
      - task: update-compiled-releases-ops-file-loggregator-agent-develop
        file: runtime-ci/tasks/update-single-compiled-release/task.yml
        input_mapping:
          original-compiled-releases-ops-file: updated-cf-deployment-loggregator-agent-develop
          release: loggregator-agent-release
        output_mapping:
          updated-compiled-releases-ops-file: updated-cf-deployment-loggregator-agent-develop
        params:
          RELEASE_NAME: loggregator-agent
          ORIGINAL_OPS_FILE_PATH: operations/use-compiled-releases.yml
          UPDATED_OPS_FILE_PATH: operations/use-compiled-releases.yml
      on_success:
        do:
        - put: loggregator-agent-release-gcs
          params:
            file: compiled-release-tarball/*.tgz
            predefined_acl: publicRead
        - put: cf-deployment-develop
          params:
            rebase: true
            repository: updated-cf-deployment-loggregator-agent-develop
      on_failure:
        do:
        - task: push-to-release-branch
          file: runtime-ci/tasks/push-to-release-branch/task.yml
          input_mapping:
            updated-cf-deployment: updated-cf-deployment-loggregator-agent-release-candidate
            release: loggregator-agent-release
          params:
            DEPLOY_KEY: ((cf_deployment_readwrite_deploy_key.private_key))
            RELEASE_NAME: loggregator-agent
        - task: retrieve-bosh-logs
          file: runtime-ci/tasks/retrieve-bosh-logs/task.yml
          input_mapping:
            bbl-state: relint-envs
          params:
            BBL_STATE_DIR: environments/test/pre-dev/bbl-state
        - put: loggregator-agent-component-bump-logs-gcs
          params:
            file: bosh-logs/cf-*.tgz
        ensure:
          do:
          - task: create-slack-message
            file: runtime-ci/tasks/create-slack-message/task.yml
            input_mapping:
              release: loggregator-agent-release
            params:
              RELEASE_NAME: loggregator-agent
              REPOSITORY: cloudfoundry/loggregator-agent-release
              BOSH_LOGS_PREFIX: https://storage.cloud.google.com/component-bump-logs/loggregator-agent
          - put: slack-alert
            params:
              text_file: slack-message/message.txt
              username: Release Integration
              icon_emoji: ':cloudfoundrylogo:'
    ensure:
      do:
      - task: delete-deployment
        file: cf-deployment-concourse-tasks/bosh-delete-deployment/task.yml
        input_mapping:
          bbl-state: relint-envs
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
      - task: remove-gcp-dns
        file: runtime-ci/tasks/manage-gcp-dns/task.yml
        input_mapping:
          bbl-state: relint-envs
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
          GCP_DNS_SERVICE_ACCOUNT_KEY: ((concourse_gcp_service_account_json))
          GCP_DNS_ZONE_NAME: test-relint-rocks
          GCP_DNS_RECORD_SET_NAME: pre-dev.test.relint.rocks
          ACTION: remove
      - task: bbl-down
        file: cf-deployment-concourse-tasks/bbl-destroy/task.yml
        input_mapping:
          bbl-state: relint-envs
        params:
          BBL_GCP_SERVICE_ACCOUNT_KEY: environments/test/pre-dev/google_account_creds.json
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
        ensure:
          put: relint-envs
          params:
            repository: updated-bbl-state
            rebase: true
- name: update-nats
  serial_groups:
  - update-release
  public: true
  plan:
  - aggregate:
    - get: nats-release
      trigger: true
      params:
        tarball: false
    - get: cf-deployment-release-candidate
    - get: cf-deployment-develop
    - get: stemcell
      params:
        tarball: false
    - get: cf-deployment-concourse-tasks
    - get: runtime-ci
    - get: relint-envs
    - get: relint-team
  - task: update-release-nats-release-candidate
    file: runtime-ci/tasks/update-single-manifest-release/task.yml
    input_mapping:
      deployment-configuration: cf-deployment-release-candidate
      release: nats-release
    output_mapping:
      updated-deployment-manifest: updated-cf-deployment-nats-release-candidate
    params:
      RELEASE_NAME: nats
  - task: update-additional-ops-files-nats-release-candidate
    file: runtime-ci/tasks/update-single-opsfile-release/task.yml
    input_mapping:
      original-ops-file: updated-cf-deployment-nats-release-candidate
      release: nats-release
    output_mapping:
      updated-ops-file: updated-cf-deployment-nats-release-candidate
    params:
      RELEASE_NAME: nats
  - do:
    - task: bbl-up
      file: cf-deployment-concourse-tasks/bbl-up/task.yml
      params:
        BBL_STATE_DIR: environments/test/pre-dev/bbl-state
        BBL_IAAS: gcp
        BBL_ENV_NAME: pre-dev
        BBL_GCP_SERVICE_ACCOUNT_KEY: environments/test/pre-dev/google_account_creds.json
        BBL_GCP_REGION: us-central1
        BBL_LB_CERT: ((pre_dev_cf_lb_cert.certificate))
        BBL_LB_KEY: ((pre_dev_cf_lb_cert.private_key))
        LB_DOMAIN: pre-dev.test.relint.rocks
      input_mapping:
        bbl-state: relint-envs
        bbl-config: relint-envs
      ensure:
        put: relint-envs
        params:
          repository: updated-bbl-state
          rebase: true
    - task: add-gcp-dns
      file: runtime-ci/tasks/manage-gcp-dns/task.yml
      input_mapping:
        bbl-state: relint-envs
      params:
        BBL_STATE_DIR: environments/test/pre-dev/bbl-state
        GCP_DNS_SERVICE_ACCOUNT_KEY: ((concourse_gcp_service_account_json))
        GCP_DNS_ZONE_NAME: test-relint-rocks
        GCP_DNS_RECORD_SET_NAME: pre-dev.test.relint.rocks
        ACTION: add
    - do:
      - task: deploy-cf
        file: cf-deployment-concourse-tasks/bosh-deploy/task.yml
        input_mapping:
          bbl-state: relint-envs
          cf-deployment: updated-cf-deployment-nats-release-candidate
          ops-files: updated-cf-deployment-nats-release-candidate
          vars-files: relint-envs
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
          SYSTEM_DOMAIN: pre-dev.test.relint.rocks
          OPS_FILES: |
            operations/experimental/fast-deploy-with-downtime-and-danger.yml
          REGENERATE_CREDENTIALS: false
          BOSH_DEPLOY_ARGS: --parallel 50
      - task: run-errand-smoke-tests
        file: cf-deployment-concourse-tasks/run-errand/task.yml
        input_mapping:
          bbl-state: relint-envs
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
          ERRAND_NAME: smoke-tests
      - task: export-compiled-release-nats
        file: runtime-ci/tasks/export-compiled-release-tarball/task.yml
        input_mapping:
          bbl-state: relint-envs
          manifest: updated-cf-deployment-nats-release-candidate
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
          RELEASE_NAME: nats
      - task: update-release-nats-develop
        file: runtime-ci/tasks/update-single-manifest-release/task.yml
        input_mapping:
          deployment-configuration: cf-deployment-develop
          release: nats-release
        output_mapping:
          updated-deployment-manifest: updated-cf-deployment-nats-develop
        params:
          RELEASE_NAME: nats
      - task: update-additional-ops-files-nats-develop
        file: runtime-ci/tasks/update-single-opsfile-release/task.yml
        input_mapping:
          original-ops-file: updated-cf-deployment-nats-develop
          release: nats-release
        output_mapping:
          updated-ops-file: updated-cf-deployment-nats-develop
        params:
          RELEASE_NAME: nats
      - task: update-compiled-releases-ops-file-nats-develop
        file: runtime-ci/tasks/update-single-compiled-release/task.yml
        input_mapping:
          original-compiled-releases-ops-file: updated-cf-deployment-nats-develop
          release: nats-release
        output_mapping:
          updated-compiled-releases-ops-file: updated-cf-deployment-nats-develop
        params:
          RELEASE_NAME: nats
          ORIGINAL_OPS_FILE_PATH: operations/use-compiled-releases.yml
          UPDATED_OPS_FILE_PATH: operations/use-compiled-releases.yml
      on_success:
        do:
        - put: nats-release-gcs
          params:
            file: compiled-release-tarball/*.tgz
            predefined_acl: publicRead
        - put: cf-deployment-develop
          params:
            rebase: true
            repository: updated-cf-deployment-nats-develop
      on_failure:
        do:
        - task: push-to-release-branch
          file: runtime-ci/tasks/push-to-release-branch/task.yml
          input_mapping:
            updated-cf-deployment: updated-cf-deployment-nats-release-candidate
            release: nats-release
          params:
            DEPLOY_KEY: ((cf_deployment_readwrite_deploy_key.private_key))
            RELEASE_NAME: nats
        - task: retrieve-bosh-logs
          file: runtime-ci/tasks/retrieve-bosh-logs/task.yml
          input_mapping:
            bbl-state: relint-envs
          params:
            BBL_STATE_DIR: environments/test/pre-dev/bbl-state
        - put: nats-component-bump-logs-gcs
          params:
            file: bosh-logs/cf-*.tgz
        ensure:
          do:
          - task: create-slack-message
            file: runtime-ci/tasks/create-slack-message/task.yml
            input_mapping:
              release: nats-release
            params:
              RELEASE_NAME: nats
              REPOSITORY: cloudfoundry/nats-release
              BOSH_LOGS_PREFIX: https://storage.cloud.google.com/component-bump-logs/nats
          - put: slack-alert
            params:
              text_file: slack-message/message.txt
              username: Release Integration
              icon_emoji: ':cloudfoundrylogo:'
    ensure:
      do:
      - task: delete-deployment
        file: cf-deployment-concourse-tasks/bosh-delete-deployment/task.yml
        input_mapping:
          bbl-state: relint-envs
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
      - task: remove-gcp-dns
        file: runtime-ci/tasks/manage-gcp-dns/task.yml
        input_mapping:
          bbl-state: relint-envs
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
          GCP_DNS_SERVICE_ACCOUNT_KEY: ((concourse_gcp_service_account_json))
          GCP_DNS_ZONE_NAME: test-relint-rocks
          GCP_DNS_RECORD_SET_NAME: pre-dev.test.relint.rocks
          ACTION: remove
      - task: bbl-down
        file: cf-deployment-concourse-tasks/bbl-destroy/task.yml
        input_mapping:
          bbl-state: relint-envs
        params:
          BBL_GCP_SERVICE_ACCOUNT_KEY: environments/test/pre-dev/google_account_creds.json
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
        ensure:
          put: relint-envs
          params:
            repository: updated-bbl-state
            rebase: true
- name: update-nginx-buildpack
  serial_groups:
  - update-release
  public: true
  plan:
  - aggregate:
    - get: nginx-buildpack-release
      trigger: true
      params:
        tarball: false
    - get: cf-deployment-release-candidate
    - get: cf-deployment-develop
    - get: stemcell
      params:
        tarball: false
    - get: cf-deployment-concourse-tasks
    - get: runtime-ci
    - get: relint-envs
    - get: relint-team
  - task: update-release-nginx-buildpack-release-candidate
    file: runtime-ci/tasks/update-single-manifest-release/task.yml
    input_mapping:
      deployment-configuration: cf-deployment-release-candidate
      release: nginx-buildpack-release
    output_mapping:
      updated-deployment-manifest: updated-cf-deployment-nginx-buildpack-release-candidate
    params:
      RELEASE_NAME: nginx-buildpack
  - task: update-additional-ops-files-nginx-buildpack-release-candidate
    file: runtime-ci/tasks/update-single-opsfile-release/task.yml
    input_mapping:
      original-ops-file: updated-cf-deployment-nginx-buildpack-release-candidate
      release: nginx-buildpack-release
    output_mapping:
      updated-ops-file: updated-cf-deployment-nginx-buildpack-release-candidate
    params:
      RELEASE_NAME: nginx-buildpack
  - do:
    - task: bbl-up
      file: cf-deployment-concourse-tasks/bbl-up/task.yml
      params:
        BBL_STATE_DIR: environments/test/pre-dev/bbl-state
        BBL_IAAS: gcp
        BBL_ENV_NAME: pre-dev
        BBL_GCP_SERVICE_ACCOUNT_KEY: environments/test/pre-dev/google_account_creds.json
        BBL_GCP_REGION: us-central1
        BBL_LB_CERT: ((pre_dev_cf_lb_cert.certificate))
        BBL_LB_KEY: ((pre_dev_cf_lb_cert.private_key))
        LB_DOMAIN: pre-dev.test.relint.rocks
      input_mapping:
        bbl-state: relint-envs
        bbl-config: relint-envs
      ensure:
        put: relint-envs
        params:
          repository: updated-bbl-state
          rebase: true
    - task: add-gcp-dns
      file: runtime-ci/tasks/manage-gcp-dns/task.yml
      input_mapping:
        bbl-state: relint-envs
      params:
        BBL_STATE_DIR: environments/test/pre-dev/bbl-state
        GCP_DNS_SERVICE_ACCOUNT_KEY: ((concourse_gcp_service_account_json))
        GCP_DNS_ZONE_NAME: test-relint-rocks
        GCP_DNS_RECORD_SET_NAME: pre-dev.test.relint.rocks
        ACTION: add
    - do:
      - task: deploy-cf
        file: cf-deployment-concourse-tasks/bosh-deploy/task.yml
        input_mapping:
          bbl-state: relint-envs
          cf-deployment: updated-cf-deployment-nginx-buildpack-release-candidate
          ops-files: updated-cf-deployment-nginx-buildpack-release-candidate
          vars-files: relint-envs
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
          SYSTEM_DOMAIN: pre-dev.test.relint.rocks
          OPS_FILES: |
            operations/experimental/fast-deploy-with-downtime-and-danger.yml
          REGENERATE_CREDENTIALS: false
          BOSH_DEPLOY_ARGS: --parallel 50
      - task: run-errand-smoke-tests
        file: cf-deployment-concourse-tasks/run-errand/task.yml
        input_mapping:
          bbl-state: relint-envs
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
          ERRAND_NAME: smoke-tests
      - task: export-compiled-release-nginx-buildpack
        file: runtime-ci/tasks/export-compiled-release-tarball/task.yml
        input_mapping:
          bbl-state: relint-envs
          manifest: updated-cf-deployment-nginx-buildpack-release-candidate
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
          RELEASE_NAME: nginx-buildpack
      - task: update-release-nginx-buildpack-develop
        file: runtime-ci/tasks/update-single-manifest-release/task.yml
        input_mapping:
          deployment-configuration: cf-deployment-develop
          release: nginx-buildpack-release
        output_mapping:
          updated-deployment-manifest: updated-cf-deployment-nginx-buildpack-develop
        params:
          RELEASE_NAME: nginx-buildpack
      - task: update-additional-ops-files-nginx-buildpack-develop
        file: runtime-ci/tasks/update-single-opsfile-release/task.yml
        input_mapping:
          original-ops-file: updated-cf-deployment-nginx-buildpack-develop
          release: nginx-buildpack-release
        output_mapping:
          updated-ops-file: updated-cf-deployment-nginx-buildpack-develop
        params:
          RELEASE_NAME: nginx-buildpack
      - task: update-compiled-releases-ops-file-nginx-buildpack-develop
        file: runtime-ci/tasks/update-single-compiled-release/task.yml
        input_mapping:
          original-compiled-releases-ops-file: updated-cf-deployment-nginx-buildpack-develop
          release: nginx-buildpack-release
        output_mapping:
          updated-compiled-releases-ops-file: updated-cf-deployment-nginx-buildpack-develop
        params:
          RELEASE_NAME: nginx-buildpack
          ORIGINAL_OPS_FILE_PATH: operations/use-compiled-releases.yml
          UPDATED_OPS_FILE_PATH: operations/use-compiled-releases.yml
      on_success:
        do:
        - put: nginx-buildpack-release-gcs
          params:
            file: compiled-release-tarball/*.tgz
            predefined_acl: publicRead
        - put: cf-deployment-develop
          params:
            rebase: true
            repository: updated-cf-deployment-nginx-buildpack-develop
      on_failure:
        do:
        - task: push-to-release-branch
          file: runtime-ci/tasks/push-to-release-branch/task.yml
          input_mapping:
            updated-cf-deployment: updated-cf-deployment-nginx-buildpack-release-candidate
            release: nginx-buildpack-release
          params:
            DEPLOY_KEY: ((cf_deployment_readwrite_deploy_key.private_key))
            RELEASE_NAME: nginx-buildpack
        - task: retrieve-bosh-logs
          file: runtime-ci/tasks/retrieve-bosh-logs/task.yml
          input_mapping:
            bbl-state: relint-envs
          params:
            BBL_STATE_DIR: environments/test/pre-dev/bbl-state
        - put: nginx-buildpack-component-bump-logs-gcs
          params:
            file: bosh-logs/cf-*.tgz
        ensure:
          do:
          - task: create-slack-message
            file: runtime-ci/tasks/create-slack-message/task.yml
            input_mapping:
              release: nginx-buildpack-release
            params:
              RELEASE_NAME: nginx-buildpack
              REPOSITORY: cloudfoundry/nginx-buildpack-release
              BOSH_LOGS_PREFIX: https://storage.cloud.google.com/component-bump-logs/nginx-buildpack
          - put: slack-alert
            params:
              text_file: slack-message/message.txt
              username: Release Integration
              icon_emoji: ':cloudfoundrylogo:'
    ensure:
      do:
      - task: delete-deployment
        file: cf-deployment-concourse-tasks/bosh-delete-deployment/task.yml
        input_mapping:
          bbl-state: relint-envs
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
      - task: remove-gcp-dns
        file: runtime-ci/tasks/manage-gcp-dns/task.yml
        input_mapping:
          bbl-state: relint-envs
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
          GCP_DNS_SERVICE_ACCOUNT_KEY: ((concourse_gcp_service_account_json))
          GCP_DNS_ZONE_NAME: test-relint-rocks
          GCP_DNS_RECORD_SET_NAME: pre-dev.test.relint.rocks
          ACTION: remove
      - task: bbl-down
        file: cf-deployment-concourse-tasks/bbl-destroy/task.yml
        input_mapping:
          bbl-state: relint-envs
        params:
          BBL_GCP_SERVICE_ACCOUNT_KEY: environments/test/pre-dev/google_account_creds.json
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
        ensure:
          put: relint-envs
          params:
            repository: updated-bbl-state
            rebase: true
- name: update-nodejs-buildpack
  serial_groups:
  - update-release
  public: true
  plan:
  - aggregate:
    - get: nodejs-buildpack-release
      trigger: true
      params:
        tarball: false
    - get: cf-deployment-release-candidate
    - get: cf-deployment-develop
    - get: stemcell
      params:
        tarball: false
    - get: cf-deployment-concourse-tasks
    - get: runtime-ci
    - get: relint-envs
    - get: relint-team
  - task: update-release-nodejs-buildpack-release-candidate
    file: runtime-ci/tasks/update-single-manifest-release/task.yml
    input_mapping:
      deployment-configuration: cf-deployment-release-candidate
      release: nodejs-buildpack-release
    output_mapping:
      updated-deployment-manifest: updated-cf-deployment-nodejs-buildpack-release-candidate
    params:
      RELEASE_NAME: nodejs-buildpack
  - task: update-additional-ops-files-nodejs-buildpack-release-candidate
    file: runtime-ci/tasks/update-single-opsfile-release/task.yml
    input_mapping:
      original-ops-file: updated-cf-deployment-nodejs-buildpack-release-candidate
      release: nodejs-buildpack-release
    output_mapping:
      updated-ops-file: updated-cf-deployment-nodejs-buildpack-release-candidate
    params:
      RELEASE_NAME: nodejs-buildpack
  - do:
    - task: bbl-up
      file: cf-deployment-concourse-tasks/bbl-up/task.yml
      params:
        BBL_STATE_DIR: environments/test/pre-dev/bbl-state
        BBL_IAAS: gcp
        BBL_ENV_NAME: pre-dev
        BBL_GCP_SERVICE_ACCOUNT_KEY: environments/test/pre-dev/google_account_creds.json
        BBL_GCP_REGION: us-central1
        BBL_LB_CERT: ((pre_dev_cf_lb_cert.certificate))
        BBL_LB_KEY: ((pre_dev_cf_lb_cert.private_key))
        LB_DOMAIN: pre-dev.test.relint.rocks
      input_mapping:
        bbl-state: relint-envs
        bbl-config: relint-envs
      ensure:
        put: relint-envs
        params:
          repository: updated-bbl-state
          rebase: true
    - task: add-gcp-dns
      file: runtime-ci/tasks/manage-gcp-dns/task.yml
      input_mapping:
        bbl-state: relint-envs
      params:
        BBL_STATE_DIR: environments/test/pre-dev/bbl-state
        GCP_DNS_SERVICE_ACCOUNT_KEY: ((concourse_gcp_service_account_json))
        GCP_DNS_ZONE_NAME: test-relint-rocks
        GCP_DNS_RECORD_SET_NAME: pre-dev.test.relint.rocks
        ACTION: add
    - do:
      - task: deploy-cf
        file: cf-deployment-concourse-tasks/bosh-deploy/task.yml
        input_mapping:
          bbl-state: relint-envs
          cf-deployment: updated-cf-deployment-nodejs-buildpack-release-candidate
          ops-files: updated-cf-deployment-nodejs-buildpack-release-candidate
          vars-files: relint-envs
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
          SYSTEM_DOMAIN: pre-dev.test.relint.rocks
          OPS_FILES: |
            operations/experimental/fast-deploy-with-downtime-and-danger.yml
          REGENERATE_CREDENTIALS: false
          BOSH_DEPLOY_ARGS: --parallel 50
      - task: run-errand-smoke-tests
        file: cf-deployment-concourse-tasks/run-errand/task.yml
        input_mapping:
          bbl-state: relint-envs
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
          ERRAND_NAME: smoke-tests
      - task: export-compiled-release-nodejs-buildpack
        file: runtime-ci/tasks/export-compiled-release-tarball/task.yml
        input_mapping:
          bbl-state: relint-envs
          manifest: updated-cf-deployment-nodejs-buildpack-release-candidate
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
          RELEASE_NAME: nodejs-buildpack
      - task: update-release-nodejs-buildpack-develop
        file: runtime-ci/tasks/update-single-manifest-release/task.yml
        input_mapping:
          deployment-configuration: cf-deployment-develop
          release: nodejs-buildpack-release
        output_mapping:
          updated-deployment-manifest: updated-cf-deployment-nodejs-buildpack-develop
        params:
          RELEASE_NAME: nodejs-buildpack
      - task: update-additional-ops-files-nodejs-buildpack-develop
        file: runtime-ci/tasks/update-single-opsfile-release/task.yml
        input_mapping:
          original-ops-file: updated-cf-deployment-nodejs-buildpack-develop
          release: nodejs-buildpack-release
        output_mapping:
          updated-ops-file: updated-cf-deployment-nodejs-buildpack-develop
        params:
          RELEASE_NAME: nodejs-buildpack
      - task: update-compiled-releases-ops-file-nodejs-buildpack-develop
        file: runtime-ci/tasks/update-single-compiled-release/task.yml
        input_mapping:
          original-compiled-releases-ops-file: updated-cf-deployment-nodejs-buildpack-develop
          release: nodejs-buildpack-release
        output_mapping:
          updated-compiled-releases-ops-file: updated-cf-deployment-nodejs-buildpack-develop
        params:
          RELEASE_NAME: nodejs-buildpack
          ORIGINAL_OPS_FILE_PATH: operations/use-compiled-releases.yml
          UPDATED_OPS_FILE_PATH: operations/use-compiled-releases.yml
      on_success:
        do:
        - put: nodejs-buildpack-release-gcs
          params:
            file: compiled-release-tarball/*.tgz
            predefined_acl: publicRead
        - put: cf-deployment-develop
          params:
            rebase: true
            repository: updated-cf-deployment-nodejs-buildpack-develop
      on_failure:
        do:
        - task: push-to-release-branch
          file: runtime-ci/tasks/push-to-release-branch/task.yml
          input_mapping:
            updated-cf-deployment: updated-cf-deployment-nodejs-buildpack-release-candidate
            release: nodejs-buildpack-release
          params:
            DEPLOY_KEY: ((cf_deployment_readwrite_deploy_key.private_key))
            RELEASE_NAME: nodejs-buildpack
        - task: retrieve-bosh-logs
          file: runtime-ci/tasks/retrieve-bosh-logs/task.yml
          input_mapping:
            bbl-state: relint-envs
          params:
            BBL_STATE_DIR: environments/test/pre-dev/bbl-state
        - put: nodejs-buildpack-component-bump-logs-gcs
          params:
            file: bosh-logs/cf-*.tgz
        ensure:
          do:
          - task: create-slack-message
            file: runtime-ci/tasks/create-slack-message/task.yml
            input_mapping:
              release: nodejs-buildpack-release
            params:
              RELEASE_NAME: nodejs-buildpack
              REPOSITORY: cloudfoundry/nodejs-buildpack-release
              BOSH_LOGS_PREFIX: https://storage.cloud.google.com/component-bump-logs/nodejs-buildpack
          - put: slack-alert
            params:
              text_file: slack-message/message.txt
              username: Release Integration
              icon_emoji: ':cloudfoundrylogo:'
    ensure:
      do:
      - task: delete-deployment
        file: cf-deployment-concourse-tasks/bosh-delete-deployment/task.yml
        input_mapping:
          bbl-state: relint-envs
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
      - task: remove-gcp-dns
        file: runtime-ci/tasks/manage-gcp-dns/task.yml
        input_mapping:
          bbl-state: relint-envs
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
          GCP_DNS_SERVICE_ACCOUNT_KEY: ((concourse_gcp_service_account_json))
          GCP_DNS_ZONE_NAME: test-relint-rocks
          GCP_DNS_RECORD_SET_NAME: pre-dev.test.relint.rocks
          ACTION: remove
      - task: bbl-down
        file: cf-deployment-concourse-tasks/bbl-destroy/task.yml
        input_mapping:
          bbl-state: relint-envs
        params:
          BBL_GCP_SERVICE_ACCOUNT_KEY: environments/test/pre-dev/google_account_creds.json
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
        ensure:
          put: relint-envs
          params:
            repository: updated-bbl-state
            rebase: true
- name: update-php-buildpack
  serial_groups:
  - update-release
  public: true
  plan:
  - aggregate:
    - get: php-buildpack-release
      trigger: true
      params:
        tarball: false
    - get: cf-deployment-release-candidate
    - get: cf-deployment-develop
    - get: stemcell
      params:
        tarball: false
    - get: cf-deployment-concourse-tasks
    - get: runtime-ci
    - get: relint-envs
    - get: relint-team
  - task: update-release-php-buildpack-release-candidate
    file: runtime-ci/tasks/update-single-manifest-release/task.yml
    input_mapping:
      deployment-configuration: cf-deployment-release-candidate
      release: php-buildpack-release
    output_mapping:
      updated-deployment-manifest: updated-cf-deployment-php-buildpack-release-candidate
    params:
      RELEASE_NAME: php-buildpack
  - task: update-additional-ops-files-php-buildpack-release-candidate
    file: runtime-ci/tasks/update-single-opsfile-release/task.yml
    input_mapping:
      original-ops-file: updated-cf-deployment-php-buildpack-release-candidate
      release: php-buildpack-release
    output_mapping:
      updated-ops-file: updated-cf-deployment-php-buildpack-release-candidate
    params:
      RELEASE_NAME: php-buildpack
  - do:
    - task: bbl-up
      file: cf-deployment-concourse-tasks/bbl-up/task.yml
      params:
        BBL_STATE_DIR: environments/test/pre-dev/bbl-state
        BBL_IAAS: gcp
        BBL_ENV_NAME: pre-dev
        BBL_GCP_SERVICE_ACCOUNT_KEY: environments/test/pre-dev/google_account_creds.json
        BBL_GCP_REGION: us-central1
        BBL_LB_CERT: ((pre_dev_cf_lb_cert.certificate))
        BBL_LB_KEY: ((pre_dev_cf_lb_cert.private_key))
        LB_DOMAIN: pre-dev.test.relint.rocks
      input_mapping:
        bbl-state: relint-envs
        bbl-config: relint-envs
      ensure:
        put: relint-envs
        params:
          repository: updated-bbl-state
          rebase: true
    - task: add-gcp-dns
      file: runtime-ci/tasks/manage-gcp-dns/task.yml
      input_mapping:
        bbl-state: relint-envs
      params:
        BBL_STATE_DIR: environments/test/pre-dev/bbl-state
        GCP_DNS_SERVICE_ACCOUNT_KEY: ((concourse_gcp_service_account_json))
        GCP_DNS_ZONE_NAME: test-relint-rocks
        GCP_DNS_RECORD_SET_NAME: pre-dev.test.relint.rocks
        ACTION: add
    - do:
      - task: deploy-cf
        file: cf-deployment-concourse-tasks/bosh-deploy/task.yml
        input_mapping:
          bbl-state: relint-envs
          cf-deployment: updated-cf-deployment-php-buildpack-release-candidate
          ops-files: updated-cf-deployment-php-buildpack-release-candidate
          vars-files: relint-envs
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
          SYSTEM_DOMAIN: pre-dev.test.relint.rocks
          OPS_FILES: |
            operations/experimental/fast-deploy-with-downtime-and-danger.yml
          REGENERATE_CREDENTIALS: false
          BOSH_DEPLOY_ARGS: --parallel 50
      - task: run-errand-smoke-tests
        file: cf-deployment-concourse-tasks/run-errand/task.yml
        input_mapping:
          bbl-state: relint-envs
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
          ERRAND_NAME: smoke-tests
      - task: export-compiled-release-php-buildpack
        file: runtime-ci/tasks/export-compiled-release-tarball/task.yml
        input_mapping:
          bbl-state: relint-envs
          manifest: updated-cf-deployment-php-buildpack-release-candidate
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
          RELEASE_NAME: php-buildpack
      - task: update-release-php-buildpack-develop
        file: runtime-ci/tasks/update-single-manifest-release/task.yml
        input_mapping:
          deployment-configuration: cf-deployment-develop
          release: php-buildpack-release
        output_mapping:
          updated-deployment-manifest: updated-cf-deployment-php-buildpack-develop
        params:
          RELEASE_NAME: php-buildpack
      - task: update-additional-ops-files-php-buildpack-develop
        file: runtime-ci/tasks/update-single-opsfile-release/task.yml
        input_mapping:
          original-ops-file: updated-cf-deployment-php-buildpack-develop
          release: php-buildpack-release
        output_mapping:
          updated-ops-file: updated-cf-deployment-php-buildpack-develop
        params:
          RELEASE_NAME: php-buildpack
      - task: update-compiled-releases-ops-file-php-buildpack-develop
        file: runtime-ci/tasks/update-single-compiled-release/task.yml
        input_mapping:
          original-compiled-releases-ops-file: updated-cf-deployment-php-buildpack-develop
          release: php-buildpack-release
        output_mapping:
          updated-compiled-releases-ops-file: updated-cf-deployment-php-buildpack-develop
        params:
          RELEASE_NAME: php-buildpack
          ORIGINAL_OPS_FILE_PATH: operations/use-compiled-releases.yml
          UPDATED_OPS_FILE_PATH: operations/use-compiled-releases.yml
      on_success:
        do:
        - put: php-buildpack-release-gcs
          params:
            file: compiled-release-tarball/*.tgz
            predefined_acl: publicRead
        - put: cf-deployment-develop
          params:
            rebase: true
            repository: updated-cf-deployment-php-buildpack-develop
      on_failure:
        do:
        - task: push-to-release-branch
          file: runtime-ci/tasks/push-to-release-branch/task.yml
          input_mapping:
            updated-cf-deployment: updated-cf-deployment-php-buildpack-release-candidate
            release: php-buildpack-release
          params:
            DEPLOY_KEY: ((cf_deployment_readwrite_deploy_key.private_key))
            RELEASE_NAME: php-buildpack
        - task: retrieve-bosh-logs
          file: runtime-ci/tasks/retrieve-bosh-logs/task.yml
          input_mapping:
            bbl-state: relint-envs
          params:
            BBL_STATE_DIR: environments/test/pre-dev/bbl-state
        - put: php-buildpack-component-bump-logs-gcs
          params:
            file: bosh-logs/cf-*.tgz
        ensure:
          do:
          - task: create-slack-message
            file: runtime-ci/tasks/create-slack-message/task.yml
            input_mapping:
              release: php-buildpack-release
            params:
              RELEASE_NAME: php-buildpack
              REPOSITORY: cloudfoundry/php-buildpack-release
              BOSH_LOGS_PREFIX: https://storage.cloud.google.com/component-bump-logs/php-buildpack
          - put: slack-alert
            params:
              text_file: slack-message/message.txt
              username: Release Integration
              icon_emoji: ':cloudfoundrylogo:'
    ensure:
      do:
      - task: delete-deployment
        file: cf-deployment-concourse-tasks/bosh-delete-deployment/task.yml
        input_mapping:
          bbl-state: relint-envs
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
      - task: remove-gcp-dns
        file: runtime-ci/tasks/manage-gcp-dns/task.yml
        input_mapping:
          bbl-state: relint-envs
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
          GCP_DNS_SERVICE_ACCOUNT_KEY: ((concourse_gcp_service_account_json))
          GCP_DNS_ZONE_NAME: test-relint-rocks
          GCP_DNS_RECORD_SET_NAME: pre-dev.test.relint.rocks
          ACTION: remove
      - task: bbl-down
        file: cf-deployment-concourse-tasks/bbl-destroy/task.yml
        input_mapping:
          bbl-state: relint-envs
        params:
          BBL_GCP_SERVICE_ACCOUNT_KEY: environments/test/pre-dev/google_account_creds.json
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
        ensure:
          put: relint-envs
          params:
            repository: updated-bbl-state
            rebase: true
- name: update-python-buildpack
  serial_groups:
  - update-release
  public: true
  plan:
  - aggregate:
    - get: python-buildpack-release
      trigger: true
      params:
        tarball: false
    - get: cf-deployment-release-candidate
    - get: cf-deployment-develop
    - get: stemcell
      params:
        tarball: false
    - get: cf-deployment-concourse-tasks
    - get: runtime-ci
    - get: relint-envs
    - get: relint-team
  - task: update-release-python-buildpack-release-candidate
    file: runtime-ci/tasks/update-single-manifest-release/task.yml
    input_mapping:
      deployment-configuration: cf-deployment-release-candidate
      release: python-buildpack-release
    output_mapping:
      updated-deployment-manifest: updated-cf-deployment-python-buildpack-release-candidate
    params:
      RELEASE_NAME: python-buildpack
  - task: update-additional-ops-files-python-buildpack-release-candidate
    file: runtime-ci/tasks/update-single-opsfile-release/task.yml
    input_mapping:
      original-ops-file: updated-cf-deployment-python-buildpack-release-candidate
      release: python-buildpack-release
    output_mapping:
      updated-ops-file: updated-cf-deployment-python-buildpack-release-candidate
    params:
      RELEASE_NAME: python-buildpack
  - do:
    - task: bbl-up
      file: cf-deployment-concourse-tasks/bbl-up/task.yml
      params:
        BBL_STATE_DIR: environments/test/pre-dev/bbl-state
        BBL_IAAS: gcp
        BBL_ENV_NAME: pre-dev
        BBL_GCP_SERVICE_ACCOUNT_KEY: environments/test/pre-dev/google_account_creds.json
        BBL_GCP_REGION: us-central1
        BBL_LB_CERT: ((pre_dev_cf_lb_cert.certificate))
        BBL_LB_KEY: ((pre_dev_cf_lb_cert.private_key))
        LB_DOMAIN: pre-dev.test.relint.rocks
      input_mapping:
        bbl-state: relint-envs
        bbl-config: relint-envs
      ensure:
        put: relint-envs
        params:
          repository: updated-bbl-state
          rebase: true
    - task: add-gcp-dns
      file: runtime-ci/tasks/manage-gcp-dns/task.yml
      input_mapping:
        bbl-state: relint-envs
      params:
        BBL_STATE_DIR: environments/test/pre-dev/bbl-state
        GCP_DNS_SERVICE_ACCOUNT_KEY: ((concourse_gcp_service_account_json))
        GCP_DNS_ZONE_NAME: test-relint-rocks
        GCP_DNS_RECORD_SET_NAME: pre-dev.test.relint.rocks
        ACTION: add
    - do:
      - task: deploy-cf
        file: cf-deployment-concourse-tasks/bosh-deploy/task.yml
        input_mapping:
          bbl-state: relint-envs
          cf-deployment: updated-cf-deployment-python-buildpack-release-candidate
          ops-files: updated-cf-deployment-python-buildpack-release-candidate
          vars-files: relint-envs
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
          SYSTEM_DOMAIN: pre-dev.test.relint.rocks
          OPS_FILES: |
            operations/experimental/fast-deploy-with-downtime-and-danger.yml
          REGENERATE_CREDENTIALS: false
          BOSH_DEPLOY_ARGS: --parallel 50
      - task: run-errand-smoke-tests
        file: cf-deployment-concourse-tasks/run-errand/task.yml
        input_mapping:
          bbl-state: relint-envs
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
          ERRAND_NAME: smoke-tests
      - task: export-compiled-release-python-buildpack
        file: runtime-ci/tasks/export-compiled-release-tarball/task.yml
        input_mapping:
          bbl-state: relint-envs
          manifest: updated-cf-deployment-python-buildpack-release-candidate
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
          RELEASE_NAME: python-buildpack
      - task: update-release-python-buildpack-develop
        file: runtime-ci/tasks/update-single-manifest-release/task.yml
        input_mapping:
          deployment-configuration: cf-deployment-develop
          release: python-buildpack-release
        output_mapping:
          updated-deployment-manifest: updated-cf-deployment-python-buildpack-develop
        params:
          RELEASE_NAME: python-buildpack
      - task: update-additional-ops-files-python-buildpack-develop
        file: runtime-ci/tasks/update-single-opsfile-release/task.yml
        input_mapping:
          original-ops-file: updated-cf-deployment-python-buildpack-develop
          release: python-buildpack-release
        output_mapping:
          updated-ops-file: updated-cf-deployment-python-buildpack-develop
        params:
          RELEASE_NAME: python-buildpack
      - task: update-compiled-releases-ops-file-python-buildpack-develop
        file: runtime-ci/tasks/update-single-compiled-release/task.yml
        input_mapping:
          original-compiled-releases-ops-file: updated-cf-deployment-python-buildpack-develop
          release: python-buildpack-release
        output_mapping:
          updated-compiled-releases-ops-file: updated-cf-deployment-python-buildpack-develop
        params:
          RELEASE_NAME: python-buildpack
          ORIGINAL_OPS_FILE_PATH: operations/use-compiled-releases.yml
          UPDATED_OPS_FILE_PATH: operations/use-compiled-releases.yml
      on_success:
        do:
        - put: python-buildpack-release-gcs
          params:
            file: compiled-release-tarball/*.tgz
            predefined_acl: publicRead
        - put: cf-deployment-develop
          params:
            rebase: true
            repository: updated-cf-deployment-python-buildpack-develop
      on_failure:
        do:
        - task: push-to-release-branch
          file: runtime-ci/tasks/push-to-release-branch/task.yml
          input_mapping:
            updated-cf-deployment: updated-cf-deployment-python-buildpack-release-candidate
            release: python-buildpack-release
          params:
            DEPLOY_KEY: ((cf_deployment_readwrite_deploy_key.private_key))
            RELEASE_NAME: python-buildpack
        - task: retrieve-bosh-logs
          file: runtime-ci/tasks/retrieve-bosh-logs/task.yml
          input_mapping:
            bbl-state: relint-envs
          params:
            BBL_STATE_DIR: environments/test/pre-dev/bbl-state
        - put: python-buildpack-component-bump-logs-gcs
          params:
            file: bosh-logs/cf-*.tgz
        ensure:
          do:
          - task: create-slack-message
            file: runtime-ci/tasks/create-slack-message/task.yml
            input_mapping:
              release: python-buildpack-release
            params:
              RELEASE_NAME: python-buildpack
              REPOSITORY: cloudfoundry/python-buildpack-release
              BOSH_LOGS_PREFIX: https://storage.cloud.google.com/component-bump-logs/python-buildpack
          - put: slack-alert
            params:
              text_file: slack-message/message.txt
              username: Release Integration
              icon_emoji: ':cloudfoundrylogo:'
    ensure:
      do:
      - task: delete-deployment
        file: cf-deployment-concourse-tasks/bosh-delete-deployment/task.yml
        input_mapping:
          bbl-state: relint-envs
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
      - task: remove-gcp-dns
        file: runtime-ci/tasks/manage-gcp-dns/task.yml
        input_mapping:
          bbl-state: relint-envs
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
          GCP_DNS_SERVICE_ACCOUNT_KEY: ((concourse_gcp_service_account_json))
          GCP_DNS_ZONE_NAME: test-relint-rocks
          GCP_DNS_RECORD_SET_NAME: pre-dev.test.relint.rocks
          ACTION: remove
      - task: bbl-down
        file: cf-deployment-concourse-tasks/bbl-destroy/task.yml
        input_mapping:
          bbl-state: relint-envs
        params:
          BBL_GCP_SERVICE_ACCOUNT_KEY: environments/test/pre-dev/google_account_creds.json
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
        ensure:
          put: relint-envs
          params:
            repository: updated-bbl-state
            rebase: true
- name: update-pxc
  serial_groups:
  - update-release
  public: true
  plan:
  - aggregate:
    - get: pxc-release
      trigger: true
      params:
        tarball: false
    - get: cf-deployment-release-candidate
    - get: cf-deployment-develop
    - get: stemcell
      params:
        tarball: false
    - get: cf-deployment-concourse-tasks
    - get: runtime-ci
    - get: relint-envs
    - get: relint-team
  - task: update-release-pxc-release-candidate
    file: runtime-ci/tasks/update-single-manifest-release/task.yml
    input_mapping:
      deployment-configuration: cf-deployment-release-candidate
      release: pxc-release
    output_mapping:
      updated-deployment-manifest: updated-cf-deployment-pxc-release-candidate
    params:
      RELEASE_NAME: pxc
  - task: update-additional-ops-files-pxc-release-candidate
    file: runtime-ci/tasks/update-single-opsfile-release/task.yml
    input_mapping:
      original-ops-file: updated-cf-deployment-pxc-release-candidate
      release: pxc-release
    output_mapping:
      updated-ops-file: updated-cf-deployment-pxc-release-candidate
    params:
      RELEASE_NAME: pxc
  - do:
    - task: bbl-up
      file: cf-deployment-concourse-tasks/bbl-up/task.yml
      params:
        BBL_STATE_DIR: environments/test/pre-dev/bbl-state
        BBL_IAAS: gcp
        BBL_ENV_NAME: pre-dev
        BBL_GCP_SERVICE_ACCOUNT_KEY: environments/test/pre-dev/google_account_creds.json
        BBL_GCP_REGION: us-central1
        BBL_LB_CERT: ((pre_dev_cf_lb_cert.certificate))
        BBL_LB_KEY: ((pre_dev_cf_lb_cert.private_key))
        LB_DOMAIN: pre-dev.test.relint.rocks
      input_mapping:
        bbl-state: relint-envs
        bbl-config: relint-envs
      ensure:
        put: relint-envs
        params:
          repository: updated-bbl-state
          rebase: true
    - task: add-gcp-dns
      file: runtime-ci/tasks/manage-gcp-dns/task.yml
      input_mapping:
        bbl-state: relint-envs
      params:
        BBL_STATE_DIR: environments/test/pre-dev/bbl-state
        GCP_DNS_SERVICE_ACCOUNT_KEY: ((concourse_gcp_service_account_json))
        GCP_DNS_ZONE_NAME: test-relint-rocks
        GCP_DNS_RECORD_SET_NAME: pre-dev.test.relint.rocks
        ACTION: add
    - do:
      - task: deploy-cf
        file: cf-deployment-concourse-tasks/bosh-deploy/task.yml
        input_mapping:
          bbl-state: relint-envs
          cf-deployment: updated-cf-deployment-pxc-release-candidate
          ops-files: updated-cf-deployment-pxc-release-candidate
          vars-files: relint-envs
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
          SYSTEM_DOMAIN: pre-dev.test.relint.rocks
          OPS_FILES: |
            operations/experimental/fast-deploy-with-downtime-and-danger.yml
          REGENERATE_CREDENTIALS: false
          BOSH_DEPLOY_ARGS: --parallel 50
      - task: run-errand-smoke-tests
        file: cf-deployment-concourse-tasks/run-errand/task.yml
        input_mapping:
          bbl-state: relint-envs
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
          ERRAND_NAME: smoke-tests
      - task: export-compiled-release-pxc
        file: runtime-ci/tasks/export-compiled-release-tarball/task.yml
        input_mapping:
          bbl-state: relint-envs
          manifest: updated-cf-deployment-pxc-release-candidate
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
          RELEASE_NAME: pxc
      - task: update-release-pxc-develop
        file: runtime-ci/tasks/update-single-manifest-release/task.yml
        input_mapping:
          deployment-configuration: cf-deployment-develop
          release: pxc-release
        output_mapping:
          updated-deployment-manifest: updated-cf-deployment-pxc-develop
        params:
          RELEASE_NAME: pxc
      - task: update-additional-ops-files-pxc-develop
        file: runtime-ci/tasks/update-single-opsfile-release/task.yml
        input_mapping:
          original-ops-file: updated-cf-deployment-pxc-develop
          release: pxc-release
        output_mapping:
          updated-ops-file: updated-cf-deployment-pxc-develop
        params:
          RELEASE_NAME: pxc
      - task: update-compiled-releases-ops-file-pxc-develop
        file: runtime-ci/tasks/update-single-compiled-release/task.yml
        input_mapping:
          original-compiled-releases-ops-file: updated-cf-deployment-pxc-develop
          release: pxc-release
        output_mapping:
          updated-compiled-releases-ops-file: updated-cf-deployment-pxc-develop
        params:
          RELEASE_NAME: pxc
          ORIGINAL_OPS_FILE_PATH: operations/use-compiled-releases.yml
          UPDATED_OPS_FILE_PATH: operations/use-compiled-releases.yml
      on_success:
        do:
        - put: pxc-release-gcs
          params:
            file: compiled-release-tarball/*.tgz
            predefined_acl: publicRead
        - put: cf-deployment-develop
          params:
            rebase: true
            repository: updated-cf-deployment-pxc-develop
      on_failure:
        do:
        - task: push-to-release-branch
          file: runtime-ci/tasks/push-to-release-branch/task.yml
          input_mapping:
            updated-cf-deployment: updated-cf-deployment-pxc-release-candidate
            release: pxc-release
          params:
            DEPLOY_KEY: ((cf_deployment_readwrite_deploy_key.private_key))
            RELEASE_NAME: pxc
        - task: retrieve-bosh-logs
          file: runtime-ci/tasks/retrieve-bosh-logs/task.yml
          input_mapping:
            bbl-state: relint-envs
          params:
            BBL_STATE_DIR: environments/test/pre-dev/bbl-state
        - put: pxc-component-bump-logs-gcs
          params:
            file: bosh-logs/cf-*.tgz
        ensure:
          do:
          - task: create-slack-message
            file: runtime-ci/tasks/create-slack-message/task.yml
            input_mapping:
              release: pxc-release
            params:
              RELEASE_NAME: pxc
              REPOSITORY: cloudfoundry-incubator/pxc-release
              BOSH_LOGS_PREFIX: https://storage.cloud.google.com/component-bump-logs/pxc
          - put: slack-alert
            params:
              text_file: slack-message/message.txt
              username: Release Integration
              icon_emoji: ':cloudfoundrylogo:'
    ensure:
      do:
      - task: delete-deployment
        file: cf-deployment-concourse-tasks/bosh-delete-deployment/task.yml
        input_mapping:
          bbl-state: relint-envs
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
      - task: remove-gcp-dns
        file: runtime-ci/tasks/manage-gcp-dns/task.yml
        input_mapping:
          bbl-state: relint-envs
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
          GCP_DNS_SERVICE_ACCOUNT_KEY: ((concourse_gcp_service_account_json))
          GCP_DNS_ZONE_NAME: test-relint-rocks
          GCP_DNS_RECORD_SET_NAME: pre-dev.test.relint.rocks
          ACTION: remove
      - task: bbl-down
        file: cf-deployment-concourse-tasks/bbl-destroy/task.yml
        input_mapping:
          bbl-state: relint-envs
        params:
          BBL_GCP_SERVICE_ACCOUNT_KEY: environments/test/pre-dev/google_account_creds.json
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
        ensure:
          put: relint-envs
          params:
            repository: updated-bbl-state
            rebase: true
- name: update-r-buildpack
  serial_groups:
  - update-release
  public: true
  plan:
  - aggregate:
    - get: r-buildpack-release
      trigger: true
      params:
        tarball: false
    - get: cf-deployment-release-candidate
    - get: cf-deployment-develop
    - get: stemcell
      params:
        tarball: false
    - get: cf-deployment-concourse-tasks
    - get: runtime-ci
    - get: relint-envs
    - get: relint-team
  - task: update-release-r-buildpack-release-candidate
    file: runtime-ci/tasks/update-single-manifest-release/task.yml
    input_mapping:
      deployment-configuration: cf-deployment-release-candidate
      release: r-buildpack-release
    output_mapping:
      updated-deployment-manifest: updated-cf-deployment-r-buildpack-release-candidate
    params:
      RELEASE_NAME: r-buildpack
  - task: update-additional-ops-files-r-buildpack-release-candidate
    file: runtime-ci/tasks/update-single-opsfile-release/task.yml
    input_mapping:
      original-ops-file: updated-cf-deployment-r-buildpack-release-candidate
      release: r-buildpack-release
    output_mapping:
      updated-ops-file: updated-cf-deployment-r-buildpack-release-candidate
    params:
      RELEASE_NAME: r-buildpack
  - do:
    - task: bbl-up
      file: cf-deployment-concourse-tasks/bbl-up/task.yml
      params:
        BBL_STATE_DIR: environments/test/pre-dev/bbl-state
        BBL_IAAS: gcp
        BBL_ENV_NAME: pre-dev
        BBL_GCP_SERVICE_ACCOUNT_KEY: environments/test/pre-dev/google_account_creds.json
        BBL_GCP_REGION: us-central1
        BBL_LB_CERT: ((pre_dev_cf_lb_cert.certificate))
        BBL_LB_KEY: ((pre_dev_cf_lb_cert.private_key))
        LB_DOMAIN: pre-dev.test.relint.rocks
      input_mapping:
        bbl-state: relint-envs
        bbl-config: relint-envs
      ensure:
        put: relint-envs
        params:
          repository: updated-bbl-state
          rebase: true
    - task: add-gcp-dns
      file: runtime-ci/tasks/manage-gcp-dns/task.yml
      input_mapping:
        bbl-state: relint-envs
      params:
        BBL_STATE_DIR: environments/test/pre-dev/bbl-state
        GCP_DNS_SERVICE_ACCOUNT_KEY: ((concourse_gcp_service_account_json))
        GCP_DNS_ZONE_NAME: test-relint-rocks
        GCP_DNS_RECORD_SET_NAME: pre-dev.test.relint.rocks
        ACTION: add
    - do:
      - task: deploy-cf
        file: cf-deployment-concourse-tasks/bosh-deploy/task.yml
        input_mapping:
          bbl-state: relint-envs
          cf-deployment: updated-cf-deployment-r-buildpack-release-candidate
          ops-files: updated-cf-deployment-r-buildpack-release-candidate
          vars-files: relint-envs
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
          SYSTEM_DOMAIN: pre-dev.test.relint.rocks
          OPS_FILES: |
            operations/experimental/fast-deploy-with-downtime-and-danger.yml
          REGENERATE_CREDENTIALS: false
          BOSH_DEPLOY_ARGS: --parallel 50
      - task: run-errand-smoke-tests
        file: cf-deployment-concourse-tasks/run-errand/task.yml
        input_mapping:
          bbl-state: relint-envs
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
          ERRAND_NAME: smoke-tests
      - task: export-compiled-release-r-buildpack
        file: runtime-ci/tasks/export-compiled-release-tarball/task.yml
        input_mapping:
          bbl-state: relint-envs
          manifest: updated-cf-deployment-r-buildpack-release-candidate
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
          RELEASE_NAME: r-buildpack
      - task: update-release-r-buildpack-develop
        file: runtime-ci/tasks/update-single-manifest-release/task.yml
        input_mapping:
          deployment-configuration: cf-deployment-develop
          release: r-buildpack-release
        output_mapping:
          updated-deployment-manifest: updated-cf-deployment-r-buildpack-develop
        params:
          RELEASE_NAME: r-buildpack
      - task: update-additional-ops-files-r-buildpack-develop
        file: runtime-ci/tasks/update-single-opsfile-release/task.yml
        input_mapping:
          original-ops-file: updated-cf-deployment-r-buildpack-develop
          release: r-buildpack-release
        output_mapping:
          updated-ops-file: updated-cf-deployment-r-buildpack-develop
        params:
          RELEASE_NAME: r-buildpack
      - task: update-compiled-releases-ops-file-r-buildpack-develop
        file: runtime-ci/tasks/update-single-compiled-release/task.yml
        input_mapping:
          original-compiled-releases-ops-file: updated-cf-deployment-r-buildpack-develop
          release: r-buildpack-release
        output_mapping:
          updated-compiled-releases-ops-file: updated-cf-deployment-r-buildpack-develop
        params:
          RELEASE_NAME: r-buildpack
          ORIGINAL_OPS_FILE_PATH: operations/use-compiled-releases.yml
          UPDATED_OPS_FILE_PATH: operations/use-compiled-releases.yml
      on_success:
        do:
        - put: r-buildpack-release-gcs
          params:
            file: compiled-release-tarball/*.tgz
            predefined_acl: publicRead
        - put: cf-deployment-develop
          params:
            rebase: true
            repository: updated-cf-deployment-r-buildpack-develop
      on_failure:
        do:
        - task: push-to-release-branch
          file: runtime-ci/tasks/push-to-release-branch/task.yml
          input_mapping:
            updated-cf-deployment: updated-cf-deployment-r-buildpack-release-candidate
            release: r-buildpack-release
          params:
            DEPLOY_KEY: ((cf_deployment_readwrite_deploy_key.private_key))
            RELEASE_NAME: r-buildpack
        - task: retrieve-bosh-logs
          file: runtime-ci/tasks/retrieve-bosh-logs/task.yml
          input_mapping:
            bbl-state: relint-envs
          params:
            BBL_STATE_DIR: environments/test/pre-dev/bbl-state
        - put: r-buildpack-component-bump-logs-gcs
          params:
            file: bosh-logs/cf-*.tgz
        ensure:
          do:
          - task: create-slack-message
            file: runtime-ci/tasks/create-slack-message/task.yml
            input_mapping:
              release: r-buildpack-release
            params:
              RELEASE_NAME: r-buildpack
              REPOSITORY: cloudfoundry/r-buildpack-release
              BOSH_LOGS_PREFIX: https://storage.cloud.google.com/component-bump-logs/r-buildpack
          - put: slack-alert
            params:
              text_file: slack-message/message.txt
              username: Release Integration
              icon_emoji: ':cloudfoundrylogo:'
    ensure:
      do:
      - task: delete-deployment
        file: cf-deployment-concourse-tasks/bosh-delete-deployment/task.yml
        input_mapping:
          bbl-state: relint-envs
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
      - task: remove-gcp-dns
        file: runtime-ci/tasks/manage-gcp-dns/task.yml
        input_mapping:
          bbl-state: relint-envs
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
          GCP_DNS_SERVICE_ACCOUNT_KEY: ((concourse_gcp_service_account_json))
          GCP_DNS_ZONE_NAME: test-relint-rocks
          GCP_DNS_RECORD_SET_NAME: pre-dev.test.relint.rocks
          ACTION: remove
      - task: bbl-down
        file: cf-deployment-concourse-tasks/bbl-destroy/task.yml
        input_mapping:
          bbl-state: relint-envs
        params:
          BBL_GCP_SERVICE_ACCOUNT_KEY: environments/test/pre-dev/google_account_creds.json
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
        ensure:
          put: relint-envs
          params:
            repository: updated-bbl-state
            rebase: true
- name: update-routing
  serial_groups:
  - update-release
  public: true
  plan:
  - aggregate:
    - get: routing-release
      trigger: true
      params:
        tarball: false
    - get: cf-deployment-release-candidate
    - get: cf-deployment-develop
    - get: stemcell
      params:
        tarball: false
    - get: cf-deployment-concourse-tasks
    - get: runtime-ci
    - get: relint-envs
    - get: relint-team
  - task: update-release-routing-release-candidate
    file: runtime-ci/tasks/update-single-manifest-release/task.yml
    input_mapping:
      deployment-configuration: cf-deployment-release-candidate
      release: routing-release
    output_mapping:
      updated-deployment-manifest: updated-cf-deployment-routing-release-candidate
    params:
      RELEASE_NAME: routing
  - task: update-additional-ops-files-routing-release-candidate
    file: runtime-ci/tasks/update-single-opsfile-release/task.yml
    input_mapping:
      original-ops-file: updated-cf-deployment-routing-release-candidate
      release: routing-release
    output_mapping:
      updated-ops-file: updated-cf-deployment-routing-release-candidate
    params:
      RELEASE_NAME: routing
  - do:
    - task: bbl-up
      file: cf-deployment-concourse-tasks/bbl-up/task.yml
      params:
        BBL_STATE_DIR: environments/test/pre-dev/bbl-state
        BBL_IAAS: gcp
        BBL_ENV_NAME: pre-dev
        BBL_GCP_SERVICE_ACCOUNT_KEY: environments/test/pre-dev/google_account_creds.json
        BBL_GCP_REGION: us-central1
        BBL_LB_CERT: ((pre_dev_cf_lb_cert.certificate))
        BBL_LB_KEY: ((pre_dev_cf_lb_cert.private_key))
        LB_DOMAIN: pre-dev.test.relint.rocks
      input_mapping:
        bbl-state: relint-envs
        bbl-config: relint-envs
      ensure:
        put: relint-envs
        params:
          repository: updated-bbl-state
          rebase: true
    - task: add-gcp-dns
      file: runtime-ci/tasks/manage-gcp-dns/task.yml
      input_mapping:
        bbl-state: relint-envs
      params:
        BBL_STATE_DIR: environments/test/pre-dev/bbl-state
        GCP_DNS_SERVICE_ACCOUNT_KEY: ((concourse_gcp_service_account_json))
        GCP_DNS_ZONE_NAME: test-relint-rocks
        GCP_DNS_RECORD_SET_NAME: pre-dev.test.relint.rocks
        ACTION: add
    - do:
      - task: deploy-cf
        file: cf-deployment-concourse-tasks/bosh-deploy/task.yml
        input_mapping:
          bbl-state: relint-envs
          cf-deployment: updated-cf-deployment-routing-release-candidate
          ops-files: updated-cf-deployment-routing-release-candidate
          vars-files: relint-envs
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
          SYSTEM_DOMAIN: pre-dev.test.relint.rocks
          OPS_FILES: |
            operations/experimental/fast-deploy-with-downtime-and-danger.yml
          REGENERATE_CREDENTIALS: false
          BOSH_DEPLOY_ARGS: --parallel 50
      - task: run-errand-smoke-tests
        file: cf-deployment-concourse-tasks/run-errand/task.yml
        input_mapping:
          bbl-state: relint-envs
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
          ERRAND_NAME: smoke-tests
      - task: export-compiled-release-routing
        file: runtime-ci/tasks/export-compiled-release-tarball/task.yml
        input_mapping:
          bbl-state: relint-envs
          manifest: updated-cf-deployment-routing-release-candidate
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
          RELEASE_NAME: routing
      - task: update-release-routing-develop
        file: runtime-ci/tasks/update-single-manifest-release/task.yml
        input_mapping:
          deployment-configuration: cf-deployment-develop
          release: routing-release
        output_mapping:
          updated-deployment-manifest: updated-cf-deployment-routing-develop
        params:
          RELEASE_NAME: routing
      - task: update-additional-ops-files-routing-develop
        file: runtime-ci/tasks/update-single-opsfile-release/task.yml
        input_mapping:
          original-ops-file: updated-cf-deployment-routing-develop
          release: routing-release
        output_mapping:
          updated-ops-file: updated-cf-deployment-routing-develop
        params:
          RELEASE_NAME: routing
      - task: update-compiled-releases-ops-file-routing-develop
        file: runtime-ci/tasks/update-single-compiled-release/task.yml
        input_mapping:
          original-compiled-releases-ops-file: updated-cf-deployment-routing-develop
          release: routing-release
        output_mapping:
          updated-compiled-releases-ops-file: updated-cf-deployment-routing-develop
        params:
          RELEASE_NAME: routing
          ORIGINAL_OPS_FILE_PATH: operations/use-compiled-releases.yml
          UPDATED_OPS_FILE_PATH: operations/use-compiled-releases.yml
      on_success:
        do:
        - put: routing-release-gcs
          params:
            file: compiled-release-tarball/*.tgz
            predefined_acl: publicRead
        - put: cf-deployment-develop
          params:
            rebase: true
            repository: updated-cf-deployment-routing-develop
      on_failure:
        do:
        - task: push-to-release-branch
          file: runtime-ci/tasks/push-to-release-branch/task.yml
          input_mapping:
            updated-cf-deployment: updated-cf-deployment-routing-release-candidate
            release: routing-release
          params:
            DEPLOY_KEY: ((cf_deployment_readwrite_deploy_key.private_key))
            RELEASE_NAME: routing
        - task: retrieve-bosh-logs
          file: runtime-ci/tasks/retrieve-bosh-logs/task.yml
          input_mapping:
            bbl-state: relint-envs
          params:
            BBL_STATE_DIR: environments/test/pre-dev/bbl-state
        - put: routing-component-bump-logs-gcs
          params:
            file: bosh-logs/cf-*.tgz
        ensure:
          do:
          - task: create-slack-message
            file: runtime-ci/tasks/create-slack-message/task.yml
            input_mapping:
              release: routing-release
            params:
              RELEASE_NAME: routing
              REPOSITORY: cloudfoundry-incubator/cf-routing-release
              BOSH_LOGS_PREFIX: https://storage.cloud.google.com/component-bump-logs/routing
          - put: slack-alert
            params:
              text_file: slack-message/message.txt
              username: Release Integration
              icon_emoji: ':cloudfoundrylogo:'
    ensure:
      do:
      - task: delete-deployment
        file: cf-deployment-concourse-tasks/bosh-delete-deployment/task.yml
        input_mapping:
          bbl-state: relint-envs
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
      - task: remove-gcp-dns
        file: runtime-ci/tasks/manage-gcp-dns/task.yml
        input_mapping:
          bbl-state: relint-envs
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
          GCP_DNS_SERVICE_ACCOUNT_KEY: ((concourse_gcp_service_account_json))
          GCP_DNS_ZONE_NAME: test-relint-rocks
          GCP_DNS_RECORD_SET_NAME: pre-dev.test.relint.rocks
          ACTION: remove
      - task: bbl-down
        file: cf-deployment-concourse-tasks/bbl-destroy/task.yml
        input_mapping:
          bbl-state: relint-envs
        params:
          BBL_GCP_SERVICE_ACCOUNT_KEY: environments/test/pre-dev/google_account_creds.json
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
        ensure:
          put: relint-envs
          params:
            repository: updated-bbl-state
            rebase: true
- name: update-ruby-buildpack
  serial_groups:
  - update-release
  public: true
  plan:
  - aggregate:
    - get: ruby-buildpack-release
      trigger: true
      params:
        tarball: false
    - get: cf-deployment-release-candidate
    - get: cf-deployment-develop
    - get: stemcell
      params:
        tarball: false
    - get: cf-deployment-concourse-tasks
    - get: runtime-ci
    - get: relint-envs
    - get: relint-team
  - task: update-release-ruby-buildpack-release-candidate
    file: runtime-ci/tasks/update-single-manifest-release/task.yml
    input_mapping:
      deployment-configuration: cf-deployment-release-candidate
      release: ruby-buildpack-release
    output_mapping:
      updated-deployment-manifest: updated-cf-deployment-ruby-buildpack-release-candidate
    params:
      RELEASE_NAME: ruby-buildpack
  - task: update-additional-ops-files-ruby-buildpack-release-candidate
    file: runtime-ci/tasks/update-single-opsfile-release/task.yml
    input_mapping:
      original-ops-file: updated-cf-deployment-ruby-buildpack-release-candidate
      release: ruby-buildpack-release
    output_mapping:
      updated-ops-file: updated-cf-deployment-ruby-buildpack-release-candidate
    params:
      RELEASE_NAME: ruby-buildpack
  - do:
    - task: bbl-up
      file: cf-deployment-concourse-tasks/bbl-up/task.yml
      params:
        BBL_STATE_DIR: environments/test/pre-dev/bbl-state
        BBL_IAAS: gcp
        BBL_ENV_NAME: pre-dev
        BBL_GCP_SERVICE_ACCOUNT_KEY: environments/test/pre-dev/google_account_creds.json
        BBL_GCP_REGION: us-central1
        BBL_LB_CERT: ((pre_dev_cf_lb_cert.certificate))
        BBL_LB_KEY: ((pre_dev_cf_lb_cert.private_key))
        LB_DOMAIN: pre-dev.test.relint.rocks
      input_mapping:
        bbl-state: relint-envs
        bbl-config: relint-envs
      ensure:
        put: relint-envs
        params:
          repository: updated-bbl-state
          rebase: true
    - task: add-gcp-dns
      file: runtime-ci/tasks/manage-gcp-dns/task.yml
      input_mapping:
        bbl-state: relint-envs
      params:
        BBL_STATE_DIR: environments/test/pre-dev/bbl-state
        GCP_DNS_SERVICE_ACCOUNT_KEY: ((concourse_gcp_service_account_json))
        GCP_DNS_ZONE_NAME: test-relint-rocks
        GCP_DNS_RECORD_SET_NAME: pre-dev.test.relint.rocks
        ACTION: add
    - do:
      - task: deploy-cf
        file: cf-deployment-concourse-tasks/bosh-deploy/task.yml
        input_mapping:
          bbl-state: relint-envs
          cf-deployment: updated-cf-deployment-ruby-buildpack-release-candidate
          ops-files: updated-cf-deployment-ruby-buildpack-release-candidate
          vars-files: relint-envs
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
          SYSTEM_DOMAIN: pre-dev.test.relint.rocks
          OPS_FILES: |
            operations/experimental/fast-deploy-with-downtime-and-danger.yml
          REGENERATE_CREDENTIALS: false
          BOSH_DEPLOY_ARGS: --parallel 50
      - task: run-errand-smoke-tests
        file: cf-deployment-concourse-tasks/run-errand/task.yml
        input_mapping:
          bbl-state: relint-envs
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
          ERRAND_NAME: smoke-tests
      - task: export-compiled-release-ruby-buildpack
        file: runtime-ci/tasks/export-compiled-release-tarball/task.yml
        input_mapping:
          bbl-state: relint-envs
          manifest: updated-cf-deployment-ruby-buildpack-release-candidate
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
          RELEASE_NAME: ruby-buildpack
      - task: update-release-ruby-buildpack-develop
        file: runtime-ci/tasks/update-single-manifest-release/task.yml
        input_mapping:
          deployment-configuration: cf-deployment-develop
          release: ruby-buildpack-release
        output_mapping:
          updated-deployment-manifest: updated-cf-deployment-ruby-buildpack-develop
        params:
          RELEASE_NAME: ruby-buildpack
      - task: update-additional-ops-files-ruby-buildpack-develop
        file: runtime-ci/tasks/update-single-opsfile-release/task.yml
        input_mapping:
          original-ops-file: updated-cf-deployment-ruby-buildpack-develop
          release: ruby-buildpack-release
        output_mapping:
          updated-ops-file: updated-cf-deployment-ruby-buildpack-develop
        params:
          RELEASE_NAME: ruby-buildpack
      - task: update-compiled-releases-ops-file-ruby-buildpack-develop
        file: runtime-ci/tasks/update-single-compiled-release/task.yml
        input_mapping:
          original-compiled-releases-ops-file: updated-cf-deployment-ruby-buildpack-develop
          release: ruby-buildpack-release
        output_mapping:
          updated-compiled-releases-ops-file: updated-cf-deployment-ruby-buildpack-develop
        params:
          RELEASE_NAME: ruby-buildpack
          ORIGINAL_OPS_FILE_PATH: operations/use-compiled-releases.yml
          UPDATED_OPS_FILE_PATH: operations/use-compiled-releases.yml
      on_success:
        do:
        - put: ruby-buildpack-release-gcs
          params:
            file: compiled-release-tarball/*.tgz
            predefined_acl: publicRead
        - put: cf-deployment-develop
          params:
            rebase: true
            repository: updated-cf-deployment-ruby-buildpack-develop
      on_failure:
        do:
        - task: push-to-release-branch
          file: runtime-ci/tasks/push-to-release-branch/task.yml
          input_mapping:
            updated-cf-deployment: updated-cf-deployment-ruby-buildpack-release-candidate
            release: ruby-buildpack-release
          params:
            DEPLOY_KEY: ((cf_deployment_readwrite_deploy_key.private_key))
            RELEASE_NAME: ruby-buildpack
        - task: retrieve-bosh-logs
          file: runtime-ci/tasks/retrieve-bosh-logs/task.yml
          input_mapping:
            bbl-state: relint-envs
          params:
            BBL_STATE_DIR: environments/test/pre-dev/bbl-state
        - put: ruby-buildpack-component-bump-logs-gcs
          params:
            file: bosh-logs/cf-*.tgz
        ensure:
          do:
          - task: create-slack-message
            file: runtime-ci/tasks/create-slack-message/task.yml
            input_mapping:
              release: ruby-buildpack-release
            params:
              RELEASE_NAME: ruby-buildpack
              REPOSITORY: cloudfoundry/ruby-buildpack-release
              BOSH_LOGS_PREFIX: https://storage.cloud.google.com/component-bump-logs/ruby-buildpack
          - put: slack-alert
            params:
              text_file: slack-message/message.txt
              username: Release Integration
              icon_emoji: ':cloudfoundrylogo:'
    ensure:
      do:
      - task: delete-deployment
        file: cf-deployment-concourse-tasks/bosh-delete-deployment/task.yml
        input_mapping:
          bbl-state: relint-envs
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
      - task: remove-gcp-dns
        file: runtime-ci/tasks/manage-gcp-dns/task.yml
        input_mapping:
          bbl-state: relint-envs
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
          GCP_DNS_SERVICE_ACCOUNT_KEY: ((concourse_gcp_service_account_json))
          GCP_DNS_ZONE_NAME: test-relint-rocks
          GCP_DNS_RECORD_SET_NAME: pre-dev.test.relint.rocks
          ACTION: remove
      - task: bbl-down
        file: cf-deployment-concourse-tasks/bbl-destroy/task.yml
        input_mapping:
          bbl-state: relint-envs
        params:
          BBL_GCP_SERVICE_ACCOUNT_KEY: environments/test/pre-dev/google_account_creds.json
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
        ensure:
          put: relint-envs
          params:
            repository: updated-bbl-state
            rebase: true
- name: update-silk
  serial_groups:
  - update-release
  public: true
  plan:
  - aggregate:
    - get: silk-release
      trigger: true
      params:
        tarball: false
    - get: cf-deployment-release-candidate
    - get: cf-deployment-develop
    - get: stemcell
      params:
        tarball: false
    - get: cf-deployment-concourse-tasks
    - get: runtime-ci
    - get: relint-envs
    - get: relint-team
  - task: update-release-silk-release-candidate
    file: runtime-ci/tasks/update-single-manifest-release/task.yml
    input_mapping:
      deployment-configuration: cf-deployment-release-candidate
      release: silk-release
    output_mapping:
      updated-deployment-manifest: updated-cf-deployment-silk-release-candidate
    params:
      RELEASE_NAME: silk
  - task: update-additional-ops-files-silk-release-candidate
    file: runtime-ci/tasks/update-single-opsfile-release/task.yml
    input_mapping:
      original-ops-file: updated-cf-deployment-silk-release-candidate
      release: silk-release
    output_mapping:
      updated-ops-file: updated-cf-deployment-silk-release-candidate
    params:
      RELEASE_NAME: silk
  - do:
    - task: bbl-up
      file: cf-deployment-concourse-tasks/bbl-up/task.yml
      params:
        BBL_STATE_DIR: environments/test/pre-dev/bbl-state
        BBL_IAAS: gcp
        BBL_ENV_NAME: pre-dev
        BBL_GCP_SERVICE_ACCOUNT_KEY: environments/test/pre-dev/google_account_creds.json
        BBL_GCP_REGION: us-central1
        BBL_LB_CERT: ((pre_dev_cf_lb_cert.certificate))
        BBL_LB_KEY: ((pre_dev_cf_lb_cert.private_key))
        LB_DOMAIN: pre-dev.test.relint.rocks
      input_mapping:
        bbl-state: relint-envs
        bbl-config: relint-envs
      ensure:
        put: relint-envs
        params:
          repository: updated-bbl-state
          rebase: true
    - task: add-gcp-dns
      file: runtime-ci/tasks/manage-gcp-dns/task.yml
      input_mapping:
        bbl-state: relint-envs
      params:
        BBL_STATE_DIR: environments/test/pre-dev/bbl-state
        GCP_DNS_SERVICE_ACCOUNT_KEY: ((concourse_gcp_service_account_json))
        GCP_DNS_ZONE_NAME: test-relint-rocks
        GCP_DNS_RECORD_SET_NAME: pre-dev.test.relint.rocks
        ACTION: add
    - do:
      - task: deploy-cf
        file: cf-deployment-concourse-tasks/bosh-deploy/task.yml
        input_mapping:
          bbl-state: relint-envs
          cf-deployment: updated-cf-deployment-silk-release-candidate
          ops-files: updated-cf-deployment-silk-release-candidate
          vars-files: relint-envs
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
          SYSTEM_DOMAIN: pre-dev.test.relint.rocks
          OPS_FILES: |
            operations/experimental/fast-deploy-with-downtime-and-danger.yml
          REGENERATE_CREDENTIALS: false
          BOSH_DEPLOY_ARGS: --parallel 50
      - task: run-errand-smoke-tests
        file: cf-deployment-concourse-tasks/run-errand/task.yml
        input_mapping:
          bbl-state: relint-envs
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
          ERRAND_NAME: smoke-tests
      - task: export-compiled-release-silk
        file: runtime-ci/tasks/export-compiled-release-tarball/task.yml
        input_mapping:
          bbl-state: relint-envs
          manifest: updated-cf-deployment-silk-release-candidate
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
          RELEASE_NAME: silk
      - task: update-release-silk-develop
        file: runtime-ci/tasks/update-single-manifest-release/task.yml
        input_mapping:
          deployment-configuration: cf-deployment-develop
          release: silk-release
        output_mapping:
          updated-deployment-manifest: updated-cf-deployment-silk-develop
        params:
          RELEASE_NAME: silk
      - task: update-additional-ops-files-silk-develop
        file: runtime-ci/tasks/update-single-opsfile-release/task.yml
        input_mapping:
          original-ops-file: updated-cf-deployment-silk-develop
          release: silk-release
        output_mapping:
          updated-ops-file: updated-cf-deployment-silk-develop
        params:
          RELEASE_NAME: silk
      - task: update-compiled-releases-ops-file-silk-develop
        file: runtime-ci/tasks/update-single-compiled-release/task.yml
        input_mapping:
          original-compiled-releases-ops-file: updated-cf-deployment-silk-develop
          release: silk-release
        output_mapping:
          updated-compiled-releases-ops-file: updated-cf-deployment-silk-develop
        params:
          RELEASE_NAME: silk
          ORIGINAL_OPS_FILE_PATH: operations/use-compiled-releases.yml
          UPDATED_OPS_FILE_PATH: operations/use-compiled-releases.yml
      on_success:
        do:
        - put: silk-release-gcs
          params:
            file: compiled-release-tarball/*.tgz
            predefined_acl: publicRead
        - put: cf-deployment-develop
          params:
            rebase: true
            repository: updated-cf-deployment-silk-develop
      on_failure:
        do:
        - task: push-to-release-branch
          file: runtime-ci/tasks/push-to-release-branch/task.yml
          input_mapping:
            updated-cf-deployment: updated-cf-deployment-silk-release-candidate
            release: silk-release
          params:
            DEPLOY_KEY: ((cf_deployment_readwrite_deploy_key.private_key))
            RELEASE_NAME: silk
        - task: retrieve-bosh-logs
          file: runtime-ci/tasks/retrieve-bosh-logs/task.yml
          input_mapping:
            bbl-state: relint-envs
          params:
            BBL_STATE_DIR: environments/test/pre-dev/bbl-state
        - put: silk-component-bump-logs-gcs
          params:
            file: bosh-logs/cf-*.tgz
        ensure:
          do:
          - task: create-slack-message
            file: runtime-ci/tasks/create-slack-message/task.yml
            input_mapping:
              release: silk-release
            params:
              RELEASE_NAME: silk
              REPOSITORY: cloudfoundry/silk-release
              BOSH_LOGS_PREFIX: https://storage.cloud.google.com/component-bump-logs/silk
          - put: slack-alert
            params:
              text_file: slack-message/message.txt
              username: Release Integration
              icon_emoji: ':cloudfoundrylogo:'
    ensure:
      do:
      - task: delete-deployment
        file: cf-deployment-concourse-tasks/bosh-delete-deployment/task.yml
        input_mapping:
          bbl-state: relint-envs
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
      - task: remove-gcp-dns
        file: runtime-ci/tasks/manage-gcp-dns/task.yml
        input_mapping:
          bbl-state: relint-envs
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
          GCP_DNS_SERVICE_ACCOUNT_KEY: ((concourse_gcp_service_account_json))
          GCP_DNS_ZONE_NAME: test-relint-rocks
          GCP_DNS_RECORD_SET_NAME: pre-dev.test.relint.rocks
          ACTION: remove
      - task: bbl-down
        file: cf-deployment-concourse-tasks/bbl-destroy/task.yml
        input_mapping:
          bbl-state: relint-envs
        params:
          BBL_GCP_SERVICE_ACCOUNT_KEY: environments/test/pre-dev/google_account_creds.json
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
        ensure:
          put: relint-envs
          params:
            repository: updated-bbl-state
            rebase: true
- name: update-staticfile-buildpack
  serial_groups:
  - update-release
  public: true
  plan:
  - aggregate:
    - get: staticfile-buildpack-release
      trigger: true
      params:
        tarball: false
    - get: cf-deployment-release-candidate
    - get: cf-deployment-develop
    - get: stemcell
      params:
        tarball: false
    - get: cf-deployment-concourse-tasks
    - get: runtime-ci
    - get: relint-envs
    - get: relint-team
  - task: update-release-staticfile-buildpack-release-candidate
    file: runtime-ci/tasks/update-single-manifest-release/task.yml
    input_mapping:
      deployment-configuration: cf-deployment-release-candidate
      release: staticfile-buildpack-release
    output_mapping:
      updated-deployment-manifest: updated-cf-deployment-staticfile-buildpack-release-candidate
    params:
      RELEASE_NAME: staticfile-buildpack
  - task: update-additional-ops-files-staticfile-buildpack-release-candidate
    file: runtime-ci/tasks/update-single-opsfile-release/task.yml
    input_mapping:
      original-ops-file: updated-cf-deployment-staticfile-buildpack-release-candidate
      release: staticfile-buildpack-release
    output_mapping:
      updated-ops-file: updated-cf-deployment-staticfile-buildpack-release-candidate
    params:
      RELEASE_NAME: staticfile-buildpack
  - do:
    - task: bbl-up
      file: cf-deployment-concourse-tasks/bbl-up/task.yml
      params:
        BBL_STATE_DIR: environments/test/pre-dev/bbl-state
        BBL_IAAS: gcp
        BBL_ENV_NAME: pre-dev
        BBL_GCP_SERVICE_ACCOUNT_KEY: environments/test/pre-dev/google_account_creds.json
        BBL_GCP_REGION: us-central1
        BBL_LB_CERT: ((pre_dev_cf_lb_cert.certificate))
        BBL_LB_KEY: ((pre_dev_cf_lb_cert.private_key))
        LB_DOMAIN: pre-dev.test.relint.rocks
      input_mapping:
        bbl-state: relint-envs
        bbl-config: relint-envs
      ensure:
        put: relint-envs
        params:
          repository: updated-bbl-state
          rebase: true
    - task: add-gcp-dns
      file: runtime-ci/tasks/manage-gcp-dns/task.yml
      input_mapping:
        bbl-state: relint-envs
      params:
        BBL_STATE_DIR: environments/test/pre-dev/bbl-state
        GCP_DNS_SERVICE_ACCOUNT_KEY: ((concourse_gcp_service_account_json))
        GCP_DNS_ZONE_NAME: test-relint-rocks
        GCP_DNS_RECORD_SET_NAME: pre-dev.test.relint.rocks
        ACTION: add
    - do:
      - task: deploy-cf
        file: cf-deployment-concourse-tasks/bosh-deploy/task.yml
        input_mapping:
          bbl-state: relint-envs
          cf-deployment: updated-cf-deployment-staticfile-buildpack-release-candidate
          ops-files: updated-cf-deployment-staticfile-buildpack-release-candidate
          vars-files: relint-envs
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
          SYSTEM_DOMAIN: pre-dev.test.relint.rocks
          OPS_FILES: |
            operations/experimental/fast-deploy-with-downtime-and-danger.yml
          REGENERATE_CREDENTIALS: false
          BOSH_DEPLOY_ARGS: --parallel 50
      - task: run-errand-smoke-tests
        file: cf-deployment-concourse-tasks/run-errand/task.yml
        input_mapping:
          bbl-state: relint-envs
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
          ERRAND_NAME: smoke-tests
      - task: export-compiled-release-staticfile-buildpack
        file: runtime-ci/tasks/export-compiled-release-tarball/task.yml
        input_mapping:
          bbl-state: relint-envs
          manifest: updated-cf-deployment-staticfile-buildpack-release-candidate
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
          RELEASE_NAME: staticfile-buildpack
      - task: update-release-staticfile-buildpack-develop
        file: runtime-ci/tasks/update-single-manifest-release/task.yml
        input_mapping:
          deployment-configuration: cf-deployment-develop
          release: staticfile-buildpack-release
        output_mapping:
          updated-deployment-manifest: updated-cf-deployment-staticfile-buildpack-develop
        params:
          RELEASE_NAME: staticfile-buildpack
      - task: update-additional-ops-files-staticfile-buildpack-develop
        file: runtime-ci/tasks/update-single-opsfile-release/task.yml
        input_mapping:
          original-ops-file: updated-cf-deployment-staticfile-buildpack-develop
          release: staticfile-buildpack-release
        output_mapping:
          updated-ops-file: updated-cf-deployment-staticfile-buildpack-develop
        params:
          RELEASE_NAME: staticfile-buildpack
      - task: update-compiled-releases-ops-file-staticfile-buildpack-develop
        file: runtime-ci/tasks/update-single-compiled-release/task.yml
        input_mapping:
          original-compiled-releases-ops-file: updated-cf-deployment-staticfile-buildpack-develop
          release: staticfile-buildpack-release
        output_mapping:
          updated-compiled-releases-ops-file: updated-cf-deployment-staticfile-buildpack-develop
        params:
          RELEASE_NAME: staticfile-buildpack
          ORIGINAL_OPS_FILE_PATH: operations/use-compiled-releases.yml
          UPDATED_OPS_FILE_PATH: operations/use-compiled-releases.yml
      on_success:
        do:
        - put: staticfile-buildpack-release-gcs
          params:
            file: compiled-release-tarball/*.tgz
            predefined_acl: publicRead
        - put: cf-deployment-develop
          params:
            rebase: true
            repository: updated-cf-deployment-staticfile-buildpack-develop
      on_failure:
        do:
        - task: push-to-release-branch
          file: runtime-ci/tasks/push-to-release-branch/task.yml
          input_mapping:
            updated-cf-deployment: updated-cf-deployment-staticfile-buildpack-release-candidate
            release: staticfile-buildpack-release
          params:
            DEPLOY_KEY: ((cf_deployment_readwrite_deploy_key.private_key))
            RELEASE_NAME: staticfile-buildpack
        - task: retrieve-bosh-logs
          file: runtime-ci/tasks/retrieve-bosh-logs/task.yml
          input_mapping:
            bbl-state: relint-envs
          params:
            BBL_STATE_DIR: environments/test/pre-dev/bbl-state
        - put: staticfile-buildpack-component-bump-logs-gcs
          params:
            file: bosh-logs/cf-*.tgz
        ensure:
          do:
          - task: create-slack-message
            file: runtime-ci/tasks/create-slack-message/task.yml
            input_mapping:
              release: staticfile-buildpack-release
            params:
              RELEASE_NAME: staticfile-buildpack
              REPOSITORY: cloudfoundry/staticfile-buildpack-release
              BOSH_LOGS_PREFIX: https://storage.cloud.google.com/component-bump-logs/staticfile-buildpack
          - put: slack-alert
            params:
              text_file: slack-message/message.txt
              username: Release Integration
              icon_emoji: ':cloudfoundrylogo:'
    ensure:
      do:
      - task: delete-deployment
        file: cf-deployment-concourse-tasks/bosh-delete-deployment/task.yml
        input_mapping:
          bbl-state: relint-envs
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
      - task: remove-gcp-dns
        file: runtime-ci/tasks/manage-gcp-dns/task.yml
        input_mapping:
          bbl-state: relint-envs
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
          GCP_DNS_SERVICE_ACCOUNT_KEY: ((concourse_gcp_service_account_json))
          GCP_DNS_ZONE_NAME: test-relint-rocks
          GCP_DNS_RECORD_SET_NAME: pre-dev.test.relint.rocks
          ACTION: remove
      - task: bbl-down
        file: cf-deployment-concourse-tasks/bbl-destroy/task.yml
        input_mapping:
          bbl-state: relint-envs
        params:
          BBL_GCP_SERVICE_ACCOUNT_KEY: environments/test/pre-dev/google_account_creds.json
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
        ensure:
          put: relint-envs
          params:
            repository: updated-bbl-state
            rebase: true
- name: update-statsd-injector
  serial_groups:
  - update-release
  public: true
  plan:
  - aggregate:
    - get: statsd-injector-release
      trigger: true
      params:
        tarball: false
    - get: cf-deployment-release-candidate
    - get: cf-deployment-develop
    - get: stemcell
      params:
        tarball: false
    - get: cf-deployment-concourse-tasks
    - get: runtime-ci
    - get: relint-envs
    - get: relint-team
  - task: update-release-statsd-injector-release-candidate
    file: runtime-ci/tasks/update-single-manifest-release/task.yml
    input_mapping:
      deployment-configuration: cf-deployment-release-candidate
      release: statsd-injector-release
    output_mapping:
      updated-deployment-manifest: updated-cf-deployment-statsd-injector-release-candidate
    params:
      RELEASE_NAME: statsd-injector
  - task: update-additional-ops-files-statsd-injector-release-candidate
    file: runtime-ci/tasks/update-single-opsfile-release/task.yml
    input_mapping:
      original-ops-file: updated-cf-deployment-statsd-injector-release-candidate
      release: statsd-injector-release
    output_mapping:
      updated-ops-file: updated-cf-deployment-statsd-injector-release-candidate
    params:
      RELEASE_NAME: statsd-injector
  - do:
    - task: bbl-up
      file: cf-deployment-concourse-tasks/bbl-up/task.yml
      params:
        BBL_STATE_DIR: environments/test/pre-dev/bbl-state
        BBL_IAAS: gcp
        BBL_ENV_NAME: pre-dev
        BBL_GCP_SERVICE_ACCOUNT_KEY: environments/test/pre-dev/google_account_creds.json
        BBL_GCP_REGION: us-central1
        BBL_LB_CERT: ((pre_dev_cf_lb_cert.certificate))
        BBL_LB_KEY: ((pre_dev_cf_lb_cert.private_key))
        LB_DOMAIN: pre-dev.test.relint.rocks
      input_mapping:
        bbl-state: relint-envs
        bbl-config: relint-envs
      ensure:
        put: relint-envs
        params:
          repository: updated-bbl-state
          rebase: true
    - task: add-gcp-dns
      file: runtime-ci/tasks/manage-gcp-dns/task.yml
      input_mapping:
        bbl-state: relint-envs
      params:
        BBL_STATE_DIR: environments/test/pre-dev/bbl-state
        GCP_DNS_SERVICE_ACCOUNT_KEY: ((concourse_gcp_service_account_json))
        GCP_DNS_ZONE_NAME: test-relint-rocks
        GCP_DNS_RECORD_SET_NAME: pre-dev.test.relint.rocks
        ACTION: add
    - do:
      - task: deploy-cf
        file: cf-deployment-concourse-tasks/bosh-deploy/task.yml
        input_mapping:
          bbl-state: relint-envs
          cf-deployment: updated-cf-deployment-statsd-injector-release-candidate
          ops-files: updated-cf-deployment-statsd-injector-release-candidate
          vars-files: relint-envs
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
          SYSTEM_DOMAIN: pre-dev.test.relint.rocks
          OPS_FILES: |
            operations/experimental/fast-deploy-with-downtime-and-danger.yml
          REGENERATE_CREDENTIALS: false
          BOSH_DEPLOY_ARGS: --parallel 50
      - task: run-errand-smoke-tests
        file: cf-deployment-concourse-tasks/run-errand/task.yml
        input_mapping:
          bbl-state: relint-envs
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
          ERRAND_NAME: smoke-tests
      - task: export-compiled-release-statsd-injector
        file: runtime-ci/tasks/export-compiled-release-tarball/task.yml
        input_mapping:
          bbl-state: relint-envs
          manifest: updated-cf-deployment-statsd-injector-release-candidate
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
          RELEASE_NAME: statsd-injector
      - task: update-release-statsd-injector-develop
        file: runtime-ci/tasks/update-single-manifest-release/task.yml
        input_mapping:
          deployment-configuration: cf-deployment-develop
          release: statsd-injector-release
        output_mapping:
          updated-deployment-manifest: updated-cf-deployment-statsd-injector-develop
        params:
          RELEASE_NAME: statsd-injector
      - task: update-additional-ops-files-statsd-injector-develop
        file: runtime-ci/tasks/update-single-opsfile-release/task.yml
        input_mapping:
          original-ops-file: updated-cf-deployment-statsd-injector-develop
          release: statsd-injector-release
        output_mapping:
          updated-ops-file: updated-cf-deployment-statsd-injector-develop
        params:
          RELEASE_NAME: statsd-injector
      - task: update-compiled-releases-ops-file-statsd-injector-develop
        file: runtime-ci/tasks/update-single-compiled-release/task.yml
        input_mapping:
          original-compiled-releases-ops-file: updated-cf-deployment-statsd-injector-develop
          release: statsd-injector-release
        output_mapping:
          updated-compiled-releases-ops-file: updated-cf-deployment-statsd-injector-develop
        params:
          RELEASE_NAME: statsd-injector
          ORIGINAL_OPS_FILE_PATH: operations/use-compiled-releases.yml
          UPDATED_OPS_FILE_PATH: operations/use-compiled-releases.yml
      on_success:
        do:
        - put: statsd-injector-release-gcs
          params:
            file: compiled-release-tarball/*.tgz
            predefined_acl: publicRead
        - put: cf-deployment-develop
          params:
            rebase: true
            repository: updated-cf-deployment-statsd-injector-develop
      on_failure:
        do:
        - task: push-to-release-branch
          file: runtime-ci/tasks/push-to-release-branch/task.yml
          input_mapping:
            updated-cf-deployment: updated-cf-deployment-statsd-injector-release-candidate
            release: statsd-injector-release
          params:
            DEPLOY_KEY: ((cf_deployment_readwrite_deploy_key.private_key))
            RELEASE_NAME: statsd-injector
        - task: retrieve-bosh-logs
          file: runtime-ci/tasks/retrieve-bosh-logs/task.yml
          input_mapping:
            bbl-state: relint-envs
          params:
            BBL_STATE_DIR: environments/test/pre-dev/bbl-state
        - put: statsd-injector-component-bump-logs-gcs
          params:
            file: bosh-logs/cf-*.tgz
        ensure:
          do:
          - task: create-slack-message
            file: runtime-ci/tasks/create-slack-message/task.yml
            input_mapping:
              release: statsd-injector-release
            params:
              RELEASE_NAME: statsd-injector
              REPOSITORY: cloudfoundry/statsd-injector-release
              BOSH_LOGS_PREFIX: https://storage.cloud.google.com/component-bump-logs/statsd-injector
          - put: slack-alert
            params:
              text_file: slack-message/message.txt
              username: Release Integration
              icon_emoji: ':cloudfoundrylogo:'
    ensure:
      do:
      - task: delete-deployment
        file: cf-deployment-concourse-tasks/bosh-delete-deployment/task.yml
        input_mapping:
          bbl-state: relint-envs
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
      - task: remove-gcp-dns
        file: runtime-ci/tasks/manage-gcp-dns/task.yml
        input_mapping:
          bbl-state: relint-envs
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
          GCP_DNS_SERVICE_ACCOUNT_KEY: ((concourse_gcp_service_account_json))
          GCP_DNS_ZONE_NAME: test-relint-rocks
          GCP_DNS_RECORD_SET_NAME: pre-dev.test.relint.rocks
          ACTION: remove
      - task: bbl-down
        file: cf-deployment-concourse-tasks/bbl-destroy/task.yml
        input_mapping:
          bbl-state: relint-envs
        params:
          BBL_GCP_SERVICE_ACCOUNT_KEY: environments/test/pre-dev/google_account_creds.json
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
        ensure:
          put: relint-envs
          params:
            repository: updated-bbl-state
            rebase: true
- name: update-uaa
  serial_groups:
  - update-release
  public: true
  plan:
  - aggregate:
    - get: uaa-release
      trigger: true
      params:
        tarball: false
    - get: cf-deployment-release-candidate
    - get: cf-deployment-develop
    - get: stemcell
      params:
        tarball: false
    - get: cf-deployment-concourse-tasks
    - get: runtime-ci
    - get: relint-envs
    - get: relint-team
  - task: update-release-uaa-release-candidate
    file: runtime-ci/tasks/update-single-manifest-release/task.yml
    input_mapping:
      deployment-configuration: cf-deployment-release-candidate
      release: uaa-release
    output_mapping:
      updated-deployment-manifest: updated-cf-deployment-uaa-release-candidate
    params:
      RELEASE_NAME: uaa
  - task: update-additional-ops-files-uaa-release-candidate
    file: runtime-ci/tasks/update-single-opsfile-release/task.yml
    input_mapping:
      original-ops-file: updated-cf-deployment-uaa-release-candidate
      release: uaa-release
    output_mapping:
      updated-ops-file: updated-cf-deployment-uaa-release-candidate
    params:
      RELEASE_NAME: uaa
  - do:
    - task: bbl-up
      file: cf-deployment-concourse-tasks/bbl-up/task.yml
      params:
        BBL_STATE_DIR: environments/test/pre-dev/bbl-state
        BBL_IAAS: gcp
        BBL_ENV_NAME: pre-dev
        BBL_GCP_SERVICE_ACCOUNT_KEY: environments/test/pre-dev/google_account_creds.json
        BBL_GCP_REGION: us-central1
        BBL_LB_CERT: ((pre_dev_cf_lb_cert.certificate))
        BBL_LB_KEY: ((pre_dev_cf_lb_cert.private_key))
        LB_DOMAIN: pre-dev.test.relint.rocks
      input_mapping:
        bbl-state: relint-envs
        bbl-config: relint-envs
      ensure:
        put: relint-envs
        params:
          repository: updated-bbl-state
          rebase: true
    - task: add-gcp-dns
      file: runtime-ci/tasks/manage-gcp-dns/task.yml
      input_mapping:
        bbl-state: relint-envs
      params:
        BBL_STATE_DIR: environments/test/pre-dev/bbl-state
        GCP_DNS_SERVICE_ACCOUNT_KEY: ((concourse_gcp_service_account_json))
        GCP_DNS_ZONE_NAME: test-relint-rocks
        GCP_DNS_RECORD_SET_NAME: pre-dev.test.relint.rocks
        ACTION: add
    - do:
      - task: deploy-cf
        file: cf-deployment-concourse-tasks/bosh-deploy/task.yml
        input_mapping:
          bbl-state: relint-envs
          cf-deployment: updated-cf-deployment-uaa-release-candidate
          ops-files: updated-cf-deployment-uaa-release-candidate
          vars-files: relint-envs
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
          SYSTEM_DOMAIN: pre-dev.test.relint.rocks
          OPS_FILES: |
            operations/experimental/fast-deploy-with-downtime-and-danger.yml
          REGENERATE_CREDENTIALS: false
          BOSH_DEPLOY_ARGS: --parallel 50
      - task: run-errand-smoke-tests
        file: cf-deployment-concourse-tasks/run-errand/task.yml
        input_mapping:
          bbl-state: relint-envs
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
          ERRAND_NAME: smoke-tests
      - task: export-compiled-release-uaa
        file: runtime-ci/tasks/export-compiled-release-tarball/task.yml
        input_mapping:
          bbl-state: relint-envs
          manifest: updated-cf-deployment-uaa-release-candidate
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
          RELEASE_NAME: uaa
      - task: update-release-uaa-develop
        file: runtime-ci/tasks/update-single-manifest-release/task.yml
        input_mapping:
          deployment-configuration: cf-deployment-develop
          release: uaa-release
        output_mapping:
          updated-deployment-manifest: updated-cf-deployment-uaa-develop
        params:
          RELEASE_NAME: uaa
      - task: update-additional-ops-files-uaa-develop
        file: runtime-ci/tasks/update-single-opsfile-release/task.yml
        input_mapping:
          original-ops-file: updated-cf-deployment-uaa-develop
          release: uaa-release
        output_mapping:
          updated-ops-file: updated-cf-deployment-uaa-develop
        params:
          RELEASE_NAME: uaa
      - task: update-compiled-releases-ops-file-uaa-develop
        file: runtime-ci/tasks/update-single-compiled-release/task.yml
        input_mapping:
          original-compiled-releases-ops-file: updated-cf-deployment-uaa-develop
          release: uaa-release
        output_mapping:
          updated-compiled-releases-ops-file: updated-cf-deployment-uaa-develop
        params:
          RELEASE_NAME: uaa
          ORIGINAL_OPS_FILE_PATH: operations/use-compiled-releases.yml
          UPDATED_OPS_FILE_PATH: operations/use-compiled-releases.yml
      on_success:
        do:
        - put: uaa-release-gcs
          params:
            file: compiled-release-tarball/*.tgz
            predefined_acl: publicRead
        - put: cf-deployment-develop
          params:
            rebase: true
            repository: updated-cf-deployment-uaa-develop
      on_failure:
        do:
        - task: push-to-release-branch
          file: runtime-ci/tasks/push-to-release-branch/task.yml
          input_mapping:
            updated-cf-deployment: updated-cf-deployment-uaa-release-candidate
            release: uaa-release
          params:
            DEPLOY_KEY: ((cf_deployment_readwrite_deploy_key.private_key))
            RELEASE_NAME: uaa
        - task: retrieve-bosh-logs
          file: runtime-ci/tasks/retrieve-bosh-logs/task.yml
          input_mapping:
            bbl-state: relint-envs
          params:
            BBL_STATE_DIR: environments/test/pre-dev/bbl-state
        - put: uaa-component-bump-logs-gcs
          params:
            file: bosh-logs/cf-*.tgz
        ensure:
          do:
          - task: create-slack-message
            file: runtime-ci/tasks/create-slack-message/task.yml
            input_mapping:
              release: uaa-release
            params:
              RELEASE_NAME: uaa
              REPOSITORY: cloudfoundry/uaa-release
              BOSH_LOGS_PREFIX: https://storage.cloud.google.com/component-bump-logs/uaa
          - put: slack-alert
            params:
              text_file: slack-message/message.txt
              username: Release Integration
              icon_emoji: ':cloudfoundrylogo:'
    ensure:
      do:
      - task: delete-deployment
        file: cf-deployment-concourse-tasks/bosh-delete-deployment/task.yml
        input_mapping:
          bbl-state: relint-envs
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
      - task: remove-gcp-dns
        file: runtime-ci/tasks/manage-gcp-dns/task.yml
        input_mapping:
          bbl-state: relint-envs
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
          GCP_DNS_SERVICE_ACCOUNT_KEY: ((concourse_gcp_service_account_json))
          GCP_DNS_ZONE_NAME: test-relint-rocks
          GCP_DNS_RECORD_SET_NAME: pre-dev.test.relint.rocks
          ACTION: remove
      - task: bbl-down
        file: cf-deployment-concourse-tasks/bbl-destroy/task.yml
        input_mapping:
          bbl-state: relint-envs
        params:
          BBL_GCP_SERVICE_ACCOUNT_KEY: environments/test/pre-dev/google_account_creds.json
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
        ensure:
          put: relint-envs
          params:
            repository: updated-bbl-state
            rebase: true
- name: update-credhub
  serial_groups:
  - update-release
  public: true
  plan:
  - aggregate:
    - get: credhub-release
      trigger: true
      params:
        tarball: false
    - get: cf-deployment-release-candidate
    - get: cf-deployment-develop
    - get: stemcell
      params:
        tarball: false
    - get: cf-deployment-concourse-tasks
    - get: runtime-ci
    - get: relint-envs
    - get: relint-team
  - task: update-release-credhub-release-candidate
    file: runtime-ci/tasks/update-single-manifest-release/task.yml
    input_mapping:
      deployment-configuration: cf-deployment-release-candidate
      release: credhub-release
    output_mapping:
      updated-deployment-manifest: updated-cf-deployment-credhub-release-candidate
    params:
      RELEASE_NAME: credhub
  - task: update-additional-ops-files-credhub-release-candidate
    file: runtime-ci/tasks/update-single-opsfile-release/task.yml
    input_mapping:
      original-ops-file: updated-cf-deployment-credhub-release-candidate
      release: credhub-release
    output_mapping:
      updated-ops-file: updated-cf-deployment-credhub-release-candidate
    params:
      RELEASE_NAME: credhub
  - do:
    - task: bbl-up
      file: cf-deployment-concourse-tasks/bbl-up/task.yml
      params:
        BBL_STATE_DIR: environments/test/pre-dev/bbl-state
        BBL_IAAS: gcp
        BBL_ENV_NAME: pre-dev
        BBL_GCP_SERVICE_ACCOUNT_KEY: environments/test/pre-dev/google_account_creds.json
        BBL_GCP_REGION: us-central1
        BBL_LB_CERT: ((pre_dev_cf_lb_cert.certificate))
        BBL_LB_KEY: ((pre_dev_cf_lb_cert.private_key))
        LB_DOMAIN: pre-dev.test.relint.rocks
      input_mapping:
        bbl-state: relint-envs
        bbl-config: relint-envs
      ensure:
        put: relint-envs
        params:
          repository: updated-bbl-state
          rebase: true
    - task: add-gcp-dns
      file: runtime-ci/tasks/manage-gcp-dns/task.yml
      input_mapping:
        bbl-state: relint-envs
      params:
        BBL_STATE_DIR: environments/test/pre-dev/bbl-state
        GCP_DNS_SERVICE_ACCOUNT_KEY: ((concourse_gcp_service_account_json))
        GCP_DNS_ZONE_NAME: test-relint-rocks
        GCP_DNS_RECORD_SET_NAME: pre-dev.test.relint.rocks
        ACTION: add
    - do:
      - task: deploy-cf
        file: cf-deployment-concourse-tasks/bosh-deploy/task.yml
        input_mapping:
          bbl-state: relint-envs
          cf-deployment: updated-cf-deployment-credhub-release-candidate
          ops-files: updated-cf-deployment-credhub-release-candidate
          vars-files: relint-envs
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
          SYSTEM_DOMAIN: pre-dev.test.relint.rocks
          OPS_FILES: |
            operations/experimental/fast-deploy-with-downtime-and-danger.yml
          REGENERATE_CREDENTIALS: false
          BOSH_DEPLOY_ARGS: --parallel 50
      - task: run-errand-smoke-tests
        file: cf-deployment-concourse-tasks/run-errand/task.yml
        input_mapping:
          bbl-state: relint-envs
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
          ERRAND_NAME: smoke-tests
      - task: export-compiled-release-credhub
        file: runtime-ci/tasks/export-compiled-release-tarball/task.yml
        input_mapping:
          bbl-state: relint-envs
          manifest: updated-cf-deployment-credhub-release-candidate
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
          RELEASE_NAME: credhub
      - task: update-release-credhub-develop
        file: runtime-ci/tasks/update-single-manifest-release/task.yml
        input_mapping:
          deployment-configuration: cf-deployment-develop
          release: credhub-release
        output_mapping:
          updated-deployment-manifest: updated-cf-deployment-credhub-develop
        params:
          RELEASE_NAME: credhub
      - task: update-additional-ops-files-credhub-develop
        file: runtime-ci/tasks/update-single-opsfile-release/task.yml
        input_mapping:
          original-ops-file: updated-cf-deployment-credhub-develop
          release: credhub-release
        output_mapping:
          updated-ops-file: updated-cf-deployment-credhub-develop
        params:
          RELEASE_NAME: credhub
      - task: update-compiled-releases-ops-file-credhub-develop
        file: runtime-ci/tasks/update-single-compiled-release/task.yml
        input_mapping:
          original-compiled-releases-ops-file: updated-cf-deployment-credhub-develop
          release: credhub-release
        output_mapping:
          updated-compiled-releases-ops-file: updated-cf-deployment-credhub-develop
        params:
          RELEASE_NAME: credhub
          ORIGINAL_OPS_FILE_PATH: operations/use-compiled-releases.yml
          UPDATED_OPS_FILE_PATH: operations/use-compiled-releases.yml
      on_success:
        do:
        - put: credhub-release-gcs
          params:
            file: compiled-release-tarball/*.tgz
            predefined_acl: publicRead
        - put: cf-deployment-develop
          params:
            rebase: true
            repository: updated-cf-deployment-credhub-develop
      on_failure:
        do:
        - task: push-to-release-branch
          file: runtime-ci/tasks/push-to-release-branch/task.yml
          input_mapping:
            updated-cf-deployment: updated-cf-deployment-credhub-release-candidate
            release: credhub-release
          params:
            DEPLOY_KEY: ((cf_deployment_readwrite_deploy_key.private_key))
            RELEASE_NAME: credhub
        - task: retrieve-bosh-logs
          file: runtime-ci/tasks/retrieve-bosh-logs/task.yml
          input_mapping:
            bbl-state: relint-envs
          params:
            BBL_STATE_DIR: environments/test/pre-dev/bbl-state
        - put: credhub-component-bump-logs-gcs
          params:
            file: bosh-logs/cf-*.tgz
        ensure:
          do:
          - task: create-slack-message
            file: runtime-ci/tasks/create-slack-message/task.yml
            input_mapping:
              release: credhub-release
            params:
              RELEASE_NAME: credhub
              REPOSITORY: pivotal-cf/credhub-release
              BOSH_LOGS_PREFIX: https://storage.cloud.google.com/component-bump-logs/credhub
          - put: slack-alert
            params:
              text_file: slack-message/message.txt
              username: Release Integration
              icon_emoji: ':cloudfoundrylogo:'
    ensure:
      do:
      - task: delete-deployment
        file: cf-deployment-concourse-tasks/bosh-delete-deployment/task.yml
        input_mapping:
          bbl-state: relint-envs
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
      - task: remove-gcp-dns
        file: runtime-ci/tasks/manage-gcp-dns/task.yml
        input_mapping:
          bbl-state: relint-envs
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
          GCP_DNS_SERVICE_ACCOUNT_KEY: ((concourse_gcp_service_account_json))
          GCP_DNS_ZONE_NAME: test-relint-rocks
          GCP_DNS_RECORD_SET_NAME: pre-dev.test.relint.rocks
          ACTION: remove
      - task: bbl-down
        file: cf-deployment-concourse-tasks/bbl-destroy/task.yml
        input_mapping:
          bbl-state: relint-envs
        params:
          BBL_GCP_SERVICE_ACCOUNT_KEY: environments/test/pre-dev/google_account_creds.json
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
        ensure:
          put: relint-envs
          params:
            repository: updated-bbl-state
            rebase: true
- name: update-cf-cli
  serial_groups:
  - update-release
  public: true
  plan:
  - aggregate:
    - get: cf-cli-release
      trigger: true
      params:
        tarball: false
    - get: cf-deployment-release-candidate
    - get: cf-deployment-develop
    - get: stemcell
      params:
        tarball: false
    - get: cf-deployment-concourse-tasks
    - get: runtime-ci
    - get: relint-envs
    - get: relint-team
  - task: update-release-cf-cli-release-candidate
    file: runtime-ci/tasks/update-single-manifest-release/task.yml
    input_mapping:
      deployment-configuration: cf-deployment-release-candidate
      release: cf-cli-release
    output_mapping:
      updated-deployment-manifest: updated-cf-deployment-cf-cli-release-candidate
    params:
      RELEASE_NAME: cf-cli
  - task: update-additional-ops-files-cf-cli-release-candidate
    file: runtime-ci/tasks/update-single-opsfile-release/task.yml
    input_mapping:
      original-ops-file: updated-cf-deployment-cf-cli-release-candidate
      release: cf-cli-release
    output_mapping:
      updated-ops-file: updated-cf-deployment-cf-cli-release-candidate
    params:
      RELEASE_NAME: cf-cli
  - do:
    - task: bbl-up
      file: cf-deployment-concourse-tasks/bbl-up/task.yml
      params:
        BBL_STATE_DIR: environments/test/pre-dev/bbl-state
        BBL_IAAS: gcp
        BBL_ENV_NAME: pre-dev
        BBL_GCP_SERVICE_ACCOUNT_KEY: environments/test/pre-dev/google_account_creds.json
        BBL_GCP_REGION: us-central1
        BBL_LB_CERT: ((pre_dev_cf_lb_cert.certificate))
        BBL_LB_KEY: ((pre_dev_cf_lb_cert.private_key))
        LB_DOMAIN: pre-dev.test.relint.rocks
      input_mapping:
        bbl-state: relint-envs
        bbl-config: relint-envs
      ensure:
        put: relint-envs
        params:
          repository: updated-bbl-state
          rebase: true
    - task: add-gcp-dns
      file: runtime-ci/tasks/manage-gcp-dns/task.yml
      input_mapping:
        bbl-state: relint-envs
      params:
        BBL_STATE_DIR: environments/test/pre-dev/bbl-state
        GCP_DNS_SERVICE_ACCOUNT_KEY: ((concourse_gcp_service_account_json))
        GCP_DNS_ZONE_NAME: test-relint-rocks
        GCP_DNS_RECORD_SET_NAME: pre-dev.test.relint.rocks
        ACTION: add
    - do:
      - task: deploy-cf
        file: cf-deployment-concourse-tasks/bosh-deploy/task.yml
        input_mapping:
          bbl-state: relint-envs
          cf-deployment: updated-cf-deployment-cf-cli-release-candidate
          ops-files: updated-cf-deployment-cf-cli-release-candidate
          vars-files: relint-envs
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
          SYSTEM_DOMAIN: pre-dev.test.relint.rocks
          OPS_FILES: |
            operations/experimental/fast-deploy-with-downtime-and-danger.yml
          REGENERATE_CREDENTIALS: false
          BOSH_DEPLOY_ARGS: --parallel 50
      - task: run-errand-smoke-tests
        file: cf-deployment-concourse-tasks/run-errand/task.yml
        input_mapping:
          bbl-state: relint-envs
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
          ERRAND_NAME: smoke-tests
      - task: export-compiled-release-cf-cli
        file: runtime-ci/tasks/export-compiled-release-tarball/task.yml
        input_mapping:
          bbl-state: relint-envs
          manifest: updated-cf-deployment-cf-cli-release-candidate
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
          RELEASE_NAME: cf-cli
      - task: update-release-cf-cli-develop
        file: runtime-ci/tasks/update-single-manifest-release/task.yml
        input_mapping:
          deployment-configuration: cf-deployment-develop
          release: cf-cli-release
        output_mapping:
          updated-deployment-manifest: updated-cf-deployment-cf-cli-develop
        params:
          RELEASE_NAME: cf-cli
      - task: update-additional-ops-files-cf-cli-develop
        file: runtime-ci/tasks/update-single-opsfile-release/task.yml
        input_mapping:
          original-ops-file: updated-cf-deployment-cf-cli-develop
          release: cf-cli-release
        output_mapping:
          updated-ops-file: updated-cf-deployment-cf-cli-develop
        params:
          RELEASE_NAME: cf-cli
      - task: update-compiled-releases-ops-file-cf-cli-develop
        file: runtime-ci/tasks/update-single-compiled-release/task.yml
        input_mapping:
          original-compiled-releases-ops-file: updated-cf-deployment-cf-cli-develop
          release: cf-cli-release
        output_mapping:
          updated-compiled-releases-ops-file: updated-cf-deployment-cf-cli-develop
        params:
          RELEASE_NAME: cf-cli
          ORIGINAL_OPS_FILE_PATH: operations/use-compiled-releases.yml
          UPDATED_OPS_FILE_PATH: operations/use-compiled-releases.yml
      on_success:
        do:
        - put: cf-cli-release-gcs
          params:
            file: compiled-release-tarball/*.tgz
            predefined_acl: publicRead
        - put: cf-deployment-develop
          params:
            rebase: true
            repository: updated-cf-deployment-cf-cli-develop
      on_failure:
        do:
        - task: push-to-release-branch
          file: runtime-ci/tasks/push-to-release-branch/task.yml
          input_mapping:
            updated-cf-deployment: updated-cf-deployment-cf-cli-release-candidate
            release: cf-cli-release
          params:
            DEPLOY_KEY: ((cf_deployment_readwrite_deploy_key.private_key))
            RELEASE_NAME: cf-cli
        - task: retrieve-bosh-logs
          file: runtime-ci/tasks/retrieve-bosh-logs/task.yml
          input_mapping:
            bbl-state: relint-envs
          params:
            BBL_STATE_DIR: environments/test/pre-dev/bbl-state
        - put: cf-cli-component-bump-logs-gcs
          params:
            file: bosh-logs/cf-*.tgz
        ensure:
          do:
          - task: create-slack-message
            file: runtime-ci/tasks/create-slack-message/task.yml
            input_mapping:
              release: cf-cli-release
            params:
              RELEASE_NAME: cf-cli
              REPOSITORY: bosh-packages/cf-cli-release
              BOSH_LOGS_PREFIX: https://storage.cloud.google.com/component-bump-logs/cf-cli
          - put: slack-alert
            params:
              text_file: slack-message/message.txt
              username: Release Integration
              icon_emoji: ':cloudfoundrylogo:'
    ensure:
      do:
      - task: delete-deployment
        file: cf-deployment-concourse-tasks/bosh-delete-deployment/task.yml
        input_mapping:
          bbl-state: relint-envs
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
      - task: remove-gcp-dns
        file: runtime-ci/tasks/manage-gcp-dns/task.yml
        input_mapping:
          bbl-state: relint-envs
        params:
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
          GCP_DNS_SERVICE_ACCOUNT_KEY: ((concourse_gcp_service_account_json))
          GCP_DNS_ZONE_NAME: test-relint-rocks
          GCP_DNS_RECORD_SET_NAME: pre-dev.test.relint.rocks
          ACTION: remove
      - task: bbl-down
        file: cf-deployment-concourse-tasks/bbl-destroy/task.yml
        input_mapping:
          bbl-state: relint-envs
        params:
          BBL_GCP_SERVICE_ACCOUNT_KEY: environments/test/pre-dev/google_account_creds.json
          BBL_STATE_DIR: environments/test/pre-dev/bbl-state
        ensure:
          put: relint-envs
          params:
            repository: updated-bbl-state
            rebase: true
- name: delete-stale-branches
  public: true
  plan:
  - aggregate:
    - get: cf-deployment-all-branches
    - get: runtime-ci
    - get: daily
      trigger: true
  - task: delete-stale-branches
    file: runtime-ci/tasks/validate-branch-freshness/task.yml
    input_mapping:
      repo: cf-deployment-all-branches
    params:
      BRANCH_REGEXP: update-.*-release-.*
      MONTHS: 1
      DELETE_STALE_BRANCHES: true
      DEPLOY_KEY: ((cf_deployment_readwrite_deploy_key.private_key))
